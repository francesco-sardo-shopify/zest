import{w as il}from"./with-props-C97DBiG3.js";import{j as T}from"./jsx-runtime-BjG_zV1W.js";import{p as sl,q as dr,r as Oe,s as Di}from"./chunk-AYJ5UCUI-pMwHqBCg.js";import{getSettings as al,getChat as ol,getBook as ll,updateChat as ul}from"./db-Dghpep6g.js";import{c as Sn,g as Ys,e as cl}from"./epub-B2xxWx9D.js";import{T as hl}from"./TopBar-C2zSAFsJ.js";const fl="modulepreload",dl=function(e){return"/zest/"+e},Bi={},pl=function(t,n,r){let i=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));i=Promise.allSettled(n.map(l=>{if(l=dl(l),l in Bi)return;Bi[l]=!0;const u=l.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${h}`))return;const c=document.createElement("link");if(c.rel=u?"stylesheet":fl,u||(c.as="script"),c.crossOrigin="",c.href=l,o&&c.setAttribute("nonce",o),document.head.appendChild(c),u)return new Promise((d,f)=>{c.addEventListener("load",d),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return i.then(a=>{for(const o of a||[])o.status==="rejected"&&s(o.reason);return t().catch(s)})},pr="RFC3986",mr={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:e=>String(e)},ml="RFC1738",gl=Array.isArray,Re=(()=>{const e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})(),Wn=1024,yl=(e,t,n,r,i)=>{if(e.length===0)return e;let s=e;if(typeof e=="symbol"?s=Symbol.prototype.toString.call(e):typeof e!="string"&&(s=String(e)),n==="iso-8859-1")return escape(s).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let a="";for(let o=0;o<s.length;o+=Wn){const l=s.length>=Wn?s.slice(o,o+Wn):s,u=[];for(let h=0;h<l.length;++h){let c=l.charCodeAt(h);if(c===45||c===46||c===95||c===126||c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||i===ml&&(c===40||c===41)){u[u.length]=l.charAt(h);continue}if(c<128){u[u.length]=Re[c];continue}if(c<2048){u[u.length]=Re[192|c>>6]+Re[128|c&63];continue}if(c<55296||c>=57344){u[u.length]=Re[224|c>>12]+Re[128|c>>6&63]+Re[128|c&63];continue}h+=1,c=65536+((c&1023)<<10|l.charCodeAt(h)&1023),u[u.length]=Re[240|c>>18]+Re[128|c>>12&63]+Re[128|c>>6&63]+Re[128|c&63]}a+=u.join("")}return a};function wl(e){return!e||typeof e!="object"?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}function $i(e,t){if(gl(e)){const n=[];for(let r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)}const xl=Object.prototype.hasOwnProperty,Zs={brackets(e){return String(e)+"[]"},comma:"comma",indices(e,t){return String(e)+"["+t+"]"},repeat(e){return String(e)}},Ne=Array.isArray,bl=Array.prototype.push,ea=function(e,t){bl.apply(e,Ne(t)?t:[t])},_l=Date.prototype.toISOString,te={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:yl,encodeValuesOnly:!1,format:pr,formatter:mr[pr],indices:!1,serializeDate(e){return _l.call(e)},skipNulls:!1,strictNullHandling:!1};function kl(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="symbol"||typeof e=="bigint"}const Xn={};function ta(e,t,n,r,i,s,a,o,l,u,h,c,d,f,g,y,k,_){let S=e,b=_,P=0,O=!1;for(;(b=b.get(Xn))!==void 0&&!O;){const F=b.get(e);if(P+=1,typeof F<"u"){if(F===P)throw new RangeError("Cyclic object value");O=!0}typeof b.get(Xn)>"u"&&(P=0)}if(typeof u=="function"?S=u(t,S):S instanceof Date?S=d==null?void 0:d(S):n==="comma"&&Ne(S)&&(S=$i(S,function(F){return F instanceof Date?d==null?void 0:d(F):F})),S===null){if(s)return l&&!y?l(t,te.encoder,k,"key",f):t;S=""}if(kl(S)||wl(S)){if(l){const F=y?t:l(t,te.encoder,k,"key",f);return[(g==null?void 0:g(F))+"="+(g==null?void 0:g(l(S,te.encoder,k,"value",f)))]}return[(g==null?void 0:g(t))+"="+(g==null?void 0:g(String(S)))]}const w=[];if(typeof S>"u")return w;let I;if(n==="comma"&&Ne(S))y&&l&&(S=$i(S,l)),I=[{value:S.length>0?S.join(",")||null:void 0}];else if(Ne(u))I=u;else{const F=Object.keys(S);I=h?F.sort(h):F}const j=o?String(t).replace(/\./g,"%2E"):String(t),N=r&&Ne(S)&&S.length===1?j+"[]":j;if(i&&Ne(S)&&S.length===0)return N+"[]";for(let F=0;F<I.length;++F){const E=I[F],v=typeof E=="object"&&typeof E.value<"u"?E.value:S[E];if(a&&v===null)continue;const V=c&&o?E.replace(/\./g,"%2E"):E,G=Ne(S)?typeof n=="function"?n(N,V):N:N+(c?"."+V:"["+V+"]");_.set(e,P);const U=new WeakMap;U.set(Xn,_),ea(w,ta(v,G,n,r,i,s,a,o,n==="comma"&&y&&Ne(S)?null:l,u,h,c,d,f,g,y,k,U))}return w}function Sl(e=te){if(typeof e.allowEmptyArrays<"u"&&typeof e.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof e.encodeDotInKeys<"u"&&typeof e.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(e.encoder!==null&&typeof e.encoder<"u"&&typeof e.encoder!="function")throw new TypeError("Encoder has to be a function.");const t=e.charset||te.charset;if(typeof e.charset<"u"&&e.charset!=="utf-8"&&e.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=pr;if(typeof e.format<"u"){if(!xl.call(mr,e.format))throw new TypeError("Unknown format option provided.");n=e.format}const r=mr[n];let i=te.filter;(typeof e.filter=="function"||Ne(e.filter))&&(i=e.filter);let s;if(e.arrayFormat&&e.arrayFormat in Zs?s=e.arrayFormat:"indices"in e?s=e.indices?"indices":"repeat":s=te.arrayFormat,"commaRoundTrip"in e&&typeof e.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const a=typeof e.allowDots>"u"?e.encodeDotInKeys?!0:te.allowDots:!!e.allowDots;return{addQueryPrefix:typeof e.addQueryPrefix=="boolean"?e.addQueryPrefix:te.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof e.allowEmptyArrays=="boolean"?!!e.allowEmptyArrays:te.allowEmptyArrays,arrayFormat:s,charset:t,charsetSentinel:typeof e.charsetSentinel=="boolean"?e.charsetSentinel:te.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:typeof e.delimiter>"u"?te.delimiter:e.delimiter,encode:typeof e.encode=="boolean"?e.encode:te.encode,encodeDotInKeys:typeof e.encodeDotInKeys=="boolean"?e.encodeDotInKeys:te.encodeDotInKeys,encoder:typeof e.encoder=="function"?e.encoder:te.encoder,encodeValuesOnly:typeof e.encodeValuesOnly=="boolean"?e.encodeValuesOnly:te.encodeValuesOnly,filter:i,format:n,formatter:r,serializeDate:typeof e.serializeDate=="function"?e.serializeDate:te.serializeDate,skipNulls:typeof e.skipNulls=="boolean"?e.skipNulls:te.skipNulls,sort:typeof e.sort=="function"?e.sort:null,strictNullHandling:typeof e.strictNullHandling=="boolean"?e.strictNullHandling:te.strictNullHandling}}function Cl(e,t={}){let n=e;const r=Sl(t);let i,s;typeof r.filter=="function"?(s=r.filter,n=s("",n)):Ne(r.filter)&&(s=r.filter,i=s);const a=[];if(typeof n!="object"||n===null)return"";const o=Zs[r.arrayFormat],l=o==="comma"&&r.commaRoundTrip;i||(i=Object.keys(n)),r.sort&&i.sort(r.sort);const u=new WeakMap;for(let d=0;d<i.length;++d){const f=i[d];r.skipNulls&&n[f]===null||ea(a,ta(n[f],f,o,l,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,u))}const h=a.join(r.delimiter);let c=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?c+="utf8=%26%2310003%3B&":c+="utf8=%E2%9C%93&"),h.length>0?c+h:""}const dt="4.96.1";let zi=!1,$t,na,ra,gr,ia,sa,aa,oa,la;function El(e,t={auto:!1}){if(zi)throw new Error(`you must \`import 'openai/shims/${e.kind}'\` before importing anything else from openai`);if($t)throw new Error(`can't \`import 'openai/shims/${e.kind}'\` after \`import 'openai/shims/${$t}'\``);zi=t.auto,$t=e.kind,na=e.fetch,ra=e.FormData,gr=e.File,ia=e.ReadableStream,sa=e.getMultipartRequestOptions,aa=e.getDefaultAgent,oa=e.fileFromPath,la=e.isFsReadStream}class Al{constructor(t){this.body=t}get[Symbol.toStringTag](){return"MultipartBody"}}function Pl({manuallyImported:e}={}){const t=e?"You may need to use polyfills":"Add one of these imports before your first `import â€¦ from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let n,r,i,s;try{n=fetch,r=Request,i=Response,s=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${t}`)}return{kind:"web",fetch:n,Request:r,Response:i,Headers:s,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${t}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${t}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${t}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${t}`)}},getMultipartRequestOptions:async(a,o)=>({...o,body:new Al(a)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}const ua=()=>{$t||El(Pl(),{auto:!0})};ua();class L extends Error{}class ae extends L{constructor(t,n,r,i){super(`${ae.makeMessage(t,n,r)}`),this.status=t,this.headers=i,this.request_id=i==null?void 0:i["x-request-id"],this.error=n;const s=n;this.code=s==null?void 0:s.code,this.param=s==null?void 0:s.param,this.type=s==null?void 0:s.type}static makeMessage(t,n,r){const i=n!=null&&n.message?typeof n.message=="string"?n.message:JSON.stringify(n.message):n?JSON.stringify(n):r;return t&&i?`${t} ${i}`:t?`${t} status code (no body)`:i||"(no status code or body)"}static generate(t,n,r,i){if(!t||!i)return new Rn({message:r,cause:wr(n)});const s=n==null?void 0:n.error;return t===400?new ca(t,s,r,i):t===401?new ha(t,s,r,i):t===403?new fa(t,s,r,i):t===404?new da(t,s,r,i):t===409?new pa(t,s,r,i):t===422?new ma(t,s,r,i):t===429?new ga(t,s,r,i):t>=500?new ya(t,s,r,i):new ae(t,s,r,i)}}class ke extends ae{constructor({message:t}={}){super(void 0,void 0,t||"Request was aborted.",void 0)}}class Rn extends ae{constructor({message:t,cause:n}){super(void 0,void 0,t||"Connection error.",void 0),n&&(this.cause=n)}}class Br extends Rn{constructor({message:t}={}){super({message:t??"Request timed out."})}}class ca extends ae{}class ha extends ae{}class fa extends ae{}class da extends ae{}class pa extends ae{}class ma extends ae{}class ga extends ae{}class ya extends ae{}class wa extends L{constructor(){super("Could not parse response content as the length limit was reached")}}class xa extends L{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var nn=function(e,t,n,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(e,n):i?i.value=n:t.set(e,n),n},et=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},ye;class Tn{constructor(){ye.set(this,void 0),this.buffer=new Uint8Array,nn(this,ye,null,"f")}decode(t){if(t==null)return[];const n=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?new TextEncoder().encode(t):t;let r=new Uint8Array(this.buffer.length+n.length);r.set(this.buffer),r.set(n,this.buffer.length),this.buffer=r;const i=[];let s;for(;(s=Il(this.buffer,et(this,ye,"f")))!=null;){if(s.carriage&&et(this,ye,"f")==null){nn(this,ye,s.index,"f");continue}if(et(this,ye,"f")!=null&&(s.index!==et(this,ye,"f")+1||s.carriage)){i.push(this.decodeText(this.buffer.slice(0,et(this,ye,"f")-1))),this.buffer=this.buffer.slice(et(this,ye,"f")),nn(this,ye,null,"f");continue}const a=et(this,ye,"f")!==null?s.preceding-1:s.preceding,o=this.decodeText(this.buffer.slice(0,a));i.push(o),this.buffer=this.buffer.slice(s.index),nn(this,ye,null,"f")}return i}decodeText(t){if(t==null)return"";if(typeof t=="string")return t;if(typeof Buffer<"u"){if(t instanceof Buffer)return t.toString();if(t instanceof Uint8Array)return Buffer.from(t).toString();throw new L(`Unexpected: received non-Uint8Array (${t.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(t instanceof Uint8Array||t instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(t);throw new L(`Unexpected: received non-Uint8Array/ArrayBuffer (${t.constructor.name}) in a web platform. Please report this error.`)}throw new L("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode(`
`):[]}}ye=new WeakMap;Tn.NEWLINE_CHARS=new Set([`
`,"\r"]);Tn.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Il(e,t){for(let i=t??0;i<e.length;i++){if(e[i]===10)return{preceding:i,index:i+1,carriage:!1};if(e[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function vl(e){for(let r=0;r<e.length-1;r++){if(e[r]===10&&e[r+1]===10||e[r]===13&&e[r+1]===13)return r+2;if(e[r]===13&&e[r+1]===10&&r+3<e.length&&e[r+2]===13&&e[r+3]===10)return r+4}return-1}function ba(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const n=await t.read();return n!=null&&n.done&&t.releaseLock(),n}catch(n){throw t.releaseLock(),n}},async return(){const n=t.cancel();return t.releaseLock(),await n,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}class Me{constructor(t,n){this.iterator=t,this.controller=n}static fromSSEResponse(t,n){let r=!1;async function*i(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let s=!1;try{for await(const a of Rl(t,n))if(!s){if(a.data.startsWith("[DONE]")){s=!0;continue}if(a.event===null||a.event.startsWith("response.")||a.event.startsWith("transcript.")){let o;try{o=JSON.parse(a.data)}catch(l){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),l}if(o&&o.error)throw new ae(void 0,o.error,void 0,Pa(t.headers));yield o}else{let o;try{o=JSON.parse(a.data)}catch(l){throw console.error("Could not parse message into JSON:",a.data),console.error("From chunk:",a.raw),l}if(a.event=="error")throw new ae(void 0,o.error,o.message,void 0);yield{event:a.event,data:o}}}s=!0}catch(a){if(a instanceof Error&&a.name==="AbortError")return;throw a}finally{s||n.abort()}}return new Me(i,n)}static fromReadableStream(t,n){let r=!1;async function*i(){const a=new Tn,o=ba(t);for await(const l of o)for(const u of a.decode(l))yield u;for(const l of a.flush())yield l}async function*s(){if(r)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const o of i())a||o&&(yield JSON.parse(o));a=!0}catch(o){if(o instanceof Error&&o.name==="AbortError")return;throw o}finally{a||n.abort()}}return new Me(s,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){const t=[],n=[],r=this.iterator(),i=s=>({next:()=>{if(s.length===0){const a=r.next();t.push(a),n.push(a)}return s.shift()}});return[new Me(()=>i(t),this.controller),new Me(()=>i(n),this.controller)]}toReadableStream(){const t=this;let n;const r=new TextEncoder;return new ia({async start(){n=t[Symbol.asyncIterator]()},async pull(i){try{const{value:s,done:a}=await n.next();if(a)return i.close();const o=r.encode(JSON.stringify(s)+`
`);i.enqueue(o)}catch(s){i.error(s)}},async cancel(){var i;await((i=n.return)==null?void 0:i.call(n))}})}}async function*Rl(e,t){if(!e.body)throw t.abort(),new L("Attempted to iterate over a response with no body");const n=new Ol,r=new Tn,i=ba(e.body);for await(const s of Tl(i))for(const a of r.decode(s)){const o=n.decode(a);o&&(yield o)}for(const s of r.flush()){const a=n.decode(s);a&&(yield a)}}async function*Tl(e){let t=new Uint8Array;for await(const n of e){if(n==null)continue;const r=n instanceof ArrayBuffer?new Uint8Array(n):typeof n=="string"?new TextEncoder().encode(n):n;let i=new Uint8Array(t.length+r.length);i.set(t),i.set(r,t.length),t=i;let s;for(;(s=vl(t))!==-1;)yield t.slice(0,s),t=t.slice(s)}t.length>0&&(yield t)}class Ol{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(t){if(t.endsWith("\r")&&(t=t.substring(0,t.length-1)),!t){if(!this.event&&!this.data.length)return null;const s={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],s}if(this.chunks.push(t),t.startsWith(":"))return null;let[n,r,i]=Nl(t,":");return i.startsWith(" ")&&(i=i.substring(1)),n==="event"?this.event=i:n==="data"&&this.data.push(i),null}}function Nl(e,t){const n=e.indexOf(t);return n!==-1?[e.substring(0,n),t,e.substring(n+t.length)]:[e,"",""]}const _a=e=>e!=null&&typeof e=="object"&&typeof e.url=="string"&&typeof e.blob=="function",ka=e=>e!=null&&typeof e=="object"&&typeof e.name=="string"&&typeof e.lastModified=="number"&&On(e),On=e=>e!=null&&typeof e=="object"&&typeof e.size=="number"&&typeof e.type=="string"&&typeof e.text=="function"&&typeof e.slice=="function"&&typeof e.arrayBuffer=="function",Fl=e=>ka(e)||_a(e)||la(e);async function Sa(e,t,n){var i;if(e=await e,ka(e))return e;if(_a(e)){const s=await e.blob();t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()??"unknown_file");const a=On(s)?[await s.arrayBuffer()]:[s];return new gr(a,t,n)}const r=await Ll(e);if(t||(t=Dl(e)??"unknown_file"),!(n!=null&&n.type)){const s=(i=r[0])==null?void 0:i.type;typeof s=="string"&&(n={...n,type:s})}return new gr(r,t,n)}async function Ll(e){var n;let t=[];if(typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(On(e))t.push(await e.arrayBuffer());else if(Bl(e))for await(const r of e)t.push(r);else throw new Error(`Unexpected data type: ${typeof e}; constructor: ${(n=e==null?void 0:e.constructor)==null?void 0:n.name}; props: ${Ml(e)}`);return t}function Ml(e){return`[${Object.getOwnPropertyNames(e).map(n=>`"${n}"`).join(", ")}]`}function Dl(e){var t;return Jn(e.name)||Jn(e.filename)||((t=Jn(e.path))==null?void 0:t.split(/[\\/]/).pop())}const Jn=e=>{if(typeof e=="string")return e;if(typeof Buffer<"u"&&e instanceof Buffer)return String(e)},Bl=e=>e!=null&&typeof e=="object"&&typeof e[Symbol.asyncIterator]=="function",ji=e=>e&&typeof e=="object"&&e.body&&e[Symbol.toStringTag]==="MultipartBody",_t=async e=>{const t=await $l(e.body);return sa(t,e)},$l=async e=>{const t=new ra;return await Promise.all(Object.entries(e||{}).map(([n,r])=>yr(t,n,r))),t},yr=async(e,t,n)=>{if(n!==void 0){if(n==null)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")e.append(t,String(n));else if(Fl(n)){const r=await Sa(n);e.append(t,r)}else if(Array.isArray(n))await Promise.all(n.map(r=>yr(e,t+"[]",r)));else if(typeof n=="object")await Promise.all(Object.entries(n).map(([r,i])=>yr(e,`${t}[${r}]`,i)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`)}};var gt={},zl=function(e,t,n,r,i){if(typeof t=="function"?e!==t||!0:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return t.set(e,n),n},jl=function(e,t,n,r){if(typeof t=="function"?e!==t||!0:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},rn;ua();async function Ca(e){var a;const{response:t}=e;if(e.options.stream)return Ke("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):Me.fromSSEResponse(t,e.controller);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const n=t.headers.get("content-type"),r=(a=n==null?void 0:n.split(";")[0])==null?void 0:a.trim();if((r==null?void 0:r.includes("application/json"))||(r==null?void 0:r.endsWith("+json"))){const o=await t.json();return Ke("response",t.status,t.url,t.headers,o),Ea(o,t)}const s=await t.text();return Ke("response",t.status,t.url,t.headers,s),s}function Ea(e,t){return!e||typeof e!="object"||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class Nn extends Promise{constructor(t,n=Ca){super(r=>{r(null)}),this.responsePromise=t,this.parseResponse=n}_thenUnwrap(t){return new Nn(this.responsePromise,async n=>Ea(t(await this.parseResponse(n),n),n.response))}asResponse(){return this.responsePromise.then(t=>t.response)}async withResponse(){const[t,n]=await Promise.all([this.parse(),this.asResponse()]);return{data:t,response:n,request_id:n.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(t,n){return this.parse().then(t,n)}catch(t){return this.parse().catch(t)}finally(t){return this.parse().finally(t)}}class Ul{constructor({baseURL:t,maxRetries:n=2,timeout:r=6e5,httpAgent:i,fetch:s}){this.baseURL=t,this.maxRetries=Kn("maxRetries",n),this.timeout=Kn("timeout",r),this.httpAgent=i,this.fetch=s??na}authHeaders(t){return{}}defaultHeaders(t){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...Xl(),...this.authHeaders(t)}}validateHeaders(t,n){}defaultIdempotencyKey(){return`stainless-node-retry-${Gl()}`}get(t,n){return this.methodRequest("get",t,n)}post(t,n){return this.methodRequest("post",t,n)}patch(t,n){return this.methodRequest("patch",t,n)}put(t,n){return this.methodRequest("put",t,n)}delete(t,n){return this.methodRequest("delete",t,n)}methodRequest(t,n,r){return this.request(Promise.resolve(r).then(async i=>{const s=i&&On(i==null?void 0:i.body)?new DataView(await i.body.arrayBuffer()):(i==null?void 0:i.body)instanceof DataView?i.body:(i==null?void 0:i.body)instanceof ArrayBuffer?new DataView(i.body):i&&ArrayBuffer.isView(i==null?void 0:i.body)?new DataView(i.body.buffer):i==null?void 0:i.body;return{method:t,path:n,...i,body:s}}))}getAPIList(t,n,r){return this.requestAPIList(n,{method:"get",path:t,...r})}calculateContentLength(t){if(typeof t=="string"){if(typeof Buffer<"u")return Buffer.byteLength(t,"utf8").toString();if(typeof TextEncoder<"u")return new TextEncoder().encode(t).length.toString()}else if(ArrayBuffer.isView(t))return t.byteLength.toString();return null}buildRequest(t,{retryCount:n=0}={}){var y;const r={...t},{method:i,path:s,query:a,headers:o={}}=r,l=ArrayBuffer.isView(r.body)||r.__binaryRequest&&typeof r.body=="string"?r.body:ji(r.body)?r.body.body:r.body?JSON.stringify(r.body,null,2):null,u=this.calculateContentLength(l),h=this.buildURL(s,a);"timeout"in r&&Kn("timeout",r.timeout),r.timeout=r.timeout??this.timeout;const c=r.httpAgent??this.httpAgent??aa(h),d=r.timeout+1e3;typeof((y=c==null?void 0:c.options)==null?void 0:y.timeout)=="number"&&d>(c.options.timeout??0)&&(c.options.timeout=d),this.idempotencyHeader&&i!=="get"&&(t.idempotencyKey||(t.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=t.idempotencyKey);const f=this.buildHeaders({options:r,headers:o,contentLength:u,retryCount:n});return{req:{method:i,...l&&{body:l},headers:f,...c&&{agent:c},signal:r.signal??null},url:h,timeout:r.timeout}}buildHeaders({options:t,headers:n,contentLength:r,retryCount:i}){const s={};r&&(s["content-length"]=r);const a=this.defaultHeaders(t);return qi(s,a),qi(s,n),ji(t.body)&&$t!=="node"&&delete s["content-type"],an(a,"x-stainless-retry-count")===void 0&&an(n,"x-stainless-retry-count")===void 0&&(s["x-stainless-retry-count"]=String(i)),an(a,"x-stainless-timeout")===void 0&&an(n,"x-stainless-timeout")===void 0&&t.timeout&&(s["x-stainless-timeout"]=String(Math.trunc(t.timeout/1e3))),this.validateHeaders(s,n),s}async prepareOptions(t){}async prepareRequest(t,{url:n,options:r}){}parseHeaders(t){return t?Symbol.iterator in t?Object.fromEntries(Array.from(t).map(n=>[...n])):{...t}:{}}makeStatusError(t,n,r,i){return ae.generate(t,n,r,i)}request(t,n=null){return new Nn(this.makeRequest(t,n))}async makeRequest(t,n){var c,d;const r=await t,i=r.maxRetries??this.maxRetries;n==null&&(n=i),await this.prepareOptions(r);const{req:s,url:a,timeout:o}=this.buildRequest(r,{retryCount:i-n});if(await this.prepareRequest(s,{url:a,options:r}),Ke("request",a,r,s.headers),(c=r.signal)!=null&&c.aborted)throw new ke;const l=new AbortController,u=await this.fetchWithTimeout(a,s,o,l).catch(wr);if(u instanceof Error){if((d=r.signal)!=null&&d.aborted)throw new ke;if(n)return this.retryRequest(r,n);throw u.name==="AbortError"?new Br:new Rn({cause:u})}const h=Pa(u.headers);if(!u.ok){if(n&&this.shouldRetry(u)){const S=`retrying, ${n} attempts remaining`;return Ke(`response (error; ${S})`,u.status,a,h),this.retryRequest(r,n,h)}const f=await u.text().catch(S=>wr(S).message),g=Jl(f),y=g?void 0:f;throw Ke(`response (error; ${n?"(error; no more retries left)":"(error; not retryable)"})`,u.status,a,h,y),this.makeStatusError(u.status,g,y,h)}return{response:u,options:r,controller:l}}requestAPIList(t,n){const r=this.makeRequest(n,null);return new Hl(this,r,t)}buildURL(t,n){const r=Ql(t)?new URL(t):new URL(this.baseURL+(this.baseURL.endsWith("/")&&t.startsWith("/")?t.slice(1):t)),i=this.defaultQuery();return Ia(i)||(n={...i,...n}),typeof n=="object"&&n&&!Array.isArray(n)&&(r.search=this.stringifyQuery(n)),r.toString()}stringifyQuery(t){return Object.entries(t).filter(([n,r])=>typeof r<"u").map(([n,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(n)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(n)}=`;throw new L(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(t,n,r,i){const{signal:s,...a}=n||{};s&&s.addEventListener("abort",()=>i.abort());const o=setTimeout(()=>i.abort(),r),l={signal:i.signal,...a};return l.method&&(l.method=l.method.toUpperCase()),this.fetch.call(void 0,t,l).finally(()=>{clearTimeout(o)})}shouldRetry(t){const n=t.headers.get("x-should-retry");return n==="true"?!0:n==="false"?!1:t.status===408||t.status===409||t.status===429||t.status>=500}async retryRequest(t,n,r){let i;const s=r==null?void 0:r["retry-after-ms"];if(s){const o=parseFloat(s);Number.isNaN(o)||(i=o)}const a=r==null?void 0:r["retry-after"];if(a&&!i){const o=parseFloat(a);Number.isNaN(o)?i=Date.parse(a)-Date.now():i=o*1e3}if(!(i&&0<=i&&i<60*1e3)){const o=t.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(n,o)}return await Xt(i),this.makeRequest(t,n-1)}calculateDefaultRetryTimeoutMillis(t,n){const s=n-t,a=Math.min(.5*Math.pow(2,s),8),o=1-Math.random()*.25;return a*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${dt}`}}class Aa{constructor(t,n,r,i){rn.set(this,void 0),zl(this,rn,t),this.options=i,this.response=n,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageInfo()!=null:!1}async getNextPage(){const t=this.nextPageInfo();if(!t)throw new L("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const n={...this.options};if("params"in t&&typeof n.query=="object")n.query={...n.query,...t.params};else if("url"in t){const r=[...Object.entries(n.query||{}),...t.url.searchParams.entries()];for(const[i,s]of r)t.url.searchParams.set(i,s);n.query=void 0,n.path=t.url.toString()}return await jl(this,rn,"f").requestAPIList(this.constructor,n)}async*iterPages(){let t=this;for(yield t;t.hasNextPage();)t=await t.getNextPage(),yield t}async*[(rn=new WeakMap,Symbol.asyncIterator)](){for await(const t of this.iterPages())for(const n of t.getPaginatedItems())yield n}}class Hl extends Nn{constructor(t,n,r){super(n,async i=>new r(t,i.response,await Ca(i),i.options))}async*[Symbol.asyncIterator](){const t=await this;for await(const n of t)yield n}}const Pa=e=>new Proxy(Object.fromEntries(e.entries()),{get(t,n){const r=n.toString();return t[r.toLowerCase()]||t[r]}}),Vl={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},Y=e=>typeof e=="object"&&e!==null&&!Ia(e)&&Object.keys(e).every(t=>va(Vl,t)),ql=()=>{var t;if(typeof Deno<"u"&&Deno.build!=null)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":dt,"X-Stainless-OS":Hi(Deno.build.os),"X-Stainless-Arch":Ui(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((t=Deno.version)==null?void 0:t.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":dt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":dt,"X-Stainless-OS":Hi(process.platform),"X-Stainless-Arch":Ui(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const e=Wl();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":dt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":dt,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Wl(){if(typeof navigator>"u"||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:n}of e){const r=n.exec(navigator.userAgent);if(r){const i=r[1]||0,s=r[2]||0,a=r[3]||0;return{browser:t,version:`${i}.${s}.${a}`}}}return null}const Ui=e=>e==="x32"?"x32":e==="x86_64"||e==="x64"?"x64":e==="arm"?"arm":e==="aarch64"||e==="arm64"?"arm64":e?`other:${e}`:"unknown",Hi=e=>(e=e.toLowerCase(),e.includes("ios")?"iOS":e==="android"?"Android":e==="darwin"?"MacOS":e==="win32"?"Windows":e==="freebsd"?"FreeBSD":e==="openbsd"?"OpenBSD":e==="linux"?"Linux":e?`Other:${e}`:"Unknown");let Vi;const Xl=()=>Vi??(Vi=ql()),Jl=e=>{try{return JSON.parse(e)}catch{return}},Kl=/^[a-z][a-z0-9+.-]*:/i,Ql=e=>Kl.test(e),Xt=e=>new Promise(t=>setTimeout(t,e)),Kn=(e,t)=>{if(typeof t!="number"||!Number.isInteger(t))throw new L(`${e} must be an integer`);if(t<0)throw new L(`${e} must be a positive integer`);return t},wr=e=>{if(e instanceof Error)return e;if(typeof e=="object"&&e!==null)try{return new Error(JSON.stringify(e))}catch{}return new Error(e)},sn=e=>{var t,n,r,i;if(typeof process<"u")return((t=gt==null?void 0:gt[e])==null?void 0:t.trim())??void 0;if(typeof Deno<"u")return(i=(r=(n=Deno.env)==null?void 0:n.get)==null?void 0:r.call(n,e))==null?void 0:i.trim()};function Ia(e){if(!e)return!0;for(const t in e)return!1;return!0}function va(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function qi(e,t){for(const n in t){if(!va(t,n))continue;const r=n.toLowerCase();if(!r)continue;const i=t[n];i===null?delete e[r]:i!==void 0&&(e[r]=i)}}const Wi=new Set(["authorization","api-key"]);function Ke(e,...t){if(typeof process<"u"&&(gt==null?void 0:gt.DEBUG)==="true"){const n=t.map(r=>{if(!r)return r;if(r.headers){const s={...r,headers:{...r.headers}};for(const a in r.headers)Wi.has(a.toLowerCase())&&(s.headers[a]="REDACTED");return s}let i=null;for(const s in r)Wi.has(s.toLowerCase())&&(i??(i={...r}),i[s]="REDACTED");return i??r});console.log(`OpenAI:DEBUG:${e}`,...n)}}const Gl=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)}),Yl=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u",Zl=e=>typeof(e==null?void 0:e.get)=="function",an=(e,t)=>{var r;const n=t.toLowerCase();if(Zl(e)){const i=((r=t[0])==null?void 0:r.toUpperCase())+t.substring(1).replace(/([^\w])(\w)/g,(s,a,o)=>a+o.toUpperCase());for(const s of[t,n,t.toUpperCase(),i]){const a=e.get(s);if(a)return a}}for(const[i,s]of Object.entries(e))if(i.toLowerCase()===n)return Array.isArray(s)?(s.length<=1||console.warn(`Received ${s.length} entries for the ${t} header, using the first entry.`),s[0]):s},eu=e=>{if(typeof Buffer<"u"){const t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}else{const t=atob(e),n=t.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=t.charCodeAt(i);return Array.from(new Float32Array(r.buffer))}};function Qn(e){return e!=null&&typeof e=="object"&&!Array.isArray(e)}class Fn extends Aa{constructor(t,n,r,i){super(t,n,r,i),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class oe extends Aa{constructor(t,n,r,i){super(t,n,r,i),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageParams(){const t=this.nextPageInfo();if(!t)return null;if("params"in t)return t.params;const n=Object.fromEntries(t.url.searchParams);return Object.keys(n).length?n:null}nextPageInfo(){var r;const t=this.getPaginatedItems();if(!t.length)return null;const n=(r=t[t.length-1])==null?void 0:r.id;return n?{params:{after:n}}:null}}class z{constructor(t){this._client=t}}let Ra=class extends z{list(t,n={},r){return Y(n)?this.list(t,{},n):this._client.getAPIList(`/chat/completions/${t}/messages`,tu,{query:n,...r})}},Ln=class extends z{constructor(){super(...arguments),this.messages=new Ra(this._client)}create(t,n){return this._client.post("/chat/completions",{body:t,...n,stream:t.stream??!1})}retrieve(t,n){return this._client.get(`/chat/completions/${t}`,n)}update(t,n,r){return this._client.post(`/chat/completions/${t}`,{body:n,...r})}list(t={},n){return Y(t)?this.list({},t):this._client.getAPIList("/chat/completions",Mn,{query:t,...n})}del(t,n){return this._client.delete(`/chat/completions/${t}`,n)}};class Mn extends oe{}class tu extends oe{}Ln.ChatCompletionsPage=Mn;Ln.Messages=Ra;let Dn=class extends z{constructor(){super(...arguments),this.completions=new Ln(this._client)}};Dn.Completions=Ln;Dn.ChatCompletionsPage=Mn;class Ta extends z{create(t,n){return this._client.post("/audio/speech",{body:t,...n,headers:{Accept:"application/octet-stream",...n==null?void 0:n.headers},__binaryResponse:!0})}}class Oa extends z{create(t,n){return this._client.post("/audio/transcriptions",_t({body:t,...n,stream:t.stream??!1,__metadata:{model:t.model}}))}}class Na extends z{create(t,n){return this._client.post("/audio/translations",_t({body:t,...n,__metadata:{model:t.model}}))}}class Jt extends z{constructor(){super(...arguments),this.transcriptions=new Oa(this._client),this.translations=new Na(this._client),this.speech=new Ta(this._client)}}Jt.Transcriptions=Oa;Jt.Translations=Na;Jt.Speech=Ta;class $r extends z{create(t,n){return this._client.post("/batches",{body:t,...n})}retrieve(t,n){return this._client.get(`/batches/${t}`,n)}list(t={},n){return Y(t)?this.list({},t):this._client.getAPIList("/batches",zr,{query:t,...n})}cancel(t,n){return this._client.post(`/batches/${t}/cancel`,n)}}class zr extends oe{}$r.BatchesPage=zr;var Pe=function(e,t,n,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(e,n):i?i.value=n:t.set(e,n),n},Q=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},xr,mn,gn,Nt,Ft,yn,Lt,He,Mt,Cn,En,pt,Fa;class jr{constructor(){xr.add(this),this.controller=new AbortController,mn.set(this,void 0),gn.set(this,()=>{}),Nt.set(this,()=>{}),Ft.set(this,void 0),yn.set(this,()=>{}),Lt.set(this,()=>{}),He.set(this,{}),Mt.set(this,!1),Cn.set(this,!1),En.set(this,!1),pt.set(this,!1),Pe(this,mn,new Promise((t,n)=>{Pe(this,gn,t,"f"),Pe(this,Nt,n,"f")}),"f"),Pe(this,Ft,new Promise((t,n)=>{Pe(this,yn,t,"f"),Pe(this,Lt,n,"f")}),"f"),Q(this,mn,"f").catch(()=>{}),Q(this,Ft,"f").catch(()=>{})}_run(t){setTimeout(()=>{t().then(()=>{this._emitFinal(),this._emit("end")},Q(this,xr,"m",Fa).bind(this))},0)}_connected(){this.ended||(Q(this,gn,"f").call(this),this._emit("connect"))}get ended(){return Q(this,Mt,"f")}get errored(){return Q(this,Cn,"f")}get aborted(){return Q(this,En,"f")}abort(){this.controller.abort()}on(t,n){return(Q(this,He,"f")[t]||(Q(this,He,"f")[t]=[])).push({listener:n}),this}off(t,n){const r=Q(this,He,"f")[t];if(!r)return this;const i=r.findIndex(s=>s.listener===n);return i>=0&&r.splice(i,1),this}once(t,n){return(Q(this,He,"f")[t]||(Q(this,He,"f")[t]=[])).push({listener:n,once:!0}),this}emitted(t){return new Promise((n,r)=>{Pe(this,pt,!0,"f"),t!=="error"&&this.once("error",r),this.once(t,n)})}async done(){Pe(this,pt,!0,"f"),await Q(this,Ft,"f")}_emit(t,...n){if(Q(this,Mt,"f"))return;t==="end"&&(Pe(this,Mt,!0,"f"),Q(this,yn,"f").call(this));const r=Q(this,He,"f")[t];if(r&&(Q(this,He,"f")[t]=r.filter(i=>!i.once),r.forEach(({listener:i})=>i(...n))),t==="abort"){const i=n[0];!Q(this,pt,"f")&&!(r!=null&&r.length)&&Promise.reject(i),Q(this,Nt,"f").call(this,i),Q(this,Lt,"f").call(this,i),this._emit("end");return}if(t==="error"){const i=n[0];!Q(this,pt,"f")&&!(r!=null&&r.length)&&Promise.reject(i),Q(this,Nt,"f").call(this,i),Q(this,Lt,"f").call(this,i),this._emit("end")}}_emitFinal(){}}mn=new WeakMap,gn=new WeakMap,Nt=new WeakMap,Ft=new WeakMap,yn=new WeakMap,Lt=new WeakMap,He=new WeakMap,Mt=new WeakMap,Cn=new WeakMap,En=new WeakMap,pt=new WeakMap,xr=new WeakSet,Fa=function(t){if(Pe(this,Cn,!0,"f"),t instanceof Error&&t.name==="AbortError"&&(t=new ke),t instanceof ke)return Pe(this,En,!0,"f"),this._emit("abort",t);if(t instanceof L)return this._emit("error",t);if(t instanceof Error){const n=new L(t.message);return n.cause=t,this._emit("error",n)}return this._emit("error",new L(String(t)))};var R=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},ge=function(e,t,n,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(e,n):i?i.value=n:t.set(e,n),n},se,br,Fe,wn,Ie,rt,mt,tt,An,xe,xn,bn,zt,Dt,Bt,Xi,Ji,Ki,Qi,Gi,Yi,Zi;class ve extends jr{constructor(){super(...arguments),se.add(this),br.set(this,[]),Fe.set(this,{}),wn.set(this,{}),Ie.set(this,void 0),rt.set(this,void 0),mt.set(this,void 0),tt.set(this,void 0),An.set(this,void 0),xe.set(this,void 0),xn.set(this,void 0),bn.set(this,void 0),zt.set(this,void 0)}[(br=new WeakMap,Fe=new WeakMap,wn=new WeakMap,Ie=new WeakMap,rt=new WeakMap,mt=new WeakMap,tt=new WeakMap,An=new WeakMap,xe=new WeakMap,xn=new WeakMap,bn=new WeakMap,zt=new WeakMap,se=new WeakSet,Symbol.asyncIterator)](){const t=[],n=[];let r=!1;return this.on("event",i=>{const s=n.shift();s?s.resolve(i):t.push(i)}),this.on("end",()=>{r=!0;for(const i of n)i.resolve(void 0);n.length=0}),this.on("abort",i=>{r=!0;for(const s of n)s.reject(i);n.length=0}),this.on("error",i=>{r=!0;for(const s of n)s.reject(i);n.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((s,a)=>n.push({resolve:s,reject:a})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(t){const n=new ve;return n._run(()=>n._fromReadableStream(t)),n}async _fromReadableStream(t,n){var s;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const i=Me.fromReadableStream(t,this.controller);for await(const a of i)R(this,se,"m",Dt).call(this,a);if((s=i.controller.signal)!=null&&s.aborted)throw new ke;return this._addRun(R(this,se,"m",Bt).call(this))}toReadableStream(){return new Me(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(t,n,r,i,s){const a=new ve;return a._run(()=>a._runToolAssistantStream(t,n,r,i,{...s,headers:{...s==null?void 0:s.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(t,n,r,i,s){var u;const a=s==null?void 0:s.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const o={...i,stream:!0},l=await t.submitToolOutputs(n,r,o,{...s,signal:this.controller.signal});this._connected();for await(const h of l)R(this,se,"m",Dt).call(this,h);if((u=l.controller.signal)!=null&&u.aborted)throw new ke;return this._addRun(R(this,se,"m",Bt).call(this))}static createThreadAssistantStream(t,n,r){const i=new ve;return i._run(()=>i._threadAssistantStream(t,n,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),i}static createAssistantStream(t,n,r,i){const s=new ve;return s._run(()=>s._runAssistantStream(t,n,r,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),s}currentEvent(){return R(this,xn,"f")}currentRun(){return R(this,bn,"f")}currentMessageSnapshot(){return R(this,Ie,"f")}currentRunStepSnapshot(){return R(this,zt,"f")}async finalRunSteps(){return await this.done(),Object.values(R(this,Fe,"f"))}async finalMessages(){return await this.done(),Object.values(R(this,wn,"f"))}async finalRun(){if(await this.done(),!R(this,rt,"f"))throw Error("Final run was not received.");return R(this,rt,"f")}async _createThreadAssistantStream(t,n,r){var o;const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const s={...n,stream:!0},a=await t.createAndRun(s,{...r,signal:this.controller.signal});this._connected();for await(const l of a)R(this,se,"m",Dt).call(this,l);if((o=a.controller.signal)!=null&&o.aborted)throw new ke;return this._addRun(R(this,se,"m",Bt).call(this))}async _createAssistantStream(t,n,r,i){var l;const s=i==null?void 0:i.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));const a={...r,stream:!0},o=await t.create(n,a,{...i,signal:this.controller.signal});this._connected();for await(const u of o)R(this,se,"m",Dt).call(this,u);if((l=o.controller.signal)!=null&&l.aborted)throw new ke;return this._addRun(R(this,se,"m",Bt).call(this))}static accumulateDelta(t,n){for(const[r,i]of Object.entries(n)){if(!t.hasOwnProperty(r)){t[r]=i;continue}let s=t[r];if(s==null){t[r]=i;continue}if(r==="index"||r==="type"){t[r]=i;continue}if(typeof s=="string"&&typeof i=="string")s+=i;else if(typeof s=="number"&&typeof i=="number")s+=i;else if(Qn(s)&&Qn(i))s=this.accumulateDelta(s,i);else if(Array.isArray(s)&&Array.isArray(i)){if(s.every(a=>typeof a=="string"||typeof a=="number")){s.push(...i);continue}for(const a of i){if(!Qn(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);const o=a.index;if(o==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const l=s[o];l==null?s.push(a):s[o]=this.accumulateDelta(l,a)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${i}, accValue: ${s}`);t[r]=s}return t}_addRun(t){return t}async _threadAssistantStream(t,n,r){return await this._createThreadAssistantStream(n,t,r)}async _runAssistantStream(t,n,r,i){return await this._createAssistantStream(n,t,r,i)}async _runToolAssistantStream(t,n,r,i,s){return await this._createToolAssistantStream(r,t,n,i,s)}}Dt=function(t){if(!this.ended)switch(ge(this,xn,t,"f"),R(this,se,"m",Ki).call(this,t),t.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":R(this,se,"m",Zi).call(this,t);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":R(this,se,"m",Ji).call(this,t);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":R(this,se,"m",Xi).call(this,t);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},Bt=function(){if(this.ended)throw new L("stream has ended, this shouldn't happen");if(!R(this,rt,"f"))throw Error("Final run has not been received");return R(this,rt,"f")},Xi=function(t){const[n,r]=R(this,se,"m",Gi).call(this,t,R(this,Ie,"f"));ge(this,Ie,n,"f"),R(this,wn,"f")[n.id]=n;for(const i of r){const s=n.content[i.index];(s==null?void 0:s.type)=="text"&&this._emit("textCreated",s.text)}switch(t.event){case"thread.message.created":this._emit("messageCreated",t.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",t.data.delta,n),t.data.delta.content)for(const i of t.data.delta.content){if(i.type=="text"&&i.text){let s=i.text,a=n.content[i.index];if(a&&a.type=="text")this._emit("textDelta",s,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(i.index!=R(this,mt,"f")){if(R(this,tt,"f"))switch(R(this,tt,"f").type){case"text":this._emit("textDone",R(this,tt,"f").text,R(this,Ie,"f"));break;case"image_file":this._emit("imageFileDone",R(this,tt,"f").image_file,R(this,Ie,"f"));break}ge(this,mt,i.index,"f")}ge(this,tt,n.content[i.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(R(this,mt,"f")!==void 0){const i=t.data.content[R(this,mt,"f")];if(i)switch(i.type){case"image_file":this._emit("imageFileDone",i.image_file,R(this,Ie,"f"));break;case"text":this._emit("textDone",i.text,R(this,Ie,"f"));break}}R(this,Ie,"f")&&this._emit("messageDone",t.data),ge(this,Ie,void 0,"f")}},Ji=function(t){const n=R(this,se,"m",Qi).call(this,t);switch(ge(this,zt,n,"f"),t.event){case"thread.run.step.created":this._emit("runStepCreated",t.data);break;case"thread.run.step.delta":const r=t.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&n.step_details.type=="tool_calls")for(const s of r.step_details.tool_calls)s.index==R(this,An,"f")?this._emit("toolCallDelta",s,n.step_details.tool_calls[s.index]):(R(this,xe,"f")&&this._emit("toolCallDone",R(this,xe,"f")),ge(this,An,s.index,"f"),ge(this,xe,n.step_details.tool_calls[s.index],"f"),R(this,xe,"f")&&this._emit("toolCallCreated",R(this,xe,"f")));this._emit("runStepDelta",t.data.delta,n);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":ge(this,zt,void 0,"f"),t.data.step_details.type=="tool_calls"&&R(this,xe,"f")&&(this._emit("toolCallDone",R(this,xe,"f")),ge(this,xe,void 0,"f")),this._emit("runStepDone",t.data,n);break}},Ki=function(t){R(this,br,"f").push(t),this._emit("event",t)},Qi=function(t){switch(t.event){case"thread.run.step.created":return R(this,Fe,"f")[t.data.id]=t.data,t.data;case"thread.run.step.delta":let n=R(this,Fe,"f")[t.data.id];if(!n)throw Error("Received a RunStepDelta before creation of a snapshot");let r=t.data;if(r.delta){const i=ve.accumulateDelta(n,r.delta);R(this,Fe,"f")[t.data.id]=i}return R(this,Fe,"f")[t.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":R(this,Fe,"f")[t.data.id]=t.data;break}if(R(this,Fe,"f")[t.data.id])return R(this,Fe,"f")[t.data.id];throw new Error("No snapshot available")},Gi=function(t,n){let r=[];switch(t.event){case"thread.message.created":return[t.data,r];case"thread.message.delta":if(!n)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let i=t.data;if(i.delta.content)for(const s of i.delta.content)if(s.index in n.content){let a=n.content[s.index];n.content[s.index]=R(this,se,"m",Yi).call(this,s,a)}else n.content[s.index]=s,r.push(s);return[n,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(n)return[n,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Yi=function(t,n){return ve.accumulateDelta(n,t)},Zi=function(t){switch(ge(this,bn,t.data,"f"),t.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":ge(this,rt,t.data,"f"),R(this,xe,"f")&&(this._emit("toolCallDone",R(this,xe,"f")),ge(this,xe,void 0,"f"));break}};class Ur extends z{create(t,n){return this._client.post("/assistants",{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(t,n){return this._client.get(`/assistants/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(t,n,r){return this._client.post(`/assistants/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(t={},n){return Y(t)?this.list({},t):this._client.getAPIList("/assistants",Hr,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(t,n){return this._client.delete(`/assistants/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Hr extends oe{}Ur.AssistantsPage=Hr;function es(e){return typeof e.parse=="function"}const yt=e=>(e==null?void 0:e.role)==="assistant",La=e=>(e==null?void 0:e.role)==="function",Ma=e=>(e==null?void 0:e.role)==="tool";function Vr(e){return(e==null?void 0:e.$brand)==="auto-parseable-response-format"}function Kt(e){return(e==null?void 0:e.$brand)==="auto-parseable-tool"}function nu(e,t){return!t||!Da(t)?{...e,choices:e.choices.map(n=>({...n,message:{...n.message,parsed:null,...n.message.tool_calls?{tool_calls:n.message.tool_calls}:void 0}}))}:qr(e,t)}function qr(e,t){const n=e.choices.map(r=>{var i;if(r.finish_reason==="length")throw new wa;if(r.finish_reason==="content_filter")throw new xa;return{...r,message:{...r.message,...r.message.tool_calls?{tool_calls:((i=r.message.tool_calls)==null?void 0:i.map(s=>iu(t,s)))??void 0}:void 0,parsed:r.message.content&&!r.message.refusal?ru(t,r.message.content):null}}});return{...e,choices:n}}function ru(e,t){var n,r;return((n=e.response_format)==null?void 0:n.type)!=="json_schema"?null:((r=e.response_format)==null?void 0:r.type)==="json_schema"?"$parseRaw"in e.response_format?e.response_format.$parseRaw(t):JSON.parse(t):null}function iu(e,t){var r;const n=(r=e.tools)==null?void 0:r.find(i=>{var s;return((s=i.function)==null?void 0:s.name)===t.function.name});return{...t,function:{...t.function,parsed_arguments:Kt(n)?n.$parseRaw(t.function.arguments):n!=null&&n.function.strict?JSON.parse(t.function.arguments):null}}}function su(e,t){var r;if(!e)return!1;const n=(r=e.tools)==null?void 0:r.find(i=>{var s;return((s=i.function)==null?void 0:s.name)===t.function.name});return Kt(n)||(n==null?void 0:n.function.strict)||!1}function Da(e){var t;return Vr(e.response_format)?!0:((t=e.tools)==null?void 0:t.some(n=>Kt(n)||n.type==="function"&&n.function.strict===!0))??!1}function au(e){for(const t of e??[]){if(t.type!=="function")throw new L(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(t.function.strict!==!0)throw new L(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var he=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},ue,_r,Pn,kr,Sr,Cr,Ba,Er;const ts=10;class $a extends jr{constructor(){super(...arguments),ue.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(t){var r;this._chatCompletions.push(t),this._emit("chatCompletion",t);const n=(r=t.choices[0])==null?void 0:r.message;return n&&this._addMessage(n),t}_addMessage(t,n=!0){if("content"in t||(t.content=null),this.messages.push(t),n){if(this._emit("message",t),(La(t)||Ma(t))&&t.content)this._emit("functionCallResult",t.content);else if(yt(t)&&t.function_call)this._emit("functionCall",t.function_call);else if(yt(t)&&t.tool_calls)for(const r of t.tool_calls)r.type==="function"&&this._emit("functionCall",r.function)}}async finalChatCompletion(){await this.done();const t=this._chatCompletions[this._chatCompletions.length-1];if(!t)throw new L("stream ended without producing a ChatCompletion");return t}async finalContent(){return await this.done(),he(this,ue,"m",_r).call(this)}async finalMessage(){return await this.done(),he(this,ue,"m",Pn).call(this)}async finalFunctionCall(){return await this.done(),he(this,ue,"m",kr).call(this)}async finalFunctionCallResult(){return await this.done(),he(this,ue,"m",Sr).call(this)}async totalUsage(){return await this.done(),he(this,ue,"m",Cr).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const t=this._chatCompletions[this._chatCompletions.length-1];t&&this._emit("finalChatCompletion",t);const n=he(this,ue,"m",Pn).call(this);n&&this._emit("finalMessage",n);const r=he(this,ue,"m",_r).call(this);r&&this._emit("finalContent",r);const i=he(this,ue,"m",kr).call(this);i&&this._emit("finalFunctionCall",i);const s=he(this,ue,"m",Sr).call(this);s!=null&&this._emit("finalFunctionCallResult",s),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",he(this,ue,"m",Cr).call(this))}async _createChatCompletion(t,n,r){const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),he(this,ue,"m",Ba).call(this,n);const s=await t.chat.completions.create({...n,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(qr(s,n))}async _runChatCompletion(t,n,r){for(const i of n.messages)this._addMessage(i,!1);return await this._createChatCompletion(t,n,r)}async _runFunctions(t,n,r){var d;const i="function",{function_call:s="auto",stream:a,...o}=n,l=typeof s!="string"&&(s==null?void 0:s.name),{maxChatCompletions:u=ts}=r||{},h={};for(const f of n.functions)h[f.name||f.function.name]=f;const c=n.functions.map(f=>({name:f.name||f.function.name,parameters:f.parameters,description:f.description}));for(const f of n.messages)this._addMessage(f,!1);for(let f=0;f<u;++f){const y=(d=(await this._createChatCompletion(t,{...o,function_call:s,functions:c,messages:[...this.messages]},r)).choices[0])==null?void 0:d.message;if(!y)throw new L("missing message in ChatCompletion response");if(!y.function_call)return;const{name:k,arguments:_}=y.function_call,S=h[k];if(S){if(l&&l!==k){const w=`Invalid function_call: ${JSON.stringify(k)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:i,name:k,content:w});continue}}else{const w=`Invalid function_call: ${JSON.stringify(k)}. Available options are: ${c.map(I=>JSON.stringify(I.name)).join(", ")}. Please try again`;this._addMessage({role:i,name:k,content:w});continue}let b;try{b=es(S)?await S.parse(_):_}catch(w){this._addMessage({role:i,name:k,content:w instanceof Error?w.message:String(w)});continue}const P=await S.function(b,this),O=he(this,ue,"m",Er).call(this,P);if(this._addMessage({role:i,name:k,content:O}),l)return}}async _runTools(t,n,r){var f,g,y;const i="tool",{tool_choice:s="auto",stream:a,...o}=n,l=typeof s!="string"&&((f=s==null?void 0:s.function)==null?void 0:f.name),{maxChatCompletions:u=ts}=r||{},h=n.tools.map(k=>{if(Kt(k)){if(!k.$callback)throw new L("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:k.$callback,name:k.function.name,description:k.function.description||"",parameters:k.function.parameters,parse:k.$parseRaw,strict:!0}}}return k}),c={};for(const k of h)k.type==="function"&&(c[k.function.name||k.function.function.name]=k.function);const d="tools"in n?h.map(k=>k.type==="function"?{type:"function",function:{name:k.function.name||k.function.function.name,parameters:k.function.parameters,description:k.function.description,strict:k.function.strict}}:k):void 0;for(const k of n.messages)this._addMessage(k,!1);for(let k=0;k<u;++k){const S=(g=(await this._createChatCompletion(t,{...o,tool_choice:s,tools:d,messages:[...this.messages]},r)).choices[0])==null?void 0:g.message;if(!S)throw new L("missing message in ChatCompletion response");if(!((y=S.tool_calls)!=null&&y.length))return;for(const b of S.tool_calls){if(b.type!=="function")continue;const P=b.id,{name:O,arguments:w}=b.function,I=c[O];if(I){if(l&&l!==O){const E=`Invalid tool_call: ${JSON.stringify(O)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:i,tool_call_id:P,content:E});continue}}else{const E=`Invalid tool_call: ${JSON.stringify(O)}. Available options are: ${Object.keys(c).map(v=>JSON.stringify(v)).join(", ")}. Please try again`;this._addMessage({role:i,tool_call_id:P,content:E});continue}let j;try{j=es(I)?await I.parse(w):w}catch(E){const v=E instanceof Error?E.message:String(E);this._addMessage({role:i,tool_call_id:P,content:v});continue}const N=await I.function(j,this),F=he(this,ue,"m",Er).call(this,N);if(this._addMessage({role:i,tool_call_id:P,content:F}),l)return}}}}ue=new WeakSet,_r=function(){return he(this,ue,"m",Pn).call(this).content??null},Pn=function(){let t=this.messages.length;for(;t-- >0;){const n=this.messages[t];if(yt(n)){const{function_call:r,...i}=n,s={...i,content:n.content??null,refusal:n.refusal??null};return r&&(s.function_call=r),s}}throw new L("stream ended without producing a ChatCompletionMessage with role=assistant")},kr=function(){var t,n;for(let r=this.messages.length-1;r>=0;r--){const i=this.messages[r];if(yt(i)&&(i!=null&&i.function_call))return i.function_call;if(yt(i)&&((t=i==null?void 0:i.tool_calls)!=null&&t.length))return(n=i.tool_calls.at(-1))==null?void 0:n.function}},Sr=function(){for(let t=this.messages.length-1;t>=0;t--){const n=this.messages[t];if(La(n)&&n.content!=null||Ma(n)&&n.content!=null&&typeof n.content=="string"&&this.messages.some(r=>{var i;return r.role==="assistant"&&((i=r.tool_calls)==null?void 0:i.some(s=>s.type==="function"&&s.id===n.tool_call_id))}))return n.content}},Cr=function(){const t={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:n}of this._chatCompletions)n&&(t.completion_tokens+=n.completion_tokens,t.prompt_tokens+=n.prompt_tokens,t.total_tokens+=n.total_tokens);return t},Ba=function(t){if(t.n!=null&&t.n>1)throw new L("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Er=function(t){return typeof t=="string"?t:t===void 0?"undefined":JSON.stringify(t)};class Vt extends $a{static runFunctions(t,n,r){const i=new Vt,s={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return i._run(()=>i._runFunctions(t,n,s)),i}static runTools(t,n,r){const i=new Vt,s={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(t,n,s)),i}_addMessage(t,n=!0){super._addMessage(t,n),yt(t)&&t.content&&this._emit("content",t.content)}}const za=1,ja=2,Ua=4,Ha=8,Va=16,qa=32,Wa=64,Xa=128,Ja=256,Ka=Xa|Ja,Qa=Va|qa|Ka|Wa,Ga=za|ja|Qa,Ya=Ua|Ha,ou=Ga|Ya,ne={STR:za,NUM:ja,ARR:Ua,OBJ:Ha,NULL:Va,BOOL:qa,NAN:Wa,INFINITY:Xa,MINUS_INFINITY:Ja,INF:Ka,SPECIAL:Qa,ATOM:Ga,COLLECTION:Ya,ALL:ou};class lu extends Error{}class uu extends Error{}function cu(e,t=ne.ALL){if(typeof e!="string")throw new TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw new Error(`${e} is empty`);return hu(e.trim(),t)}const hu=(e,t)=>{const n=e.length;let r=0;const i=d=>{throw new lu(`${d} at position ${r}`)},s=d=>{throw new uu(`${d} at position ${r}`)},a=()=>(c(),r>=n&&i("Unexpected end of input"),e[r]==='"'?o():e[r]==="{"?l():e[r]==="["?u():e.substring(r,r+4)==="null"||ne.NULL&t&&n-r<4&&"null".startsWith(e.substring(r))?(r+=4,null):e.substring(r,r+4)==="true"||ne.BOOL&t&&n-r<4&&"true".startsWith(e.substring(r))?(r+=4,!0):e.substring(r,r+5)==="false"||ne.BOOL&t&&n-r<5&&"false".startsWith(e.substring(r))?(r+=5,!1):e.substring(r,r+8)==="Infinity"||ne.INFINITY&t&&n-r<8&&"Infinity".startsWith(e.substring(r))?(r+=8,1/0):e.substring(r,r+9)==="-Infinity"||ne.MINUS_INFINITY&t&&1<n-r&&n-r<9&&"-Infinity".startsWith(e.substring(r))?(r+=9,-1/0):e.substring(r,r+3)==="NaN"||ne.NAN&t&&n-r<3&&"NaN".startsWith(e.substring(r))?(r+=3,NaN):h()),o=()=>{const d=r;let f=!1;for(r++;r<n&&(e[r]!=='"'||f&&e[r-1]==="\\");)f=e[r]==="\\"?!f:!1,r++;if(e.charAt(r)=='"')try{return JSON.parse(e.substring(d,++r-Number(f)))}catch(g){s(String(g))}else if(ne.STR&t)try{return JSON.parse(e.substring(d,r-Number(f))+'"')}catch{return JSON.parse(e.substring(d,e.lastIndexOf("\\"))+'"')}i("Unterminated string literal")},l=()=>{r++,c();const d={};try{for(;e[r]!=="}";){if(c(),r>=n&&ne.OBJ&t)return d;const f=o();c(),r++;try{const g=a();Object.defineProperty(d,f,{value:g,writable:!0,enumerable:!0,configurable:!0})}catch(g){if(ne.OBJ&t)return d;throw g}c(),e[r]===","&&r++}}catch{if(ne.OBJ&t)return d;i("Expected '}' at end of object")}return r++,d},u=()=>{r++;const d=[];try{for(;e[r]!=="]";)d.push(a()),c(),e[r]===","&&r++}catch{if(ne.ARR&t)return d;i("Expected ']' at end of array")}return r++,d},h=()=>{if(r===0){e==="-"&&ne.NUM&t&&i("Not sure what '-' is");try{return JSON.parse(e)}catch(f){if(ne.NUM&t)try{return e[e.length-1]==="."?JSON.parse(e.substring(0,e.lastIndexOf("."))):JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch{}s(String(f))}}const d=r;for(e[r]==="-"&&r++;e[r]&&!",]}".includes(e[r]);)r++;r==n&&!(ne.NUM&t)&&i("Unterminated number literal");try{return JSON.parse(e.substring(d,r))}catch{e.substring(d,r)==="-"&&ne.NUM&t&&i("Not sure what '-' is");try{return JSON.parse(e.substring(d,e.lastIndexOf("e")))}catch(g){s(String(g))}}},c=()=>{for(;r<n&&` 
\r	`.includes(e[r]);)r++};return a()},ns=e=>cu(e,ne.ALL^ne.NUM);var lt=function(e,t,n,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(e,n):i?i.value=n:t.set(e,n),n},W=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},ee,Ue,ut,qe,Gn,on,Yn,Zn,er,ln,tr,rs;class qt extends $a{constructor(t){super(),ee.add(this),Ue.set(this,void 0),ut.set(this,void 0),qe.set(this,void 0),lt(this,Ue,t,"f"),lt(this,ut,[],"f")}get currentChatCompletionSnapshot(){return W(this,qe,"f")}static fromReadableStream(t){const n=new qt(null);return n._run(()=>n._fromReadableStream(t)),n}static createChatCompletion(t,n,r){const i=new qt(n);return i._run(()=>i._runChatCompletion(t,{...n,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createChatCompletion(t,n,r){var a;super._createChatCompletion;const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),W(this,ee,"m",Gn).call(this);const s=await t.chat.completions.create({...n,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of s)W(this,ee,"m",Yn).call(this,o);if((a=s.controller.signal)!=null&&a.aborted)throw new ke;return this._addChatCompletion(W(this,ee,"m",ln).call(this))}async _fromReadableStream(t,n){var a;const r=n==null?void 0:n.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),W(this,ee,"m",Gn).call(this),this._connected();const i=Me.fromReadableStream(t,this.controller);let s;for await(const o of i)s&&s!==o.id&&this._addChatCompletion(W(this,ee,"m",ln).call(this)),W(this,ee,"m",Yn).call(this,o),s=o.id;if((a=i.controller.signal)!=null&&a.aborted)throw new ke;return this._addChatCompletion(W(this,ee,"m",ln).call(this))}[(Ue=new WeakMap,ut=new WeakMap,qe=new WeakMap,ee=new WeakSet,Gn=function(){this.ended||lt(this,qe,void 0,"f")},on=function(n){let r=W(this,ut,"f")[n.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},W(this,ut,"f")[n.index]=r,r)},Yn=function(n){var i,s,a,o,l,u,h,c,d,f,g,y,k,_,S;if(this.ended)return;const r=W(this,ee,"m",rs).call(this,n);this._emit("chunk",n,r);for(const b of n.choices){const P=r.choices[b.index];b.delta.content!=null&&((i=P.message)==null?void 0:i.role)==="assistant"&&((s=P.message)!=null&&s.content)&&(this._emit("content",b.delta.content,P.message.content),this._emit("content.delta",{delta:b.delta.content,snapshot:P.message.content,parsed:P.message.parsed})),b.delta.refusal!=null&&((a=P.message)==null?void 0:a.role)==="assistant"&&((o=P.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:b.delta.refusal,snapshot:P.message.refusal}),((l=b.logprobs)==null?void 0:l.content)!=null&&((u=P.message)==null?void 0:u.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(h=b.logprobs)==null?void 0:h.content,snapshot:((c=P.logprobs)==null?void 0:c.content)??[]}),((d=b.logprobs)==null?void 0:d.refusal)!=null&&((f=P.message)==null?void 0:f.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(g=b.logprobs)==null?void 0:g.refusal,snapshot:((y=P.logprobs)==null?void 0:y.refusal)??[]});const O=W(this,ee,"m",on).call(this,P);P.finish_reason&&(W(this,ee,"m",er).call(this,P),O.current_tool_call_index!=null&&W(this,ee,"m",Zn).call(this,P,O.current_tool_call_index));for(const w of b.delta.tool_calls??[])O.current_tool_call_index!==w.index&&(W(this,ee,"m",er).call(this,P),O.current_tool_call_index!=null&&W(this,ee,"m",Zn).call(this,P,O.current_tool_call_index)),O.current_tool_call_index=w.index;for(const w of b.delta.tool_calls??[]){const I=(k=P.message.tool_calls)==null?void 0:k[w.index];I!=null&&I.type&&((I==null?void 0:I.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(_=I.function)==null?void 0:_.name,index:w.index,arguments:I.function.arguments,parsed_arguments:I.function.parsed_arguments,arguments_delta:((S=w.function)==null?void 0:S.arguments)??""}):(I==null||I.type,void 0))}}},Zn=function(n,r){var a,o,l;if(W(this,ee,"m",on).call(this,n).done_tool_calls.has(r))return;const s=(a=n.message.tool_calls)==null?void 0:a[r];if(!s)throw new Error("no tool call snapshot");if(!s.type)throw new Error("tool call snapshot missing `type`");if(s.type==="function"){const u=(l=(o=W(this,Ue,"f"))==null?void 0:o.tools)==null?void 0:l.find(h=>h.type==="function"&&h.function.name===s.function.name);this._emit("tool_calls.function.arguments.done",{name:s.function.name,index:r,arguments:s.function.arguments,parsed_arguments:Kt(u)?u.$parseRaw(s.function.arguments):u!=null&&u.function.strict?JSON.parse(s.function.arguments):null})}else s.type},er=function(n){var i,s;const r=W(this,ee,"m",on).call(this,n);if(n.message.content&&!r.content_done){r.content_done=!0;const a=W(this,ee,"m",tr).call(this);this._emit("content.done",{content:n.message.content,parsed:a?a.$parseRaw(n.message.content):null})}n.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:n.message.refusal})),(i=n.logprobs)!=null&&i.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:n.logprobs.content})),(s=n.logprobs)!=null&&s.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:n.logprobs.refusal}))},ln=function(){if(this.ended)throw new L("stream has ended, this shouldn't happen");const n=W(this,qe,"f");if(!n)throw new L("request ended without sending any chunks");return lt(this,qe,void 0,"f"),lt(this,ut,[],"f"),fu(n,W(this,Ue,"f"))},tr=function(){var r;const n=(r=W(this,Ue,"f"))==null?void 0:r.response_format;return Vr(n)?n:null},rs=function(n){var r,i,s,a;let o=W(this,qe,"f");const{choices:l,...u}=n;o?Object.assign(o,u):o=lt(this,qe,{...u,choices:[]},"f");for(const{delta:h,finish_reason:c,index:d,logprobs:f=null,...g}of n.choices){let y=o.choices[d];if(y||(y=o.choices[d]={finish_reason:c,index:d,message:{},logprobs:f,...g}),f)if(!y.logprobs)y.logprobs=Object.assign({},f);else{const{content:w,refusal:I,...j}=f;Object.assign(y.logprobs,j),w&&((r=y.logprobs).content??(r.content=[]),y.logprobs.content.push(...w)),I&&((i=y.logprobs).refusal??(i.refusal=[]),y.logprobs.refusal.push(...I))}if(c&&(y.finish_reason=c,W(this,Ue,"f")&&Da(W(this,Ue,"f")))){if(c==="length")throw new wa;if(c==="content_filter")throw new xa}if(Object.assign(y,g),!h)continue;const{content:k,refusal:_,function_call:S,role:b,tool_calls:P,...O}=h;if(Object.assign(y.message,O),_&&(y.message.refusal=(y.message.refusal||"")+_),b&&(y.message.role=b),S&&(y.message.function_call?(S.name&&(y.message.function_call.name=S.name),S.arguments&&((s=y.message.function_call).arguments??(s.arguments=""),y.message.function_call.arguments+=S.arguments)):y.message.function_call=S),k&&(y.message.content=(y.message.content||"")+k,!y.message.refusal&&W(this,ee,"m",tr).call(this)&&(y.message.parsed=ns(y.message.content))),P){y.message.tool_calls||(y.message.tool_calls=[]);for(const{index:w,id:I,type:j,function:N,...F}of P){const E=(a=y.message.tool_calls)[w]??(a[w]={});Object.assign(E,F),I&&(E.id=I),j&&(E.type=j),N&&(E.function??(E.function={name:N.name??"",arguments:""})),N!=null&&N.name&&(E.function.name=N.name),N!=null&&N.arguments&&(E.function.arguments+=N.arguments,su(W(this,Ue,"f"),E)&&(E.function.parsed_arguments=ns(E.function.arguments)))}}}return o},Symbol.asyncIterator)](){const t=[],n=[];let r=!1;return this.on("chunk",i=>{const s=n.shift();s?s.resolve(i):t.push(i)}),this.on("end",()=>{r=!0;for(const i of n)i.resolve(void 0);n.length=0}),this.on("abort",i=>{r=!0;for(const s of n)s.reject(i);n.length=0}),this.on("error",i=>{r=!0;for(const s of n)s.reject(i);n.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((s,a)=>n.push({resolve:s,reject:a})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Me(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function fu(e,t){const{id:n,choices:r,created:i,model:s,system_fingerprint:a,...o}=e,l={...o,id:n,choices:r.map(({message:u,finish_reason:h,index:c,logprobs:d,...f})=>{if(!h)throw new L(`missing finish_reason for choice ${c}`);const{content:g=null,function_call:y,tool_calls:k,..._}=u,S=u.role;if(!S)throw new L(`missing role for choice ${c}`);if(y){const{arguments:b,name:P}=y;if(b==null)throw new L(`missing function_call.arguments for choice ${c}`);if(!P)throw new L(`missing function_call.name for choice ${c}`);return{...f,message:{content:g,function_call:{arguments:b,name:P},role:S,refusal:u.refusal??null},finish_reason:h,index:c,logprobs:d}}return k?{...f,index:c,finish_reason:h,logprobs:d,message:{..._,role:S,content:g,refusal:u.refusal??null,tool_calls:k.map((b,P)=>{const{function:O,type:w,id:I,...j}=b,{arguments:N,name:F,...E}=O||{};if(I==null)throw new L(`missing choices[${c}].tool_calls[${P}].id
${un(e)}`);if(w==null)throw new L(`missing choices[${c}].tool_calls[${P}].type
${un(e)}`);if(F==null)throw new L(`missing choices[${c}].tool_calls[${P}].function.name
${un(e)}`);if(N==null)throw new L(`missing choices[${c}].tool_calls[${P}].function.arguments
${un(e)}`);return{...j,id:I,type:w,function:{...E,name:F,arguments:N}}})}}:{...f,message:{..._,content:g,role:S,refusal:u.refusal??null},finish_reason:h,index:c,logprobs:d}}),created:i,model:s,object:"chat.completion",...a?{system_fingerprint:a}:{}};return nu(l,t)}function un(e){return JSON.stringify(e)}class wt extends qt{static fromReadableStream(t){const n=new wt(null);return n._run(()=>n._fromReadableStream(t)),n}static runFunctions(t,n,r){const i=new wt(null),s={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runFunctions"}};return i._run(()=>i._runFunctions(t,n,s)),i}static runTools(t,n,r){const i=new wt(n),s={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(t,n,s)),i}}let Za=class extends z{parse(t,n){return au(t.tools),this._client.chat.completions.create(t,{...n,headers:{...n==null?void 0:n.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(r=>qr(r,t))}runFunctions(t,n){return t.stream?wt.runFunctions(this._client,t,n):Vt.runFunctions(this._client,t,n)}runTools(t,n){return t.stream?wt.runTools(this._client,t,n):Vt.runTools(this._client,t,n)}stream(t,n){return qt.createChatCompletion(this._client,t,n)}};class Ar extends z{constructor(){super(...arguments),this.completions=new Za(this._client)}}(function(e){e.Completions=Za})(Ar||(Ar={}));class eo extends z{create(t,n){return this._client.post("/realtime/sessions",{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class to extends z{create(t,n){return this._client.post("/realtime/transcription_sessions",{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}}class Bn extends z{constructor(){super(...arguments),this.sessions=new eo(this._client),this.transcriptionSessions=new to(this._client)}}Bn.Sessions=eo;Bn.TranscriptionSessions=to;class Wr extends z{create(t,n,r){return this._client.post(`/threads/${t}/messages`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(t,n,r){return this._client.get(`/threads/${t}/messages/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(t,n,r,i){return this._client.post(`/threads/${t}/messages/${n}`,{body:r,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(t,n={},r){return Y(n)?this.list(t,{},n):this._client.getAPIList(`/threads/${t}/messages`,Xr,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(t,n,r){return this._client.delete(`/threads/${t}/messages/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class Xr extends oe{}Wr.MessagesPage=Xr;class Jr extends z{retrieve(t,n,r,i={},s){return Y(i)?this.retrieve(t,n,r,{},i):this._client.get(`/threads/${t}/runs/${n}/steps/${r}`,{query:i,...s,headers:{"OpenAI-Beta":"assistants=v2",...s==null?void 0:s.headers}})}list(t,n,r={},i){return Y(r)?this.list(t,n,{},r):this._client.getAPIList(`/threads/${t}/runs/${n}/steps`,Kr,{query:r,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}}class Kr extends oe{}Jr.RunStepsPage=Kr;let Qt=class extends z{constructor(){super(...arguments),this.steps=new Jr(this._client)}create(t,n,r){const{include:i,...s}=n;return this._client.post(`/threads/${t}/runs`,{query:{include:i},body:s,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers},stream:n.stream??!1})}retrieve(t,n,r){return this._client.get(`/threads/${t}/runs/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(t,n,r,i){return this._client.post(`/threads/${t}/runs/${n}`,{body:r,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(t,n={},r){return Y(n)?this.list(t,{},n):this._client.getAPIList(`/threads/${t}/runs`,Qr,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(t,n,r){return this._client.post(`/threads/${t}/runs/${n}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(t,n,r){const i=await this.create(t,n,r);return await this.poll(t,i.id,r)}createAndStream(t,n,r){return ve.createAssistantStream(t,this._client.beta.threads.runs,n,r)}async poll(t,n,r){const i={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:s,response:a}=await this.retrieve(t,n,{...r,headers:{...r==null?void 0:r.headers,...i}}).withResponse();switch(s.status){case"queued":case"in_progress":case"cancelling":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const l=a.headers.get("openai-poll-after-ms");if(l){const u=parseInt(l);isNaN(u)||(o=u)}}await Xt(o);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return s}}}stream(t,n,r){return ve.createAssistantStream(t,this._client.beta.threads.runs,n,r)}submitToolOutputs(t,n,r,i){return this._client.post(`/threads/${t}/runs/${n}/submit_tool_outputs`,{body:r,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(t,n,r,i){const s=await this.submitToolOutputs(t,n,r,i);return await this.poll(t,s.id,i)}submitToolOutputsStream(t,n,r,i){return ve.createToolAssistantStream(t,n,this._client.beta.threads.runs,r,i)}};class Qr extends oe{}Qt.RunsPage=Qr;Qt.Steps=Jr;Qt.RunStepsPage=Kr;class kt extends z{constructor(){super(...arguments),this.runs=new Qt(this._client),this.messages=new Wr(this._client)}create(t={},n){return Y(t)?this.create({},t):this._client.post("/threads",{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(t,n){return this._client.get(`/threads/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(t,n,r){return this._client.post(`/threads/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(t,n){return this._client.delete(`/threads/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}createAndRun(t,n){return this._client.post("/threads/runs",{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers},stream:t.stream??!1})}async createAndRunPoll(t,n){const r=await this.createAndRun(t,n);return await this.runs.poll(r.thread_id,r.id,n)}createAndRunStream(t,n){return ve.createThreadAssistantStream(t,this._client.beta.threads,n)}}kt.Runs=Qt;kt.RunsPage=Qr;kt.Messages=Wr;kt.MessagesPage=Xr;class St extends z{constructor(){super(...arguments),this.realtime=new Bn(this._client),this.chat=new Ar(this._client),this.assistants=new Ur(this._client),this.threads=new kt(this._client)}}St.Realtime=Bn;St.Assistants=Ur;St.AssistantsPage=Hr;St.Threads=kt;class no extends z{create(t,n){return this._client.post("/completions",{body:t,...n,stream:t.stream??!1})}}class ro extends z{create(t,n){const r=!!t.encoding_format;let i=r?t.encoding_format:"base64";r&&Ke("Request","User defined encoding_format:",t.encoding_format);const s=this._client.post("/embeddings",{body:{...t,encoding_format:i},...n});return r?s:(Ke("response","Decoding base64 embeddings to float32 array"),s._thenUnwrap(a=>(a&&a.data&&a.data.forEach(o=>{const l=o.embedding;o.embedding=eu(l)}),a)))}}class Gr extends z{retrieve(t,n,r,i){return this._client.get(`/evals/${t}/runs/${n}/output_items/${r}`,i)}list(t,n,r={},i){return Y(r)?this.list(t,n,{},r):this._client.getAPIList(`/evals/${t}/runs/${n}/output_items`,Yr,{query:r,...i})}}class Yr extends oe{}Gr.OutputItemListResponsesPage=Yr;class Gt extends z{constructor(){super(...arguments),this.outputItems=new Gr(this._client)}create(t,n,r){return this._client.post(`/evals/${t}/runs`,{body:n,...r})}retrieve(t,n,r){return this._client.get(`/evals/${t}/runs/${n}`,r)}list(t,n={},r){return Y(n)?this.list(t,{},n):this._client.getAPIList(`/evals/${t}/runs`,Zr,{query:n,...r})}del(t,n,r){return this._client.delete(`/evals/${t}/runs/${n}`,r)}cancel(t,n,r){return this._client.post(`/evals/${t}/runs/${n}`,r)}}class Zr extends oe{}Gt.RunListResponsesPage=Zr;Gt.OutputItems=Gr;Gt.OutputItemListResponsesPage=Yr;class Yt extends z{constructor(){super(...arguments),this.runs=new Gt(this._client)}create(t,n){return this._client.post("/evals",{body:t,...n})}retrieve(t,n){return this._client.get(`/evals/${t}`,n)}update(t,n,r){return this._client.post(`/evals/${t}`,{body:n,...r})}list(t={},n){return Y(t)?this.list({},t):this._client.getAPIList("/evals",ei,{query:t,...n})}del(t,n){return this._client.delete(`/evals/${t}`,n)}}class ei extends oe{}Yt.EvalListResponsesPage=ei;Yt.Runs=Gt;Yt.RunListResponsesPage=Zr;let ti=class extends z{create(t,n){return this._client.post("/files",_t({body:t,...n}))}retrieve(t,n){return this._client.get(`/files/${t}`,n)}list(t={},n){return Y(t)?this.list({},t):this._client.getAPIList("/files",ni,{query:t,...n})}del(t,n){return this._client.delete(`/files/${t}`,n)}content(t,n){return this._client.get(`/files/${t}/content`,{...n,headers:{Accept:"application/binary",...n==null?void 0:n.headers},__binaryResponse:!0})}retrieveContent(t,n){return this._client.get(`/files/${t}/content`,n)}async waitForProcessing(t,{pollInterval:n=5e3,maxWait:r=30*60*1e3}={}){const i=new Set(["processed","error","deleted"]),s=Date.now();let a=await this.retrieve(t);for(;!a.status||!i.has(a.status);)if(await Xt(n),a=await this.retrieve(t),Date.now()-s>r)throw new Br({message:`Giving up on waiting for file ${t} to finish processing after ${r} milliseconds.`});return a}};class ni extends oe{}ti.FileObjectsPage=ni;class ri extends z{create(t,n,r){return this._client.getAPIList(`/fine_tuning/checkpoints/${t}/permissions`,ii,{body:n,method:"post",...r})}retrieve(t,n={},r){return Y(n)?this.retrieve(t,{},n):this._client.get(`/fine_tuning/checkpoints/${t}/permissions`,{query:n,...r})}del(t,n,r){return this._client.delete(`/fine_tuning/checkpoints/${t}/permissions/${n}`,r)}}class ii extends Fn{}ri.PermissionCreateResponsesPage=ii;let $n=class extends z{constructor(){super(...arguments),this.permissions=new ri(this._client)}};$n.Permissions=ri;$n.PermissionCreateResponsesPage=ii;class si extends z{list(t,n={},r){return Y(n)?this.list(t,{},n):this._client.getAPIList(`/fine_tuning/jobs/${t}/checkpoints`,ai,{query:n,...r})}}class ai extends oe{}si.FineTuningJobCheckpointsPage=ai;class Ct extends z{constructor(){super(...arguments),this.checkpoints=new si(this._client)}create(t,n){return this._client.post("/fine_tuning/jobs",{body:t,...n})}retrieve(t,n){return this._client.get(`/fine_tuning/jobs/${t}`,n)}list(t={},n){return Y(t)?this.list({},t):this._client.getAPIList("/fine_tuning/jobs",oi,{query:t,...n})}cancel(t,n){return this._client.post(`/fine_tuning/jobs/${t}/cancel`,n)}listEvents(t,n={},r){return Y(n)?this.listEvents(t,{},n):this._client.getAPIList(`/fine_tuning/jobs/${t}/events`,li,{query:n,...r})}}class oi extends oe{}class li extends oe{}Ct.FineTuningJobsPage=oi;Ct.FineTuningJobEventsPage=li;Ct.Checkpoints=si;Ct.FineTuningJobCheckpointsPage=ai;class Et extends z{constructor(){super(...arguments),this.jobs=new Ct(this._client),this.checkpoints=new $n(this._client)}}Et.Jobs=Ct;Et.FineTuningJobsPage=oi;Et.FineTuningJobEventsPage=li;Et.Checkpoints=$n;class io extends z{createVariation(t,n){return this._client.post("/images/variations",_t({body:t,...n}))}edit(t,n){return this._client.post("/images/edits",_t({body:t,...n}))}generate(t,n){return this._client.post("/images/generations",{body:t,...n})}}class ui extends z{retrieve(t,n){return this._client.get(`/models/${t}`,n)}list(t){return this._client.getAPIList("/models",ci,t)}del(t,n){return this._client.delete(`/models/${t}`,n)}}class ci extends Fn{}ui.ModelsPage=ci;class so extends z{create(t,n){return this._client.post("/moderations",{body:t,...n})}}function du(e,t){return!t||!mu(t)?{...e,output_parsed:null,output:e.output.map(n=>n.type==="function_call"?{...n,parsed_arguments:null}:n.type==="message"?{...n,content:n.content.map(r=>({...r,parsed:null}))}:n)}:ao(e,t)}function ao(e,t){const n=e.output.map(i=>{if(i.type==="function_call")return{...i,parsed_arguments:wu(t,i)};if(i.type==="message"){const s=i.content.map(a=>a.type==="output_text"?{...a,parsed:pu(t,a.text)}:a);return{...i,content:s}}return i}),r=Object.assign({},e,{output:n});return Object.getOwnPropertyDescriptor(e,"output_text")||oo(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(const i of r.output)if(i.type==="message"){for(const s of i.content)if(s.type==="output_text"&&s.parsed!==null)return s.parsed}return null}}),r}function pu(e,t){var n,r,i,s;return((r=(n=e.text)==null?void 0:n.format)==null?void 0:r.type)!=="json_schema"?null:"$parseRaw"in((i=e.text)==null?void 0:i.format)?((s=e.text)==null?void 0:s.format).$parseRaw(t):JSON.parse(t)}function mu(e){var t;return!!Vr((t=e.text)==null?void 0:t.format)}function gu(e){return(e==null?void 0:e.$brand)==="auto-parseable-tool"}function yu(e,t){return e.find(n=>n.type==="function"&&n.name===t)}function wu(e,t){const n=yu(e.tools??[],t.name);return{...t,...t,parsed_arguments:gu(n)?n.$parseRaw(t.arguments):n!=null&&n.strict?JSON.parse(t.arguments):null}}function oo(e){const t=[];for(const n of e.output)if(n.type==="message")for(const r of n.content)r.type==="output_text"&&t.push(r.text);e.output_text=t.join("")}class lo extends z{list(t,n={},r){return Y(n)?this.list(t,{},n):this._client.getAPIList(`/responses/${t}/input_items`,bu,{query:n,...r})}}var ct=function(e,t,n,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(e,n):i?i.value=n:t.set(e,n),n},We=function(e,t,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(e):r?r.value:t.get(e)},ht,cn,Xe,hn,is,ss,as,os;class hi extends jr{constructor(t){super(),ht.add(this),cn.set(this,void 0),Xe.set(this,void 0),hn.set(this,void 0),ct(this,cn,t,"f")}static createResponse(t,n,r){const i=new hi(n);return i._run(()=>i._createResponse(t,n,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createResponse(t,n,r){var a;const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),We(this,ht,"m",is).call(this);const s=await t.responses.create({...n,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of s)We(this,ht,"m",ss).call(this,o);if((a=s.controller.signal)!=null&&a.aborted)throw new ke;return We(this,ht,"m",as).call(this)}[(cn=new WeakMap,Xe=new WeakMap,hn=new WeakMap,ht=new WeakSet,is=function(){this.ended||ct(this,Xe,void 0,"f")},ss=function(n){if(this.ended)return;const r=We(this,ht,"m",os).call(this,n);switch(this._emit("event",n),n.type){case"response.output_text.delta":{const i=r.output[n.output_index];if(!i)throw new L(`missing output at index ${n.output_index}`);if(i.type==="message"){const s=i.content[n.content_index];if(!s)throw new L(`missing content at index ${n.content_index}`);if(s.type!=="output_text")throw new L(`expected content to be 'output_text', got ${s.type}`);this._emit("response.output_text.delta",{...n,snapshot:s.text})}break}case"response.function_call_arguments.delta":{const i=r.output[n.output_index];if(!i)throw new L(`missing output at index ${n.output_index}`);i.type==="function_call"&&this._emit("response.function_call_arguments.delta",{...n,snapshot:i.arguments});break}default:this._emit(n.type,n);break}},as=function(){if(this.ended)throw new L("stream has ended, this shouldn't happen");const n=We(this,Xe,"f");if(!n)throw new L("request ended without sending any events");ct(this,Xe,void 0,"f");const r=xu(n,We(this,cn,"f"));return ct(this,hn,r,"f"),r},os=function(n){let r=We(this,Xe,"f");if(!r){if(n.type!=="response.created")throw new L(`When snapshot hasn't been set yet, expected 'response.created' event, got ${n.type}`);return r=ct(this,Xe,n.response,"f"),r}switch(n.type){case"response.output_item.added":{r.output.push(n.item);break}case"response.content_part.added":{const i=r.output[n.output_index];if(!i)throw new L(`missing output at index ${n.output_index}`);i.type==="message"&&i.content.push(n.part);break}case"response.output_text.delta":{const i=r.output[n.output_index];if(!i)throw new L(`missing output at index ${n.output_index}`);if(i.type==="message"){const s=i.content[n.content_index];if(!s)throw new L(`missing content at index ${n.content_index}`);if(s.type!=="output_text")throw new L(`expected content to be 'output_text', got ${s.type}`);s.text+=n.delta}break}case"response.function_call_arguments.delta":{const i=r.output[n.output_index];if(!i)throw new L(`missing output at index ${n.output_index}`);i.type==="function_call"&&(i.arguments+=n.delta);break}case"response.completed":{ct(this,Xe,n.response,"f");break}}return r},Symbol.asyncIterator)](){const t=[],n=[];let r=!1;return this.on("event",i=>{const s=n.shift();s?s.resolve(i):t.push(i)}),this.on("end",()=>{r=!0;for(const i of n)i.resolve(void 0);n.length=0}),this.on("abort",i=>{r=!0;for(const s of n)s.reject(i);n.length=0}),this.on("error",i=>{r=!0;for(const s of n)s.reject(i);n.length=0}),{next:async()=>t.length?{value:t.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((s,a)=>n.push({resolve:s,reject:a})).then(s=>s?{value:s,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const t=We(this,hn,"f");if(!t)throw new L("stream ended without producing a ChatCompletion");return t}}function xu(e,t){return du(e,t)}class fi extends z{constructor(){super(...arguments),this.inputItems=new lo(this._client)}create(t,n){return this._client.post("/responses",{body:t,...n,stream:t.stream??!1})._thenUnwrap(r=>("object"in r&&r.object==="response"&&oo(r),r))}retrieve(t,n={},r){return Y(n)?this.retrieve(t,{},n):this._client.get(`/responses/${t}`,{query:n,...r})}del(t,n){return this._client.delete(`/responses/${t}`,{...n,headers:{Accept:"*/*",...n==null?void 0:n.headers}})}parse(t,n){return this._client.responses.create(t,n)._thenUnwrap(r=>ao(r,t))}stream(t,n){return hi.createResponse(this._client,t,n)}}class bu extends oe{}fi.InputItems=lo;class uo extends z{create(t,n,r){return this._client.post(`/uploads/${t}/parts`,_t({body:n,...r}))}}class di extends z{constructor(){super(...arguments),this.parts=new uo(this._client)}create(t,n){return this._client.post("/uploads",{body:t,...n})}cancel(t,n){return this._client.post(`/uploads/${t}/cancel`,n)}complete(t,n,r){return this._client.post(`/uploads/${t}/complete`,{body:n,...r})}}di.Parts=uo;const _u=async e=>{const t=await Promise.allSettled(e),n=t.filter(i=>i.status==="rejected");if(n.length){for(const i of n)console.error(i.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const r=[];for(const i of t)i.status==="fulfilled"&&r.push(i.value);return r};class zn extends z{create(t,n,r){return this._client.post(`/vector_stores/${t}/files`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(t,n,r){return this._client.get(`/vector_stores/${t}/files/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}update(t,n,r,i){return this._client.post(`/vector_stores/${t}/files/${n}`,{body:r,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}list(t,n={},r){return Y(n)?this.list(t,{},n):this._client.getAPIList(`/vector_stores/${t}/files`,jn,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}del(t,n,r){return this._client.delete(`/vector_stores/${t}/files/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(t,n,r){const i=await this.create(t,n,r);return await this.poll(t,i.id,r)}async poll(t,n,r){const i={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const s=await this.retrieve(t,n,{...r,headers:i}).withResponse(),a=s.data;switch(a.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const l=s.response.headers.get("openai-poll-after-ms");if(l){const u=parseInt(l);isNaN(u)||(o=u)}}await Xt(o);break;case"failed":case"completed":return a}}}async upload(t,n,r){const i=await this._client.files.create({file:n,purpose:"assistants"},r);return this.create(t,{file_id:i.id},r)}async uploadAndPoll(t,n,r){const i=await this.upload(t,n,r);return await this.poll(t,i.id,r)}content(t,n,r){return this._client.getAPIList(`/vector_stores/${t}/files/${n}/content`,pi,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class jn extends oe{}class pi extends Fn{}zn.VectorStoreFilesPage=jn;zn.FileContentResponsesPage=pi;class co extends z{create(t,n,r){return this._client.post(`/vector_stores/${t}/file_batches`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}retrieve(t,n,r){return this._client.get(`/vector_stores/${t}/file_batches/${n}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}cancel(t,n,r){return this._client.post(`/vector_stores/${t}/file_batches/${n}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}async createAndPoll(t,n,r){const i=await this.create(t,n);return await this.poll(t,i.id,r)}listFiles(t,n,r={},i){return Y(r)?this.listFiles(t,n,{},r):this._client.getAPIList(`/vector_stores/${t}/file_batches/${n}/files`,jn,{query:r,...i,headers:{"OpenAI-Beta":"assistants=v2",...i==null?void 0:i.headers}})}async poll(t,n,r){const i={...r==null?void 0:r.headers,"X-Stainless-Poll-Helper":"true"};for(r!=null&&r.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){const{data:s,response:a}=await this.retrieve(t,n,{...r,headers:i}).withResponse();switch(s.status){case"in_progress":let o=5e3;if(r!=null&&r.pollIntervalMs)o=r.pollIntervalMs;else{const l=a.headers.get("openai-poll-after-ms");if(l){const u=parseInt(l);isNaN(u)||(o=u)}}await Xt(o);break;case"failed":case"cancelled":case"completed":return s}}}async uploadAndPoll(t,{files:n,fileIds:r=[]},i){if(n==null||n.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const s=(i==null?void 0:i.maxConcurrency)??5,a=Math.min(s,n.length),o=this._client,l=n.values(),u=[...r];async function h(d){for(let f of d){const g=await o.files.create({file:f,purpose:"assistants"},i);u.push(g.id)}}const c=Array(a).fill(l).map(h);return await _u(c),await this.createAndPoll(t,{file_ids:u})}}class Qe extends z{constructor(){super(...arguments),this.files=new zn(this._client),this.fileBatches=new co(this._client)}create(t,n){return this._client.post("/vector_stores",{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}retrieve(t,n){return this._client.get(`/vector_stores/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}update(t,n,r){return this._client.post(`/vector_stores/${t}`,{body:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}list(t={},n){return Y(t)?this.list({},t):this._client.getAPIList("/vector_stores",mi,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}del(t,n){return this._client.delete(`/vector_stores/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n==null?void 0:n.headers}})}search(t,n,r){return this._client.getAPIList(`/vector_stores/${t}/search`,gi,{body:n,method:"post",...r,headers:{"OpenAI-Beta":"assistants=v2",...r==null?void 0:r.headers}})}}class mi extends oe{}class gi extends Fn{}Qe.VectorStoresPage=mi;Qe.VectorStoreSearchResponsesPage=gi;Qe.Files=zn;Qe.VectorStoreFilesPage=jn;Qe.FileContentResponsesPage=pi;Qe.FileBatches=co;var ho;class B extends Ul{constructor({baseURL:t=sn("OPENAI_BASE_URL"),apiKey:n=sn("OPENAI_API_KEY"),organization:r=sn("OPENAI_ORG_ID")??null,project:i=sn("OPENAI_PROJECT_ID")??null,...s}={}){if(n===void 0)throw new L("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:n,organization:r,project:i,...s,baseURL:t||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&Yl())throw new L(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new no(this),this.chat=new Dn(this),this.embeddings=new ro(this),this.files=new ti(this),this.images=new io(this),this.audio=new Jt(this),this.moderations=new so(this),this.models=new ui(this),this.fineTuning=new Et(this),this.vectorStores=new Qe(this),this.beta=new St(this),this.batches=new $r(this),this.uploads=new di(this),this.responses=new fi(this),this.evals=new Yt(this),this._options=a,this.apiKey=n,this.organization=r,this.project=i}defaultQuery(){return this._options.defaultQuery}defaultHeaders(t){return{...super.defaultHeaders(t),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(t){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(t){return Cl(t,{arrayFormat:"brackets"})}}ho=B;B.OpenAI=ho;B.DEFAULT_TIMEOUT=6e5;B.OpenAIError=L;B.APIError=ae;B.APIConnectionError=Rn;B.APIConnectionTimeoutError=Br;B.APIUserAbortError=ke;B.NotFoundError=da;B.ConflictError=pa;B.RateLimitError=ga;B.BadRequestError=ca;B.AuthenticationError=ha;B.InternalServerError=ya;B.PermissionDeniedError=fa;B.UnprocessableEntityError=ma;B.toFile=Sa;B.fileFromPath=oa;B.Completions=no;B.Chat=Dn;B.ChatCompletionsPage=Mn;B.Embeddings=ro;B.Files=ti;B.FileObjectsPage=ni;B.Images=io;B.Audio=Jt;B.Moderations=so;B.Models=ui;B.ModelsPage=ci;B.FineTuning=Et;B.VectorStores=Qe;B.VectorStoresPage=mi;B.VectorStoreSearchResponsesPage=gi;B.Beta=St;B.Batches=$r;B.BatchesPage=zr;B.Uploads=di;B.Responses=fi;B.Evals=Yt;B.EvalListResponsesPage=ei;async function ku(e,t){var n,r,i,s;try{const a=new B({apiKey:t.apiKey,baseURL:t.baseUrl,dangerouslyAllowBrowser:!0}),o=e.filter(h=>h.role!=="system").slice(0,Math.min(e.length,5));return o.length===0?"New conversation":((i=(r=(n=(await a.chat.completions.create({model:t.modelName,messages:[{role:"system",content:"Your task is to generate a very short, concise title (maximum 6 words) that summarizes the main topic of this conversation. Focus on the key subject matter only. Do now use markdown, only plain text."},...o.map(h=>({role:h.role,content:h.content})),{role:"user",content:"Based on this conversation, generate a very short title (no more than 6 words)."}],max_tokens:25,temperature:.7})).choices[0])==null?void 0:n.message)==null?void 0:r.content)==null?void 0:i.trim())||"New conversation"}catch(a){console.error("Error generating chat title:",a);const o=(s=e.find(l=>l.role==="user"))==null?void 0:s.content;return o?o.slice(0,30)+(o.length>30?"...":""):"New conversation"}}function Su(e,t){const n={};return(e[e.length-1]===""?[...e,""]:e).join((n.padRight?" ":"")+","+(n.padLeft===!1?"":" ")).trim()}const Cu=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,Eu=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,Au={};function ls(e,t){return(Au.jsx?Eu:Cu).test(e)}const Pu=/[ \t\n\f\r]/g;function Iu(e){return typeof e=="object"?e.type==="text"?us(e.value):!1:us(e)}function us(e){return e.replace(Pu,"")===""}class Zt{constructor(t,n,r){this.normal=n,this.property=t,r&&(this.space=r)}}Zt.prototype.normal={};Zt.prototype.property={};Zt.prototype.space=void 0;function fo(e,t){const n={},r={};for(const i of e)Object.assign(n,i.property),Object.assign(r,i.normal);return new Zt(n,r,t)}function Pr(e){return e.toLowerCase()}class pe{constructor(t,n){this.attribute=n,this.property=t}}pe.prototype.attribute="";pe.prototype.booleanish=!1;pe.prototype.boolean=!1;pe.prototype.commaOrSpaceSeparated=!1;pe.prototype.commaSeparated=!1;pe.prototype.defined=!1;pe.prototype.mustUseProperty=!1;pe.prototype.number=!1;pe.prototype.overloadedBoolean=!1;pe.prototype.property="";pe.prototype.spaceSeparated=!1;pe.prototype.space=void 0;let vu=0;const $=it(),Z=it(),Ir=it(),C=it(),J=it(),xt=it(),we=it();function it(){return 2**++vu}const vr=Object.freeze(Object.defineProperty({__proto__:null,boolean:$,booleanish:Z,commaOrSpaceSeparated:we,commaSeparated:xt,number:C,overloadedBoolean:Ir,spaceSeparated:J},Symbol.toStringTag,{value:"Module"})),nr=Object.keys(vr);class yi extends pe{constructor(t,n,r,i){let s=-1;if(super(t,n),cs(this,"space",i),typeof r=="number")for(;++s<nr.length;){const a=nr[s];cs(this,nr[s],(r&vr[a])===vr[a])}}}yi.prototype.defined=!0;function cs(e,t,n){n&&(e[t]=n)}function At(e){const t={},n={};for(const[r,i]of Object.entries(e.properties)){const s=new yi(r,e.transform(e.attributes||{},r),i,e.space);e.mustUseProperty&&e.mustUseProperty.includes(r)&&(s.mustUseProperty=!0),t[r]=s,n[Pr(r)]=r,n[Pr(s.attribute)]=r}return new Zt(t,n,e.space)}const po=At({properties:{ariaActiveDescendant:null,ariaAtomic:Z,ariaAutoComplete:null,ariaBusy:Z,ariaChecked:Z,ariaColCount:C,ariaColIndex:C,ariaColSpan:C,ariaControls:J,ariaCurrent:null,ariaDescribedBy:J,ariaDetails:null,ariaDisabled:Z,ariaDropEffect:J,ariaErrorMessage:null,ariaExpanded:Z,ariaFlowTo:J,ariaGrabbed:Z,ariaHasPopup:null,ariaHidden:Z,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:J,ariaLevel:C,ariaLive:null,ariaModal:Z,ariaMultiLine:Z,ariaMultiSelectable:Z,ariaOrientation:null,ariaOwns:J,ariaPlaceholder:null,ariaPosInSet:C,ariaPressed:Z,ariaReadOnly:Z,ariaRelevant:null,ariaRequired:Z,ariaRoleDescription:J,ariaRowCount:C,ariaRowIndex:C,ariaRowSpan:C,ariaSelected:Z,ariaSetSize:C,ariaSort:null,ariaValueMax:C,ariaValueMin:C,ariaValueNow:C,ariaValueText:null,role:null},transform(e,t){return t==="role"?t:"aria-"+t.slice(4).toLowerCase()}});function mo(e,t){return t in e?e[t]:t}function go(e,t){return mo(e,t.toLowerCase())}const Ru=At({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:xt,acceptCharset:J,accessKey:J,action:null,allow:null,allowFullScreen:$,allowPaymentRequest:$,allowUserMedia:$,alt:null,as:null,async:$,autoCapitalize:null,autoComplete:J,autoFocus:$,autoPlay:$,blocking:J,capture:null,charSet:null,checked:$,cite:null,className:J,cols:C,colSpan:null,content:null,contentEditable:Z,controls:$,controlsList:J,coords:C|xt,crossOrigin:null,data:null,dateTime:null,decoding:null,default:$,defer:$,dir:null,dirName:null,disabled:$,download:Ir,draggable:Z,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:$,formTarget:null,headers:J,height:C,hidden:Ir,high:C,href:null,hrefLang:null,htmlFor:J,httpEquiv:J,id:null,imageSizes:null,imageSrcSet:null,inert:$,inputMode:null,integrity:null,is:null,isMap:$,itemId:null,itemProp:J,itemRef:J,itemScope:$,itemType:J,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:$,low:C,manifest:null,max:null,maxLength:C,media:null,method:null,min:null,minLength:C,multiple:$,muted:$,name:null,nonce:null,noModule:$,noValidate:$,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:$,optimum:C,pattern:null,ping:J,placeholder:null,playsInline:$,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:$,referrerPolicy:null,rel:J,required:$,reversed:$,rows:C,rowSpan:C,sandbox:J,scope:null,scoped:$,seamless:$,selected:$,shadowRootClonable:$,shadowRootDelegatesFocus:$,shadowRootMode:null,shape:null,size:C,sizes:null,slot:null,span:C,spellCheck:Z,src:null,srcDoc:null,srcLang:null,srcSet:null,start:C,step:null,style:null,tabIndex:C,target:null,title:null,translate:null,type:null,typeMustMatch:$,useMap:null,value:Z,width:C,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:J,axis:null,background:null,bgColor:null,border:C,borderColor:null,bottomMargin:C,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:$,declare:$,event:null,face:null,frame:null,frameBorder:null,hSpace:C,leftMargin:C,link:null,longDesc:null,lowSrc:null,marginHeight:C,marginWidth:C,noResize:$,noHref:$,noShade:$,noWrap:$,object:null,profile:null,prompt:null,rev:null,rightMargin:C,rules:null,scheme:null,scrolling:Z,standby:null,summary:null,text:null,topMargin:C,valueType:null,version:null,vAlign:null,vLink:null,vSpace:C,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:$,disableRemotePlayback:$,prefix:null,property:null,results:C,security:null,unselectable:null},space:"html",transform:go}),Tu=At({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:we,accentHeight:C,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:C,amplitude:C,arabicForm:null,ascent:C,attributeName:null,attributeType:null,azimuth:C,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:C,by:null,calcMode:null,capHeight:C,className:J,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:C,diffuseConstant:C,direction:null,display:null,dur:null,divisor:C,dominantBaseline:null,download:$,dx:null,dy:null,edgeMode:null,editable:null,elevation:C,enableBackground:null,end:null,event:null,exponent:C,externalResourcesRequired:null,fill:null,fillOpacity:C,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:xt,g2:xt,glyphName:xt,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:C,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:C,horizOriginX:C,horizOriginY:C,id:null,ideographic:C,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:C,k:C,k1:C,k2:C,k3:C,k4:C,kernelMatrix:we,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:C,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:C,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:C,overlineThickness:C,paintOrder:null,panose1:null,path:null,pathLength:C,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:J,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:C,pointsAtY:C,pointsAtZ:C,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:we,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:we,rev:we,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:we,requiredFeatures:we,requiredFonts:we,requiredFormats:we,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:C,specularExponent:C,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:C,strikethroughThickness:C,string:null,stroke:null,strokeDashArray:we,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:C,strokeOpacity:C,strokeWidth:null,style:null,surfaceScale:C,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:we,tabIndex:C,tableValues:null,target:null,targetX:C,targetY:C,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:we,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:C,underlineThickness:C,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:C,values:null,vAlphabetic:C,vMathematical:C,vectorEffect:null,vHanging:C,vIdeographic:C,version:null,vertAdvY:C,vertOriginX:C,vertOriginY:C,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:C,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:mo}),yo=At({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(e,t){return"xlink:"+t.slice(5).toLowerCase()}}),wo=At({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:go}),xo=At({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(e,t){return"xml:"+t.slice(3).toLowerCase()}}),Ou={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},Nu=/[A-Z]/g,hs=/-[a-z]/g,Fu=/^data[-\w.:]+$/i;function Lu(e,t){const n=Pr(t);let r=t,i=pe;if(n in e.normal)return e.property[e.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&Fu.test(t)){if(t.charAt(4)==="-"){const s=t.slice(5).replace(hs,Du);r="data"+s.charAt(0).toUpperCase()+s.slice(1)}else{const s=t.slice(4);if(!hs.test(s)){let a=s.replace(Nu,Mu);a.charAt(0)!=="-"&&(a="-"+a),t="data"+a}}i=yi}return new i(r,t)}function Mu(e){return"-"+e.toLowerCase()}function Du(e){return e.charAt(1).toUpperCase()}const Bu=fo([po,Ru,yo,wo,xo],"html"),wi=fo([po,Tu,yo,wo,xo],"svg");function $u(e){return e.join(" ").trim()}var xi={},fs=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,zu=/\n/g,ju=/^\s*/,Uu=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,Hu=/^:\s*/,Vu=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,qu=/^[;\s]*/,Wu=/^\s+|\s+$/g,Xu=`
`,ds="/",ps="*",nt="",Ju="comment",Ku="declaration",Qu=function(e,t){if(typeof e!="string")throw new TypeError("First argument must be a string");if(!e)return[];t=t||{};var n=1,r=1;function i(g){var y=g.match(zu);y&&(n+=y.length);var k=g.lastIndexOf(Xu);r=~k?g.length-k:r+g.length}function s(){var g={line:n,column:r};return function(y){return y.position=new a(g),u(),y}}function a(g){this.start=g,this.end={line:n,column:r},this.source=t.source}a.prototype.content=e;function o(g){var y=new Error(t.source+":"+n+":"+r+": "+g);if(y.reason=g,y.filename=t.source,y.line=n,y.column=r,y.source=e,!t.silent)throw y}function l(g){var y=g.exec(e);if(y){var k=y[0];return i(k),e=e.slice(k.length),y}}function u(){l(ju)}function h(g){var y;for(g=g||[];y=c();)y!==!1&&g.push(y);return g}function c(){var g=s();if(!(ds!=e.charAt(0)||ps!=e.charAt(1))){for(var y=2;nt!=e.charAt(y)&&(ps!=e.charAt(y)||ds!=e.charAt(y+1));)++y;if(y+=2,nt===e.charAt(y-1))return o("End of comment missing");var k=e.slice(2,y-2);return r+=2,i(k),e=e.slice(y),r+=2,g({type:Ju,comment:k})}}function d(){var g=s(),y=l(Uu);if(y){if(c(),!l(Hu))return o("property missing ':'");var k=l(Vu),_=g({type:Ku,property:ms(y[0].replace(fs,nt)),value:k?ms(k[0].replace(fs,nt)):nt});return l(qu),_}}function f(){var g=[];h(g);for(var y;y=d();)y!==!1&&(g.push(y),h(g));return g}return u(),f()};function ms(e){return e?e.replace(Wu,nt):nt}var Gu=Sn&&Sn.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(xi,"__esModule",{value:!0});xi.default=Zu;var Yu=Gu(Qu);function Zu(e,t){var n=null;if(!e||typeof e!="string")return n;var r=(0,Yu.default)(e),i=typeof t=="function";return r.forEach(function(s){if(s.type==="declaration"){var a=s.property,o=s.value;i?t(a,o,s):o&&(n=n||{},n[a]=o)}}),n}var Un={};Object.defineProperty(Un,"__esModule",{value:!0});Un.camelCase=void 0;var ec=/^--[a-zA-Z0-9_-]+$/,tc=/-([a-z])/g,nc=/^[^-]+$/,rc=/^-(webkit|moz|ms|o|khtml)-/,ic=/^-(ms)-/,sc=function(e){return!e||nc.test(e)||ec.test(e)},ac=function(e,t){return t.toUpperCase()},gs=function(e,t){return"".concat(t,"-")},oc=function(e,t){return t===void 0&&(t={}),sc(e)?e:(e=e.toLowerCase(),t.reactCompat?e=e.replace(ic,gs):e=e.replace(rc,gs),e.replace(tc,ac))};Un.camelCase=oc;var lc=Sn&&Sn.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},uc=lc(xi),cc=Un;function Rr(e,t){var n={};return!e||typeof e!="string"||(0,uc.default)(e,function(r,i){r&&i&&(n[(0,cc.camelCase)(r,t)]=i)}),n}Rr.default=Rr;var hc=Rr;const fc=Ys(hc),bo=_o("end"),bi=_o("start");function _o(e){return t;function t(n){const r=n&&n.position&&n.position[e]||{};if(typeof r.line=="number"&&r.line>0&&typeof r.column=="number"&&r.column>0)return{line:r.line,column:r.column,offset:typeof r.offset=="number"&&r.offset>-1?r.offset:void 0}}}function dc(e){const t=bi(e),n=bo(e);if(t&&n)return{start:t,end:n}}function jt(e){return!e||typeof e!="object"?"":"position"in e||"type"in e?ys(e.position):"start"in e||"end"in e?ys(e):"line"in e||"column"in e?Tr(e):""}function Tr(e){return ws(e&&e.line)+":"+ws(e&&e.column)}function ys(e){return Tr(e&&e.start)+"-"+Tr(e&&e.end)}function ws(e){return e&&typeof e=="number"?e:1}class ce extends Error{constructor(t,n,r){super(),typeof n=="string"&&(r=n,n=void 0);let i="",s={},a=!1;if(n&&("line"in n&&"column"in n?s={place:n}:"start"in n&&"end"in n?s={place:n}:"type"in n?s={ancestors:[n],place:n.position}:s={...n}),typeof t=="string"?i=t:!s.cause&&t&&(a=!0,i=t.message,s.cause=t),!s.ruleId&&!s.source&&typeof r=="string"){const l=r.indexOf(":");l===-1?s.ruleId=r:(s.source=r.slice(0,l),s.ruleId=r.slice(l+1))}if(!s.place&&s.ancestors&&s.ancestors){const l=s.ancestors[s.ancestors.length-1];l&&(s.place=l.position)}const o=s.place&&"start"in s.place?s.place.start:s.place;this.ancestors=s.ancestors||void 0,this.cause=s.cause||void 0,this.column=o?o.column:void 0,this.fatal=void 0,this.file,this.message=i,this.line=o?o.line:void 0,this.name=jt(s.place)||"1:1",this.place=s.place||void 0,this.reason=this.message,this.ruleId=s.ruleId||void 0,this.source=s.source||void 0,this.stack=a&&s.cause&&typeof s.cause.stack=="string"?s.cause.stack:"",this.actual,this.expected,this.note,this.url}}ce.prototype.file="";ce.prototype.name="";ce.prototype.reason="";ce.prototype.message="";ce.prototype.stack="";ce.prototype.column=void 0;ce.prototype.line=void 0;ce.prototype.ancestors=void 0;ce.prototype.cause=void 0;ce.prototype.fatal=void 0;ce.prototype.place=void 0;ce.prototype.ruleId=void 0;ce.prototype.source=void 0;const _i={}.hasOwnProperty,pc=new Map,mc=/[A-Z]/g,gc=new Set(["table","tbody","thead","tfoot","tr"]),yc=new Set(["td","th"]),ko="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function wc(e,t){if(!t||t.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const n=t.filePath||void 0;let r;if(t.development){if(typeof t.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");r=Ac(n,t.jsxDEV)}else{if(typeof t.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof t.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");r=Ec(n,t.jsx,t.jsxs)}const i={Fragment:t.Fragment,ancestors:[],components:t.components||{},create:r,elementAttributeNameCase:t.elementAttributeNameCase||"react",evaluater:t.createEvaluater?t.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:t.ignoreInvalidStyle||!1,passKeys:t.passKeys!==!1,passNode:t.passNode||!1,schema:t.space==="svg"?wi:Bu,stylePropertyNameCase:t.stylePropertyNameCase||"dom",tableCellAlignToStyle:t.tableCellAlignToStyle!==!1},s=So(i,e,void 0);return s&&typeof s!="string"?s:i.create(e,i.Fragment,{children:s||void 0},void 0)}function So(e,t,n){if(t.type==="element")return xc(e,t,n);if(t.type==="mdxFlowExpression"||t.type==="mdxTextExpression")return bc(e,t);if(t.type==="mdxJsxFlowElement"||t.type==="mdxJsxTextElement")return kc(e,t,n);if(t.type==="mdxjsEsm")return _c(e,t);if(t.type==="root")return Sc(e,t,n);if(t.type==="text")return Cc(e,t)}function xc(e,t,n){const r=e.schema;let i=r;t.tagName.toLowerCase()==="svg"&&r.space==="html"&&(i=wi,e.schema=i),e.ancestors.push(t);const s=Eo(e,t.tagName,!1),a=Pc(e,t);let o=Si(e,t);return gc.has(t.tagName)&&(o=o.filter(function(l){return typeof l=="string"?!Iu(l):!0})),Co(e,a,s,t),ki(a,o),e.ancestors.pop(),e.schema=r,e.create(t,s,a,n)}function bc(e,t){if(t.data&&t.data.estree&&e.evaluater){const r=t.data.estree.body[0];return r.type,e.evaluater.evaluateExpression(r.expression)}Wt(e,t.position)}function _c(e,t){if(t.data&&t.data.estree&&e.evaluater)return e.evaluater.evaluateProgram(t.data.estree);Wt(e,t.position)}function kc(e,t,n){const r=e.schema;let i=r;t.name==="svg"&&r.space==="html"&&(i=wi,e.schema=i),e.ancestors.push(t);const s=t.name===null?e.Fragment:Eo(e,t.name,!0),a=Ic(e,t),o=Si(e,t);return Co(e,a,s,t),ki(a,o),e.ancestors.pop(),e.schema=r,e.create(t,s,a,n)}function Sc(e,t,n){const r={};return ki(r,Si(e,t)),e.create(t,e.Fragment,r,n)}function Cc(e,t){return t.value}function Co(e,t,n,r){typeof n!="string"&&n!==e.Fragment&&e.passNode&&(t.node=r)}function ki(e,t){if(t.length>0){const n=t.length>1?t:t[0];n&&(e.children=n)}}function Ec(e,t,n){return r;function r(i,s,a,o){const u=Array.isArray(a.children)?n:t;return o?u(s,a,o):u(s,a)}}function Ac(e,t){return n;function n(r,i,s,a){const o=Array.isArray(s.children),l=bi(r);return t(i,s,a,o,{columnNumber:l?l.column-1:void 0,fileName:e,lineNumber:l?l.line:void 0},void 0)}}function Pc(e,t){const n={};let r,i;for(i in t.properties)if(i!=="children"&&_i.call(t.properties,i)){const s=vc(e,i,t.properties[i]);if(s){const[a,o]=s;e.tableCellAlignToStyle&&a==="align"&&typeof o=="string"&&yc.has(t.tagName)?r=o:n[a]=o}}if(r){const s=n.style||(n.style={});s[e.stylePropertyNameCase==="css"?"text-align":"textAlign"]=r}return n}function Ic(e,t){const n={};for(const r of t.attributes)if(r.type==="mdxJsxExpressionAttribute")if(r.data&&r.data.estree&&e.evaluater){const s=r.data.estree.body[0];s.type;const a=s.expression;a.type;const o=a.properties[0];o.type,Object.assign(n,e.evaluater.evaluateExpression(o.argument))}else Wt(e,t.position);else{const i=r.name;let s;if(r.value&&typeof r.value=="object")if(r.value.data&&r.value.data.estree&&e.evaluater){const o=r.value.data.estree.body[0];o.type,s=e.evaluater.evaluateExpression(o.expression)}else Wt(e,t.position);else s=r.value===null?!0:r.value;n[i]=s}return n}function Si(e,t){const n=[];let r=-1;const i=e.passKeys?new Map:pc;for(;++r<t.children.length;){const s=t.children[r];let a;if(e.passKeys){const l=s.type==="element"?s.tagName:s.type==="mdxJsxFlowElement"||s.type==="mdxJsxTextElement"?s.name:void 0;if(l){const u=i.get(l)||0;a=l+"-"+u,i.set(l,u+1)}}const o=So(e,s,a);o!==void 0&&n.push(o)}return n}function vc(e,t,n){const r=Lu(e.schema,t);if(!(n==null||typeof n=="number"&&Number.isNaN(n))){if(Array.isArray(n)&&(n=r.commaSeparated?Su(n):$u(n)),r.property==="style"){let i=typeof n=="object"?n:Rc(e,String(n));return e.stylePropertyNameCase==="css"&&(i=Tc(i)),["style",i]}return[e.elementAttributeNameCase==="react"&&r.space?Ou[r.property]||r.property:r.attribute,n]}}function Rc(e,t){try{return fc(t,{reactCompat:!0})}catch(n){if(e.ignoreInvalidStyle)return{};const r=n,i=new ce("Cannot parse `style` attribute",{ancestors:e.ancestors,cause:r,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw i.file=e.filePath||void 0,i.url=ko+"#cannot-parse-style-attribute",i}}function Eo(e,t,n){let r;if(!n)r={type:"Literal",value:t};else if(t.includes(".")){const i=t.split(".");let s=-1,a;for(;++s<i.length;){const o=ls(i[s])?{type:"Identifier",name:i[s]}:{type:"Literal",value:i[s]};a=a?{type:"MemberExpression",object:a,property:o,computed:!!(s&&o.type==="Literal"),optional:!1}:o}r=a}else r=ls(t)&&!/^[a-z]/.test(t)?{type:"Identifier",name:t}:{type:"Literal",value:t};if(r.type==="Literal"){const i=r.value;return _i.call(e.components,i)?e.components[i]:i}if(e.evaluater)return e.evaluater.evaluateExpression(r);Wt(e)}function Wt(e,t){const n=new ce("Cannot handle MDX estrees without `createEvaluater`",{ancestors:e.ancestors,place:t,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw n.file=e.filePath||void 0,n.url=ko+"#cannot-handle-mdx-estrees-without-createevaluater",n}function Tc(e){const t={};let n;for(n in e)_i.call(e,n)&&(t[Oc(n)]=e[n]);return t}function Oc(e){let t=e.replace(mc,Nc);return t.slice(0,3)==="ms-"&&(t="-"+t),t}function Nc(e){return"-"+e.toLowerCase()}const rr={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},Fc={};function Lc(e,t){const n=Fc,r=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,i=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return Ao(e,r,i)}function Ao(e,t,n){if(Mc(e)){if("value"in e)return e.type==="html"&&!n?"":e.value;if(t&&"alt"in e&&e.alt)return e.alt;if("children"in e)return xs(e.children,t,n)}return Array.isArray(e)?xs(e,t,n):""}function xs(e,t,n){const r=[];let i=-1;for(;++i<e.length;)r[i]=Ao(e[i],t,n);return r.join("")}function Mc(e){return!!(e&&typeof e=="object")}const bs=document.createElement("i");function Ci(e){const t="&"+e+";";bs.innerHTML=t;const n=bs.textContent;return n.charCodeAt(n.length-1)===59&&e!=="semi"||n===t?!1:n}function De(e,t,n,r){const i=e.length;let s=0,a;if(t<0?t=-t>i?0:i+t:t=t>i?i:t,n=n>0?n:0,r.length<1e4)a=Array.from(r),a.unshift(t,n),e.splice(...a);else for(n&&e.splice(t,n);s<r.length;)a=r.slice(s,s+1e4),a.unshift(t,0),e.splice(...a),s+=1e4,t+=1e4}function _e(e,t){return e.length>0?(De(e,e.length,0,t),e):t}const _s={}.hasOwnProperty;function Dc(e){const t={};let n=-1;for(;++n<e.length;)Bc(t,e[n]);return t}function Bc(e,t){let n;for(n in t){const i=(_s.call(e,n)?e[n]:void 0)||(e[n]={}),s=t[n];let a;if(s)for(a in s){_s.call(i,a)||(i[a]=[]);const o=s[a];$c(i[a],Array.isArray(o)?o:o?[o]:[])}}}function $c(e,t){let n=-1;const r=[];for(;++n<t.length;)(t[n].add==="after"?e:r).push(t[n]);De(e,0,0,r)}function Po(e,t){const n=Number.parseInt(e,t);return n<9||n===11||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)===65535||(n&65535)===65534||n>1114111?"ï¿½":String.fromCodePoint(n)}function bt(e){return e.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const Le=Ge(/[A-Za-z]/),be=Ge(/[\dA-Za-z]/),zc=Ge(/[#-'*+\--9=?A-Z^-~]/);function Or(e){return e!==null&&(e<32||e===127)}const Nr=Ge(/\d/),jc=Ge(/[\dA-Fa-f]/),Uc=Ge(/[!-/:-@[-`{-~]/);function M(e){return e!==null&&e<-2}function de(e){return e!==null&&(e<0||e===32)}function q(e){return e===-2||e===-1||e===32}const Hc=Ge(new RegExp("\\p{P}|\\p{S}","u")),Vc=Ge(/\s/);function Ge(e){return t;function t(n){return n!==null&&n>-1&&e.test(String.fromCharCode(n))}}function Pt(e){const t=[];let n=-1,r=0,i=0;for(;++n<e.length;){const s=e.charCodeAt(n);let a="";if(s===37&&be(e.charCodeAt(n+1))&&be(e.charCodeAt(n+2)))i=2;else if(s<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(s))||(a=String.fromCharCode(s));else if(s>55295&&s<57344){const o=e.charCodeAt(n+1);s<56320&&o>56319&&o<57344?(a=String.fromCharCode(s,o),i=1):a="ï¿½"}else a=String.fromCharCode(s);a&&(t.push(e.slice(r,n),encodeURIComponent(a)),r=n+i+1,a=""),i&&(n+=i,i=0)}return t.join("")+e.slice(r)}function K(e,t,n,r){const i=r?r-1:Number.POSITIVE_INFINITY;let s=0;return a;function a(l){return q(l)?(e.enter(n),o(l)):t(l)}function o(l){return q(l)&&s++<i?(e.consume(l),o):(e.exit(n),t(l))}}const qc={tokenize:Wc};function Wc(e){const t=e.attempt(this.parser.constructs.contentInitial,r,i);let n;return t;function r(o){if(o===null){e.consume(o);return}return e.enter("lineEnding"),e.consume(o),e.exit("lineEnding"),K(e,t,"linePrefix")}function i(o){return e.enter("paragraph"),s(o)}function s(o){const l=e.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=l),n=l,a(o)}function a(o){if(o===null){e.exit("chunkText"),e.exit("paragraph"),e.consume(o);return}return M(o)?(e.consume(o),e.exit("chunkText"),s):(e.consume(o),a)}}const Xc={tokenize:Jc},ks={tokenize:Kc};function Jc(e){const t=this,n=[];let r=0,i,s,a;return o;function o(b){if(r<n.length){const P=n[r];return t.containerState=P[1],e.attempt(P[0].continuation,l,u)(b)}return u(b)}function l(b){if(r++,t.containerState._closeFlow){t.containerState._closeFlow=void 0,i&&S();const P=t.events.length;let O=P,w;for(;O--;)if(t.events[O][0]==="exit"&&t.events[O][1].type==="chunkFlow"){w=t.events[O][1].end;break}_(r);let I=P;for(;I<t.events.length;)t.events[I][1].end={...w},I++;return De(t.events,O+1,0,t.events.slice(P)),t.events.length=I,u(b)}return o(b)}function u(b){if(r===n.length){if(!i)return d(b);if(i.currentConstruct&&i.currentConstruct.concrete)return g(b);t.interrupt=!!(i.currentConstruct&&!i._gfmTableDynamicInterruptHack)}return t.containerState={},e.check(ks,h,c)(b)}function h(b){return i&&S(),_(r),d(b)}function c(b){return t.parser.lazy[t.now().line]=r!==n.length,a=t.now().offset,g(b)}function d(b){return t.containerState={},e.attempt(ks,f,g)(b)}function f(b){return r++,n.push([t.currentConstruct,t.containerState]),d(b)}function g(b){if(b===null){i&&S(),_(0),e.consume(b);return}return i=i||t.parser.flow(t.now()),e.enter("chunkFlow",{_tokenizer:i,contentType:"flow",previous:s}),y(b)}function y(b){if(b===null){k(e.exit("chunkFlow"),!0),_(0),e.consume(b);return}return M(b)?(e.consume(b),k(e.exit("chunkFlow")),r=0,t.interrupt=void 0,o):(e.consume(b),y)}function k(b,P){const O=t.sliceStream(b);if(P&&O.push(null),b.previous=s,s&&(s.next=b),s=b,i.defineSkip(b.start),i.write(O),t.parser.lazy[b.start.line]){let w=i.events.length;for(;w--;)if(i.events[w][1].start.offset<a&&(!i.events[w][1].end||i.events[w][1].end.offset>a))return;const I=t.events.length;let j=I,N,F;for(;j--;)if(t.events[j][0]==="exit"&&t.events[j][1].type==="chunkFlow"){if(N){F=t.events[j][1].end;break}N=!0}for(_(r),w=I;w<t.events.length;)t.events[w][1].end={...F},w++;De(t.events,j+1,0,t.events.slice(I)),t.events.length=w}}function _(b){let P=n.length;for(;P-- >b;){const O=n[P];t.containerState=O[1],O[0].exit.call(t,e)}n.length=b}function S(){i.write([null]),s=void 0,i=void 0,t.containerState._closeFlow=void 0}}function Kc(e,t,n){return K(e,e.attempt(this.parser.constructs.document,t,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function Ss(e){if(e===null||de(e)||Vc(e))return 1;if(Hc(e))return 2}function Ei(e,t,n){const r=[];let i=-1;for(;++i<e.length;){const s=e[i].resolveAll;s&&!r.includes(s)&&(t=s(t,n),r.push(s))}return t}const Fr={name:"attention",resolveAll:Qc,tokenize:Gc};function Qc(e,t){let n=-1,r,i,s,a,o,l,u,h;for(;++n<e.length;)if(e[n][0]==="enter"&&e[n][1].type==="attentionSequence"&&e[n][1]._close){for(r=n;r--;)if(e[r][0]==="exit"&&e[r][1].type==="attentionSequence"&&e[r][1]._open&&t.sliceSerialize(e[r][1]).charCodeAt(0)===t.sliceSerialize(e[n][1]).charCodeAt(0)){if((e[r][1]._close||e[n][1]._open)&&(e[n][1].end.offset-e[n][1].start.offset)%3&&!((e[r][1].end.offset-e[r][1].start.offset+e[n][1].end.offset-e[n][1].start.offset)%3))continue;l=e[r][1].end.offset-e[r][1].start.offset>1&&e[n][1].end.offset-e[n][1].start.offset>1?2:1;const c={...e[r][1].end},d={...e[n][1].start};Cs(c,-l),Cs(d,l),a={type:l>1?"strongSequence":"emphasisSequence",start:c,end:{...e[r][1].end}},o={type:l>1?"strongSequence":"emphasisSequence",start:{...e[n][1].start},end:d},s={type:l>1?"strongText":"emphasisText",start:{...e[r][1].end},end:{...e[n][1].start}},i={type:l>1?"strong":"emphasis",start:{...a.start},end:{...o.end}},e[r][1].end={...a.start},e[n][1].start={...o.end},u=[],e[r][1].end.offset-e[r][1].start.offset&&(u=_e(u,[["enter",e[r][1],t],["exit",e[r][1],t]])),u=_e(u,[["enter",i,t],["enter",a,t],["exit",a,t],["enter",s,t]]),u=_e(u,Ei(t.parser.constructs.insideSpan.null,e.slice(r+1,n),t)),u=_e(u,[["exit",s,t],["enter",o,t],["exit",o,t],["exit",i,t]]),e[n][1].end.offset-e[n][1].start.offset?(h=2,u=_e(u,[["enter",e[n][1],t],["exit",e[n][1],t]])):h=0,De(e,r-1,n-r+3,u),n=r+u.length-h-2;break}}for(n=-1;++n<e.length;)e[n][1].type==="attentionSequence"&&(e[n][1].type="data");return e}function Gc(e,t){const n=this.parser.constructs.attentionMarkers.null,r=this.previous,i=Ss(r);let s;return a;function a(l){return s=l,e.enter("attentionSequence"),o(l)}function o(l){if(l===s)return e.consume(l),o;const u=e.exit("attentionSequence"),h=Ss(l),c=!h||h===2&&i||n.includes(l),d=!i||i===2&&h||n.includes(r);return u._open=!!(s===42?c:c&&(i||!d)),u._close=!!(s===42?d:d&&(h||!c)),t(l)}}function Cs(e,t){e.column+=t,e.offset+=t,e._bufferIndex+=t}const Yc={name:"autolink",tokenize:Zc};function Zc(e,t,n){let r=0;return i;function i(f){return e.enter("autolink"),e.enter("autolinkMarker"),e.consume(f),e.exit("autolinkMarker"),e.enter("autolinkProtocol"),s}function s(f){return Le(f)?(e.consume(f),a):f===64?n(f):u(f)}function a(f){return f===43||f===45||f===46||be(f)?(r=1,o(f)):u(f)}function o(f){return f===58?(e.consume(f),r=0,l):(f===43||f===45||f===46||be(f))&&r++<32?(e.consume(f),o):(r=0,u(f))}function l(f){return f===62?(e.exit("autolinkProtocol"),e.enter("autolinkMarker"),e.consume(f),e.exit("autolinkMarker"),e.exit("autolink"),t):f===null||f===32||f===60||Or(f)?n(f):(e.consume(f),l)}function u(f){return f===64?(e.consume(f),h):zc(f)?(e.consume(f),u):n(f)}function h(f){return be(f)?c(f):n(f)}function c(f){return f===46?(e.consume(f),r=0,h):f===62?(e.exit("autolinkProtocol").type="autolinkEmail",e.enter("autolinkMarker"),e.consume(f),e.exit("autolinkMarker"),e.exit("autolink"),t):d(f)}function d(f){if((f===45||be(f))&&r++<63){const g=f===45?d:c;return e.consume(f),g}return n(f)}}const Hn={partial:!0,tokenize:eh};function eh(e,t,n){return r;function r(s){return q(s)?K(e,i,"linePrefix")(s):i(s)}function i(s){return s===null||M(s)?t(s):n(s)}}const Io={continuation:{tokenize:nh},exit:rh,name:"blockQuote",tokenize:th};function th(e,t,n){const r=this;return i;function i(a){if(a===62){const o=r.containerState;return o.open||(e.enter("blockQuote",{_container:!0}),o.open=!0),e.enter("blockQuotePrefix"),e.enter("blockQuoteMarker"),e.consume(a),e.exit("blockQuoteMarker"),s}return n(a)}function s(a){return q(a)?(e.enter("blockQuotePrefixWhitespace"),e.consume(a),e.exit("blockQuotePrefixWhitespace"),e.exit("blockQuotePrefix"),t):(e.exit("blockQuotePrefix"),t(a))}}function nh(e,t,n){const r=this;return i;function i(a){return q(a)?K(e,s,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(a):s(a)}function s(a){return e.attempt(Io,t,n)(a)}}function rh(e){e.exit("blockQuote")}const vo={name:"characterEscape",tokenize:ih};function ih(e,t,n){return r;function r(s){return e.enter("characterEscape"),e.enter("escapeMarker"),e.consume(s),e.exit("escapeMarker"),i}function i(s){return Uc(s)?(e.enter("characterEscapeValue"),e.consume(s),e.exit("characterEscapeValue"),e.exit("characterEscape"),t):n(s)}}const Ro={name:"characterReference",tokenize:sh};function sh(e,t,n){const r=this;let i=0,s,a;return o;function o(c){return e.enter("characterReference"),e.enter("characterReferenceMarker"),e.consume(c),e.exit("characterReferenceMarker"),l}function l(c){return c===35?(e.enter("characterReferenceMarkerNumeric"),e.consume(c),e.exit("characterReferenceMarkerNumeric"),u):(e.enter("characterReferenceValue"),s=31,a=be,h(c))}function u(c){return c===88||c===120?(e.enter("characterReferenceMarkerHexadecimal"),e.consume(c),e.exit("characterReferenceMarkerHexadecimal"),e.enter("characterReferenceValue"),s=6,a=jc,h):(e.enter("characterReferenceValue"),s=7,a=Nr,h(c))}function h(c){if(c===59&&i){const d=e.exit("characterReferenceValue");return a===be&&!Ci(r.sliceSerialize(d))?n(c):(e.enter("characterReferenceMarker"),e.consume(c),e.exit("characterReferenceMarker"),e.exit("characterReference"),t)}return a(c)&&i++<s?(e.consume(c),h):n(c)}}const Es={partial:!0,tokenize:oh},As={concrete:!0,name:"codeFenced",tokenize:ah};function ah(e,t,n){const r=this,i={partial:!0,tokenize:O};let s=0,a=0,o;return l;function l(w){return u(w)}function u(w){const I=r.events[r.events.length-1];return s=I&&I[1].type==="linePrefix"?I[2].sliceSerialize(I[1],!0).length:0,o=w,e.enter("codeFenced"),e.enter("codeFencedFence"),e.enter("codeFencedFenceSequence"),h(w)}function h(w){return w===o?(a++,e.consume(w),h):a<3?n(w):(e.exit("codeFencedFenceSequence"),q(w)?K(e,c,"whitespace")(w):c(w))}function c(w){return w===null||M(w)?(e.exit("codeFencedFence"),r.interrupt?t(w):e.check(Es,y,P)(w)):(e.enter("codeFencedFenceInfo"),e.enter("chunkString",{contentType:"string"}),d(w))}function d(w){return w===null||M(w)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),c(w)):q(w)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),K(e,f,"whitespace")(w)):w===96&&w===o?n(w):(e.consume(w),d)}function f(w){return w===null||M(w)?c(w):(e.enter("codeFencedFenceMeta"),e.enter("chunkString",{contentType:"string"}),g(w))}function g(w){return w===null||M(w)?(e.exit("chunkString"),e.exit("codeFencedFenceMeta"),c(w)):w===96&&w===o?n(w):(e.consume(w),g)}function y(w){return e.attempt(i,P,k)(w)}function k(w){return e.enter("lineEnding"),e.consume(w),e.exit("lineEnding"),_}function _(w){return s>0&&q(w)?K(e,S,"linePrefix",s+1)(w):S(w)}function S(w){return w===null||M(w)?e.check(Es,y,P)(w):(e.enter("codeFlowValue"),b(w))}function b(w){return w===null||M(w)?(e.exit("codeFlowValue"),S(w)):(e.consume(w),b)}function P(w){return e.exit("codeFenced"),t(w)}function O(w,I,j){let N=0;return F;function F(U){return w.enter("lineEnding"),w.consume(U),w.exit("lineEnding"),E}function E(U){return w.enter("codeFencedFence"),q(U)?K(w,v,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(U):v(U)}function v(U){return U===o?(w.enter("codeFencedFenceSequence"),V(U)):j(U)}function V(U){return U===o?(N++,w.consume(U),V):N>=a?(w.exit("codeFencedFenceSequence"),q(U)?K(w,G,"whitespace")(U):G(U)):j(U)}function G(U){return U===null||M(U)?(w.exit("codeFencedFence"),I(U)):j(U)}}}function oh(e,t,n){const r=this;return i;function i(a){return a===null?n(a):(e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),s)}function s(a){return r.parser.lazy[r.now().line]?n(a):t(a)}}const ir={name:"codeIndented",tokenize:uh},lh={partial:!0,tokenize:ch};function uh(e,t,n){const r=this;return i;function i(u){return e.enter("codeIndented"),K(e,s,"linePrefix",5)(u)}function s(u){const h=r.events[r.events.length-1];return h&&h[1].type==="linePrefix"&&h[2].sliceSerialize(h[1],!0).length>=4?a(u):n(u)}function a(u){return u===null?l(u):M(u)?e.attempt(lh,a,l)(u):(e.enter("codeFlowValue"),o(u))}function o(u){return u===null||M(u)?(e.exit("codeFlowValue"),a(u)):(e.consume(u),o)}function l(u){return e.exit("codeIndented"),t(u)}}function ch(e,t,n){const r=this;return i;function i(a){return r.parser.lazy[r.now().line]?n(a):M(a)?(e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),i):K(e,s,"linePrefix",5)(a)}function s(a){const o=r.events[r.events.length-1];return o&&o[1].type==="linePrefix"&&o[2].sliceSerialize(o[1],!0).length>=4?t(a):M(a)?i(a):n(a)}}const hh={name:"codeText",previous:dh,resolve:fh,tokenize:ph};function fh(e){let t=e.length-4,n=3,r,i;if((e[n][1].type==="lineEnding"||e[n][1].type==="space")&&(e[t][1].type==="lineEnding"||e[t][1].type==="space")){for(r=n;++r<t;)if(e[r][1].type==="codeTextData"){e[n][1].type="codeTextPadding",e[t][1].type="codeTextPadding",n+=2,t-=2;break}}for(r=n-1,t++;++r<=t;)i===void 0?r!==t&&e[r][1].type!=="lineEnding"&&(i=r):(r===t||e[r][1].type==="lineEnding")&&(e[i][1].type="codeTextData",r!==i+2&&(e[i][1].end=e[r-1][1].end,e.splice(i+2,r-i-2),t-=r-i-2,r=i+2),i=void 0);return e}function dh(e){return e!==96||this.events[this.events.length-1][1].type==="characterEscape"}function ph(e,t,n){let r=0,i,s;return a;function a(c){return e.enter("codeText"),e.enter("codeTextSequence"),o(c)}function o(c){return c===96?(e.consume(c),r++,o):(e.exit("codeTextSequence"),l(c))}function l(c){return c===null?n(c):c===32?(e.enter("space"),e.consume(c),e.exit("space"),l):c===96?(s=e.enter("codeTextSequence"),i=0,h(c)):M(c)?(e.enter("lineEnding"),e.consume(c),e.exit("lineEnding"),l):(e.enter("codeTextData"),u(c))}function u(c){return c===null||c===32||c===96||M(c)?(e.exit("codeTextData"),l(c)):(e.consume(c),u)}function h(c){return c===96?(e.consume(c),i++,h):i===r?(e.exit("codeTextSequence"),e.exit("codeText"),t(c)):(s.type="codeTextData",u(c))}}class mh{constructor(t){this.left=t?[...t]:[],this.right=[]}get(t){if(t<0||t>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+t+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return t<this.left.length?this.left[t]:this.right[this.right.length-t+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(t,n){const r=n??Number.POSITIVE_INFINITY;return r<this.left.length?this.left.slice(t,r):t>this.left.length?this.right.slice(this.right.length-r+this.left.length,this.right.length-t+this.left.length).reverse():this.left.slice(t).concat(this.right.slice(this.right.length-r+this.left.length).reverse())}splice(t,n,r){const i=n||0;this.setCursor(Math.trunc(t));const s=this.right.splice(this.right.length-i,Number.POSITIVE_INFINITY);return r&&Tt(this.left,r),s.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(t){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(t)}pushMany(t){this.setCursor(Number.POSITIVE_INFINITY),Tt(this.left,t)}unshift(t){this.setCursor(0),this.right.push(t)}unshiftMany(t){this.setCursor(0),Tt(this.right,t.reverse())}setCursor(t){if(!(t===this.left.length||t>this.left.length&&this.right.length===0||t<0&&this.left.length===0))if(t<this.left.length){const n=this.left.splice(t,Number.POSITIVE_INFINITY);Tt(this.right,n.reverse())}else{const n=this.right.splice(this.left.length+this.right.length-t,Number.POSITIVE_INFINITY);Tt(this.left,n.reverse())}}}function Tt(e,t){let n=0;if(t.length<1e4)e.push(...t);else for(;n<t.length;)e.push(...t.slice(n,n+1e4)),n+=1e4}function To(e){const t={};let n=-1,r,i,s,a,o,l,u;const h=new mh(e);for(;++n<h.length;){for(;n in t;)n=t[n];if(r=h.get(n),n&&r[1].type==="chunkFlow"&&h.get(n-1)[1].type==="listItemPrefix"&&(l=r[1]._tokenizer.events,s=0,s<l.length&&l[s][1].type==="lineEndingBlank"&&(s+=2),s<l.length&&l[s][1].type==="content"))for(;++s<l.length&&l[s][1].type!=="content";)l[s][1].type==="chunkText"&&(l[s][1]._isInFirstContentOfListItem=!0,s++);if(r[0]==="enter")r[1].contentType&&(Object.assign(t,gh(h,n)),n=t[n],u=!0);else if(r[1]._container){for(s=n,i=void 0;s--;)if(a=h.get(s),a[1].type==="lineEnding"||a[1].type==="lineEndingBlank")a[0]==="enter"&&(i&&(h.get(i)[1].type="lineEndingBlank"),a[1].type="lineEnding",i=s);else if(!(a[1].type==="linePrefix"||a[1].type==="listItemIndent"))break;i&&(r[1].end={...h.get(i)[1].start},o=h.slice(i,n),o.unshift(r),h.splice(i,n-i+1,o))}}return De(e,0,Number.POSITIVE_INFINITY,h.slice(0)),!u}function gh(e,t){const n=e.get(t)[1],r=e.get(t)[2];let i=t-1;const s=[];let a=n._tokenizer;a||(a=r.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(a._contentTypeTextTrailing=!0));const o=a.events,l=[],u={};let h,c,d=-1,f=n,g=0,y=0;const k=[y];for(;f;){for(;e.get(++i)[1]!==f;);s.push(i),f._tokenizer||(h=r.sliceStream(f),f.next||h.push(null),c&&a.defineSkip(f.start),f._isInFirstContentOfListItem&&(a._gfmTasklistFirstContentOfListItem=!0),a.write(h),f._isInFirstContentOfListItem&&(a._gfmTasklistFirstContentOfListItem=void 0)),c=f,f=f.next}for(f=n;++d<o.length;)o[d][0]==="exit"&&o[d-1][0]==="enter"&&o[d][1].type===o[d-1][1].type&&o[d][1].start.line!==o[d][1].end.line&&(y=d+1,k.push(y),f._tokenizer=void 0,f.previous=void 0,f=f.next);for(a.events=[],f?(f._tokenizer=void 0,f.previous=void 0):k.pop(),d=k.length;d--;){const _=o.slice(k[d],k[d+1]),S=s.pop();l.push([S,S+_.length-1]),e.splice(S,2,_)}for(l.reverse(),d=-1;++d<l.length;)u[g+l[d][0]]=g+l[d][1],g+=l[d][1]-l[d][0]-1;return u}const yh={resolve:xh,tokenize:bh},wh={partial:!0,tokenize:_h};function xh(e){return To(e),e}function bh(e,t){let n;return r;function r(o){return e.enter("content"),n=e.enter("chunkContent",{contentType:"content"}),i(o)}function i(o){return o===null?s(o):M(o)?e.check(wh,a,s)(o):(e.consume(o),i)}function s(o){return e.exit("chunkContent"),e.exit("content"),t(o)}function a(o){return e.consume(o),e.exit("chunkContent"),n.next=e.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,i}}function _h(e,t,n){const r=this;return i;function i(a){return e.exit("chunkContent"),e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),K(e,s,"linePrefix")}function s(a){if(a===null||M(a))return n(a);const o=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&o&&o[1].type==="linePrefix"&&o[2].sliceSerialize(o[1],!0).length>=4?t(a):e.interrupt(r.parser.constructs.flow,n,t)(a)}}function Oo(e,t,n,r,i,s,a,o,l){const u=l||Number.POSITIVE_INFINITY;let h=0;return c;function c(_){return _===60?(e.enter(r),e.enter(i),e.enter(s),e.consume(_),e.exit(s),d):_===null||_===32||_===41||Or(_)?n(_):(e.enter(r),e.enter(a),e.enter(o),e.enter("chunkString",{contentType:"string"}),y(_))}function d(_){return _===62?(e.enter(s),e.consume(_),e.exit(s),e.exit(i),e.exit(r),t):(e.enter(o),e.enter("chunkString",{contentType:"string"}),f(_))}function f(_){return _===62?(e.exit("chunkString"),e.exit(o),d(_)):_===null||_===60||M(_)?n(_):(e.consume(_),_===92?g:f)}function g(_){return _===60||_===62||_===92?(e.consume(_),f):f(_)}function y(_){return!h&&(_===null||_===41||de(_))?(e.exit("chunkString"),e.exit(o),e.exit(a),e.exit(r),t(_)):h<u&&_===40?(e.consume(_),h++,y):_===41?(e.consume(_),h--,y):_===null||_===32||_===40||Or(_)?n(_):(e.consume(_),_===92?k:y)}function k(_){return _===40||_===41||_===92?(e.consume(_),y):y(_)}}function No(e,t,n,r,i,s){const a=this;let o=0,l;return u;function u(f){return e.enter(r),e.enter(i),e.consume(f),e.exit(i),e.enter(s),h}function h(f){return o>999||f===null||f===91||f===93&&!l||f===94&&!o&&"_hiddenFootnoteSupport"in a.parser.constructs?n(f):f===93?(e.exit(s),e.enter(i),e.consume(f),e.exit(i),e.exit(r),t):M(f)?(e.enter("lineEnding"),e.consume(f),e.exit("lineEnding"),h):(e.enter("chunkString",{contentType:"string"}),c(f))}function c(f){return f===null||f===91||f===93||M(f)||o++>999?(e.exit("chunkString"),h(f)):(e.consume(f),l||(l=!q(f)),f===92?d:c)}function d(f){return f===91||f===92||f===93?(e.consume(f),o++,c):c(f)}}function Fo(e,t,n,r,i,s){let a;return o;function o(d){return d===34||d===39||d===40?(e.enter(r),e.enter(i),e.consume(d),e.exit(i),a=d===40?41:d,l):n(d)}function l(d){return d===a?(e.enter(i),e.consume(d),e.exit(i),e.exit(r),t):(e.enter(s),u(d))}function u(d){return d===a?(e.exit(s),l(a)):d===null?n(d):M(d)?(e.enter("lineEnding"),e.consume(d),e.exit("lineEnding"),K(e,u,"linePrefix")):(e.enter("chunkString",{contentType:"string"}),h(d))}function h(d){return d===a||d===null||M(d)?(e.exit("chunkString"),u(d)):(e.consume(d),d===92?c:h)}function c(d){return d===a||d===92?(e.consume(d),h):h(d)}}function Ut(e,t){let n;return r;function r(i){return M(i)?(e.enter("lineEnding"),e.consume(i),e.exit("lineEnding"),n=!0,r):q(i)?K(e,r,n?"linePrefix":"lineSuffix")(i):t(i)}}const kh={name:"definition",tokenize:Ch},Sh={partial:!0,tokenize:Eh};function Ch(e,t,n){const r=this;let i;return s;function s(f){return e.enter("definition"),a(f)}function a(f){return No.call(r,e,o,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(f)}function o(f){return i=bt(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),f===58?(e.enter("definitionMarker"),e.consume(f),e.exit("definitionMarker"),l):n(f)}function l(f){return de(f)?Ut(e,u)(f):u(f)}function u(f){return Oo(e,h,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(f)}function h(f){return e.attempt(Sh,c,c)(f)}function c(f){return q(f)?K(e,d,"whitespace")(f):d(f)}function d(f){return f===null||M(f)?(e.exit("definition"),r.parser.defined.push(i),t(f)):n(f)}}function Eh(e,t,n){return r;function r(o){return de(o)?Ut(e,i)(o):n(o)}function i(o){return Fo(e,s,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(o)}function s(o){return q(o)?K(e,a,"whitespace")(o):a(o)}function a(o){return o===null||M(o)?t(o):n(o)}}const Ah={name:"hardBreakEscape",tokenize:Ph};function Ph(e,t,n){return r;function r(s){return e.enter("hardBreakEscape"),e.consume(s),i}function i(s){return M(s)?(e.exit("hardBreakEscape"),t(s)):n(s)}}const Ih={name:"headingAtx",resolve:vh,tokenize:Rh};function vh(e,t){let n=e.length-2,r=3,i,s;return e[r][1].type==="whitespace"&&(r+=2),n-2>r&&e[n][1].type==="whitespace"&&(n-=2),e[n][1].type==="atxHeadingSequence"&&(r===n-1||n-4>r&&e[n-2][1].type==="whitespace")&&(n-=r+1===n?2:4),n>r&&(i={type:"atxHeadingText",start:e[r][1].start,end:e[n][1].end},s={type:"chunkText",start:e[r][1].start,end:e[n][1].end,contentType:"text"},De(e,r,n-r+1,[["enter",i,t],["enter",s,t],["exit",s,t],["exit",i,t]])),e}function Rh(e,t,n){let r=0;return i;function i(h){return e.enter("atxHeading"),s(h)}function s(h){return e.enter("atxHeadingSequence"),a(h)}function a(h){return h===35&&r++<6?(e.consume(h),a):h===null||de(h)?(e.exit("atxHeadingSequence"),o(h)):n(h)}function o(h){return h===35?(e.enter("atxHeadingSequence"),l(h)):h===null||M(h)?(e.exit("atxHeading"),t(h)):q(h)?K(e,o,"whitespace")(h):(e.enter("atxHeadingText"),u(h))}function l(h){return h===35?(e.consume(h),l):(e.exit("atxHeadingSequence"),o(h))}function u(h){return h===null||h===35||de(h)?(e.exit("atxHeadingText"),o(h)):(e.consume(h),u)}}const Th=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],Ps=["pre","script","style","textarea"],Oh={concrete:!0,name:"htmlFlow",resolveTo:Lh,tokenize:Mh},Nh={partial:!0,tokenize:Bh},Fh={partial:!0,tokenize:Dh};function Lh(e){let t=e.length;for(;t--&&!(e[t][0]==="enter"&&e[t][1].type==="htmlFlow"););return t>1&&e[t-2][1].type==="linePrefix"&&(e[t][1].start=e[t-2][1].start,e[t+1][1].start=e[t-2][1].start,e.splice(t-2,2)),e}function Mh(e,t,n){const r=this;let i,s,a,o,l;return u;function u(m){return h(m)}function h(m){return e.enter("htmlFlow"),e.enter("htmlFlowData"),e.consume(m),c}function c(m){return m===33?(e.consume(m),d):m===47?(e.consume(m),s=!0,y):m===63?(e.consume(m),i=3,r.interrupt?t:p):Le(m)?(e.consume(m),a=String.fromCharCode(m),k):n(m)}function d(m){return m===45?(e.consume(m),i=2,f):m===91?(e.consume(m),i=5,o=0,g):Le(m)?(e.consume(m),i=4,r.interrupt?t:p):n(m)}function f(m){return m===45?(e.consume(m),r.interrupt?t:p):n(m)}function g(m){const Ee="CDATA[";return m===Ee.charCodeAt(o++)?(e.consume(m),o===Ee.length?r.interrupt?t:v:g):n(m)}function y(m){return Le(m)?(e.consume(m),a=String.fromCharCode(m),k):n(m)}function k(m){if(m===null||m===47||m===62||de(m)){const Ee=m===47,Ye=a.toLowerCase();return!Ee&&!s&&Ps.includes(Ye)?(i=1,r.interrupt?t(m):v(m)):Th.includes(a.toLowerCase())?(i=6,Ee?(e.consume(m),_):r.interrupt?t(m):v(m)):(i=7,r.interrupt&&!r.parser.lazy[r.now().line]?n(m):s?S(m):b(m))}return m===45||be(m)?(e.consume(m),a+=String.fromCharCode(m),k):n(m)}function _(m){return m===62?(e.consume(m),r.interrupt?t:v):n(m)}function S(m){return q(m)?(e.consume(m),S):F(m)}function b(m){return m===47?(e.consume(m),F):m===58||m===95||Le(m)?(e.consume(m),P):q(m)?(e.consume(m),b):F(m)}function P(m){return m===45||m===46||m===58||m===95||be(m)?(e.consume(m),P):O(m)}function O(m){return m===61?(e.consume(m),w):q(m)?(e.consume(m),O):b(m)}function w(m){return m===null||m===60||m===61||m===62||m===96?n(m):m===34||m===39?(e.consume(m),l=m,I):q(m)?(e.consume(m),w):j(m)}function I(m){return m===l?(e.consume(m),l=null,N):m===null||M(m)?n(m):(e.consume(m),I)}function j(m){return m===null||m===34||m===39||m===47||m===60||m===61||m===62||m===96||de(m)?O(m):(e.consume(m),j)}function N(m){return m===47||m===62||q(m)?b(m):n(m)}function F(m){return m===62?(e.consume(m),E):n(m)}function E(m){return m===null||M(m)?v(m):q(m)?(e.consume(m),E):n(m)}function v(m){return m===45&&i===2?(e.consume(m),le):m===60&&i===1?(e.consume(m),re):m===62&&i===4?(e.consume(m),Ce):m===63&&i===3?(e.consume(m),p):m===93&&i===5?(e.consume(m),Be):M(m)&&(i===6||i===7)?(e.exit("htmlFlowData"),e.check(Nh,$e,V)(m)):m===null||M(m)?(e.exit("htmlFlowData"),V(m)):(e.consume(m),v)}function V(m){return e.check(Fh,G,$e)(m)}function G(m){return e.enter("lineEnding"),e.consume(m),e.exit("lineEnding"),U}function U(m){return m===null||M(m)?V(m):(e.enter("htmlFlowData"),v(m))}function le(m){return m===45?(e.consume(m),p):v(m)}function re(m){return m===47?(e.consume(m),a="",Se):v(m)}function Se(m){if(m===62){const Ee=a.toLowerCase();return Ps.includes(Ee)?(e.consume(m),Ce):v(m)}return Le(m)&&a.length<8?(e.consume(m),a+=String.fromCharCode(m),Se):v(m)}function Be(m){return m===93?(e.consume(m),p):v(m)}function p(m){return m===62?(e.consume(m),Ce):m===45&&i===2?(e.consume(m),p):v(m)}function Ce(m){return m===null||M(m)?(e.exit("htmlFlowData"),$e(m)):(e.consume(m),Ce)}function $e(m){return e.exit("htmlFlow"),t(m)}}function Dh(e,t,n){const r=this;return i;function i(a){return M(a)?(e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),s):n(a)}function s(a){return r.parser.lazy[r.now().line]?n(a):t(a)}}function Bh(e,t,n){return r;function r(i){return e.enter("lineEnding"),e.consume(i),e.exit("lineEnding"),e.attempt(Hn,t,n)}}const $h={name:"htmlText",tokenize:zh};function zh(e,t,n){const r=this;let i,s,a;return o;function o(p){return e.enter("htmlText"),e.enter("htmlTextData"),e.consume(p),l}function l(p){return p===33?(e.consume(p),u):p===47?(e.consume(p),O):p===63?(e.consume(p),b):Le(p)?(e.consume(p),j):n(p)}function u(p){return p===45?(e.consume(p),h):p===91?(e.consume(p),s=0,g):Le(p)?(e.consume(p),S):n(p)}function h(p){return p===45?(e.consume(p),f):n(p)}function c(p){return p===null?n(p):p===45?(e.consume(p),d):M(p)?(a=c,re(p)):(e.consume(p),c)}function d(p){return p===45?(e.consume(p),f):c(p)}function f(p){return p===62?le(p):p===45?d(p):c(p)}function g(p){const Ce="CDATA[";return p===Ce.charCodeAt(s++)?(e.consume(p),s===Ce.length?y:g):n(p)}function y(p){return p===null?n(p):p===93?(e.consume(p),k):M(p)?(a=y,re(p)):(e.consume(p),y)}function k(p){return p===93?(e.consume(p),_):y(p)}function _(p){return p===62?le(p):p===93?(e.consume(p),_):y(p)}function S(p){return p===null||p===62?le(p):M(p)?(a=S,re(p)):(e.consume(p),S)}function b(p){return p===null?n(p):p===63?(e.consume(p),P):M(p)?(a=b,re(p)):(e.consume(p),b)}function P(p){return p===62?le(p):b(p)}function O(p){return Le(p)?(e.consume(p),w):n(p)}function w(p){return p===45||be(p)?(e.consume(p),w):I(p)}function I(p){return M(p)?(a=I,re(p)):q(p)?(e.consume(p),I):le(p)}function j(p){return p===45||be(p)?(e.consume(p),j):p===47||p===62||de(p)?N(p):n(p)}function N(p){return p===47?(e.consume(p),le):p===58||p===95||Le(p)?(e.consume(p),F):M(p)?(a=N,re(p)):q(p)?(e.consume(p),N):le(p)}function F(p){return p===45||p===46||p===58||p===95||be(p)?(e.consume(p),F):E(p)}function E(p){return p===61?(e.consume(p),v):M(p)?(a=E,re(p)):q(p)?(e.consume(p),E):N(p)}function v(p){return p===null||p===60||p===61||p===62||p===96?n(p):p===34||p===39?(e.consume(p),i=p,V):M(p)?(a=v,re(p)):q(p)?(e.consume(p),v):(e.consume(p),G)}function V(p){return p===i?(e.consume(p),i=void 0,U):p===null?n(p):M(p)?(a=V,re(p)):(e.consume(p),V)}function G(p){return p===null||p===34||p===39||p===60||p===61||p===96?n(p):p===47||p===62||de(p)?N(p):(e.consume(p),G)}function U(p){return p===47||p===62||de(p)?N(p):n(p)}function le(p){return p===62?(e.consume(p),e.exit("htmlTextData"),e.exit("htmlText"),t):n(p)}function re(p){return e.exit("htmlTextData"),e.enter("lineEnding"),e.consume(p),e.exit("lineEnding"),Se}function Se(p){return q(p)?K(e,Be,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(p):Be(p)}function Be(p){return e.enter("htmlTextData"),a(p)}}const Ai={name:"labelEnd",resolveAll:Vh,resolveTo:qh,tokenize:Wh},jh={tokenize:Xh},Uh={tokenize:Jh},Hh={tokenize:Kh};function Vh(e){let t=-1;const n=[];for(;++t<e.length;){const r=e[t][1];if(n.push(e[t]),r.type==="labelImage"||r.type==="labelLink"||r.type==="labelEnd"){const i=r.type==="labelImage"?4:2;r.type="data",t+=i}}return e.length!==n.length&&De(e,0,e.length,n),e}function qh(e,t){let n=e.length,r=0,i,s,a,o;for(;n--;)if(i=e[n][1],s){if(i.type==="link"||i.type==="labelLink"&&i._inactive)break;e[n][0]==="enter"&&i.type==="labelLink"&&(i._inactive=!0)}else if(a){if(e[n][0]==="enter"&&(i.type==="labelImage"||i.type==="labelLink")&&!i._balanced&&(s=n,i.type!=="labelLink")){r=2;break}}else i.type==="labelEnd"&&(a=n);const l={type:e[s][1].type==="labelLink"?"link":"image",start:{...e[s][1].start},end:{...e[e.length-1][1].end}},u={type:"label",start:{...e[s][1].start},end:{...e[a][1].end}},h={type:"labelText",start:{...e[s+r+2][1].end},end:{...e[a-2][1].start}};return o=[["enter",l,t],["enter",u,t]],o=_e(o,e.slice(s+1,s+r+3)),o=_e(o,[["enter",h,t]]),o=_e(o,Ei(t.parser.constructs.insideSpan.null,e.slice(s+r+4,a-3),t)),o=_e(o,[["exit",h,t],e[a-2],e[a-1],["exit",u,t]]),o=_e(o,e.slice(a+1)),o=_e(o,[["exit",l,t]]),De(e,s,e.length,o),e}function Wh(e,t,n){const r=this;let i=r.events.length,s,a;for(;i--;)if((r.events[i][1].type==="labelImage"||r.events[i][1].type==="labelLink")&&!r.events[i][1]._balanced){s=r.events[i][1];break}return o;function o(d){return s?s._inactive?c(d):(a=r.parser.defined.includes(bt(r.sliceSerialize({start:s.end,end:r.now()}))),e.enter("labelEnd"),e.enter("labelMarker"),e.consume(d),e.exit("labelMarker"),e.exit("labelEnd"),l):n(d)}function l(d){return d===40?e.attempt(jh,h,a?h:c)(d):d===91?e.attempt(Uh,h,a?u:c)(d):a?h(d):c(d)}function u(d){return e.attempt(Hh,h,c)(d)}function h(d){return t(d)}function c(d){return s._balanced=!0,n(d)}}function Xh(e,t,n){return r;function r(c){return e.enter("resource"),e.enter("resourceMarker"),e.consume(c),e.exit("resourceMarker"),i}function i(c){return de(c)?Ut(e,s)(c):s(c)}function s(c){return c===41?h(c):Oo(e,a,o,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(c)}function a(c){return de(c)?Ut(e,l)(c):h(c)}function o(c){return n(c)}function l(c){return c===34||c===39||c===40?Fo(e,u,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(c):h(c)}function u(c){return de(c)?Ut(e,h)(c):h(c)}function h(c){return c===41?(e.enter("resourceMarker"),e.consume(c),e.exit("resourceMarker"),e.exit("resource"),t):n(c)}}function Jh(e,t,n){const r=this;return i;function i(o){return No.call(r,e,s,a,"reference","referenceMarker","referenceString")(o)}function s(o){return r.parser.defined.includes(bt(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?t(o):n(o)}function a(o){return n(o)}}function Kh(e,t,n){return r;function r(s){return e.enter("reference"),e.enter("referenceMarker"),e.consume(s),e.exit("referenceMarker"),i}function i(s){return s===93?(e.enter("referenceMarker"),e.consume(s),e.exit("referenceMarker"),e.exit("reference"),t):n(s)}}const Qh={name:"labelStartImage",resolveAll:Ai.resolveAll,tokenize:Gh};function Gh(e,t,n){const r=this;return i;function i(o){return e.enter("labelImage"),e.enter("labelImageMarker"),e.consume(o),e.exit("labelImageMarker"),s}function s(o){return o===91?(e.enter("labelMarker"),e.consume(o),e.exit("labelMarker"),e.exit("labelImage"),a):n(o)}function a(o){return o===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(o):t(o)}}const Yh={name:"labelStartLink",resolveAll:Ai.resolveAll,tokenize:Zh};function Zh(e,t,n){const r=this;return i;function i(a){return e.enter("labelLink"),e.enter("labelMarker"),e.consume(a),e.exit("labelMarker"),e.exit("labelLink"),s}function s(a){return a===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(a):t(a)}}const sr={name:"lineEnding",tokenize:ef};function ef(e,t){return n;function n(r){return e.enter("lineEnding"),e.consume(r),e.exit("lineEnding"),K(e,t,"linePrefix")}}const _n={name:"thematicBreak",tokenize:tf};function tf(e,t,n){let r=0,i;return s;function s(u){return e.enter("thematicBreak"),a(u)}function a(u){return i=u,o(u)}function o(u){return u===i?(e.enter("thematicBreakSequence"),l(u)):r>=3&&(u===null||M(u))?(e.exit("thematicBreak"),t(u)):n(u)}function l(u){return u===i?(e.consume(u),r++,l):(e.exit("thematicBreakSequence"),q(u)?K(e,o,"whitespace")(u):o(u))}}const fe={continuation:{tokenize:af},exit:lf,name:"list",tokenize:sf},nf={partial:!0,tokenize:uf},rf={partial:!0,tokenize:of};function sf(e,t,n){const r=this,i=r.events[r.events.length-1];let s=i&&i[1].type==="linePrefix"?i[2].sliceSerialize(i[1],!0).length:0,a=0;return o;function o(f){const g=r.containerState.type||(f===42||f===43||f===45?"listUnordered":"listOrdered");if(g==="listUnordered"?!r.containerState.marker||f===r.containerState.marker:Nr(f)){if(r.containerState.type||(r.containerState.type=g,e.enter(g,{_container:!0})),g==="listUnordered")return e.enter("listItemPrefix"),f===42||f===45?e.check(_n,n,u)(f):u(f);if(!r.interrupt||f===49)return e.enter("listItemPrefix"),e.enter("listItemValue"),l(f)}return n(f)}function l(f){return Nr(f)&&++a<10?(e.consume(f),l):(!r.interrupt||a<2)&&(r.containerState.marker?f===r.containerState.marker:f===41||f===46)?(e.exit("listItemValue"),u(f)):n(f)}function u(f){return e.enter("listItemMarker"),e.consume(f),e.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||f,e.check(Hn,r.interrupt?n:h,e.attempt(nf,d,c))}function h(f){return r.containerState.initialBlankLine=!0,s++,d(f)}function c(f){return q(f)?(e.enter("listItemPrefixWhitespace"),e.consume(f),e.exit("listItemPrefixWhitespace"),d):n(f)}function d(f){return r.containerState.size=s+r.sliceSerialize(e.exit("listItemPrefix"),!0).length,t(f)}}function af(e,t,n){const r=this;return r.containerState._closeFlow=void 0,e.check(Hn,i,s);function i(o){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,K(e,t,"listItemIndent",r.containerState.size+1)(o)}function s(o){return r.containerState.furtherBlankLines||!q(o)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,a(o)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,e.attempt(rf,t,a)(o))}function a(o){return r.containerState._closeFlow=!0,r.interrupt=void 0,K(e,e.attempt(fe,t,n),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(o)}}function of(e,t,n){const r=this;return K(e,i,"listItemIndent",r.containerState.size+1);function i(s){const a=r.events[r.events.length-1];return a&&a[1].type==="listItemIndent"&&a[2].sliceSerialize(a[1],!0).length===r.containerState.size?t(s):n(s)}}function lf(e){e.exit(this.containerState.type)}function uf(e,t,n){const r=this;return K(e,i,"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function i(s){const a=r.events[r.events.length-1];return!q(s)&&a&&a[1].type==="listItemPrefixWhitespace"?t(s):n(s)}}const Is={name:"setextUnderline",resolveTo:cf,tokenize:hf};function cf(e,t){let n=e.length,r,i,s;for(;n--;)if(e[n][0]==="enter"){if(e[n][1].type==="content"){r=n;break}e[n][1].type==="paragraph"&&(i=n)}else e[n][1].type==="content"&&e.splice(n,1),!s&&e[n][1].type==="definition"&&(s=n);const a={type:"setextHeading",start:{...e[r][1].start},end:{...e[e.length-1][1].end}};return e[i][1].type="setextHeadingText",s?(e.splice(i,0,["enter",a,t]),e.splice(s+1,0,["exit",e[r][1],t]),e[r][1].end={...e[s][1].end}):e[r][1]=a,e.push(["exit",a,t]),e}function hf(e,t,n){const r=this;let i;return s;function s(u){let h=r.events.length,c;for(;h--;)if(r.events[h][1].type!=="lineEnding"&&r.events[h][1].type!=="linePrefix"&&r.events[h][1].type!=="content"){c=r.events[h][1].type==="paragraph";break}return!r.parser.lazy[r.now().line]&&(r.interrupt||c)?(e.enter("setextHeadingLine"),i=u,a(u)):n(u)}function a(u){return e.enter("setextHeadingLineSequence"),o(u)}function o(u){return u===i?(e.consume(u),o):(e.exit("setextHeadingLineSequence"),q(u)?K(e,l,"lineSuffix")(u):l(u))}function l(u){return u===null||M(u)?(e.exit("setextHeadingLine"),t(u)):n(u)}}const ff={tokenize:df};function df(e){const t=this,n=e.attempt(Hn,r,e.attempt(this.parser.constructs.flowInitial,i,K(e,e.attempt(this.parser.constructs.flow,i,e.attempt(yh,i)),"linePrefix")));return n;function r(s){if(s===null){e.consume(s);return}return e.enter("lineEndingBlank"),e.consume(s),e.exit("lineEndingBlank"),t.currentConstruct=void 0,n}function i(s){if(s===null){e.consume(s);return}return e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),t.currentConstruct=void 0,n}}const pf={resolveAll:Mo()},mf=Lo("string"),gf=Lo("text");function Lo(e){return{resolveAll:Mo(e==="text"?yf:void 0),tokenize:t};function t(n){const r=this,i=this.parser.constructs[e],s=n.attempt(i,a,o);return a;function a(h){return u(h)?s(h):o(h)}function o(h){if(h===null){n.consume(h);return}return n.enter("data"),n.consume(h),l}function l(h){return u(h)?(n.exit("data"),s(h)):(n.consume(h),l)}function u(h){if(h===null)return!0;const c=i[h];let d=-1;if(c)for(;++d<c.length;){const f=c[d];if(!f.previous||f.previous.call(r,r.previous))return!0}return!1}}}function Mo(e){return t;function t(n,r){let i=-1,s;for(;++i<=n.length;)s===void 0?n[i]&&n[i][1].type==="data"&&(s=i,i++):(!n[i]||n[i][1].type!=="data")&&(i!==s+2&&(n[s][1].end=n[i-1][1].end,n.splice(s+2,i-s-2),i=s+2),s=void 0);return e?e(n,r):n}}function yf(e,t){let n=0;for(;++n<=e.length;)if((n===e.length||e[n][1].type==="lineEnding")&&e[n-1][1].type==="data"){const r=e[n-1][1],i=t.sliceStream(r);let s=i.length,a=-1,o=0,l;for(;s--;){const u=i[s];if(typeof u=="string"){for(a=u.length;u.charCodeAt(a-1)===32;)o++,a--;if(a)break;a=-1}else if(u===-2)l=!0,o++;else if(u!==-1){s++;break}}if(t._contentTypeTextTrailing&&n===e.length&&(o=0),o){const u={type:n===e.length||l||o<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:s?a:r.start._bufferIndex+a,_index:r.start._index+s,line:r.end.line,column:r.end.column-o,offset:r.end.offset-o},end:{...r.end}};r.end={...u.start},r.start.offset===r.end.offset?Object.assign(r,u):(e.splice(n,0,["enter",u,t],["exit",u,t]),n+=2)}n++}return e}const wf={42:fe,43:fe,45:fe,48:fe,49:fe,50:fe,51:fe,52:fe,53:fe,54:fe,55:fe,56:fe,57:fe,62:Io},xf={91:kh},bf={[-2]:ir,[-1]:ir,32:ir},_f={35:Ih,42:_n,45:[Is,_n],60:Oh,61:Is,95:_n,96:As,126:As},kf={38:Ro,92:vo},Sf={[-5]:sr,[-4]:sr,[-3]:sr,33:Qh,38:Ro,42:Fr,60:[Yc,$h],91:Yh,92:[Ah,vo],93:Ai,95:Fr,96:hh},Cf={null:[Fr,pf]},Ef={null:[42,95]},Af={null:[]},Pf=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:Ef,contentInitial:xf,disable:Af,document:wf,flow:_f,flowInitial:bf,insideSpan:Cf,string:kf,text:Sf},Symbol.toStringTag,{value:"Module"}));function If(e,t,n){let r={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const i={},s=[];let a=[],o=[];const l={attempt:I(O),check:I(w),consume:S,enter:b,exit:P,interrupt:I(w,{interrupt:!0})},u={code:null,containerState:{},defineSkip:y,events:[],now:g,parser:e,previous:null,sliceSerialize:d,sliceStream:f,write:c};let h=t.tokenize.call(u,l);return t.resolveAll&&s.push(t),u;function c(E){return a=_e(a,E),k(),a[a.length-1]!==null?[]:(j(t,0),u.events=Ei(s,u.events,u),u.events)}function d(E,v){return Rf(f(E),v)}function f(E){return vf(a,E)}function g(){const{_bufferIndex:E,_index:v,line:V,column:G,offset:U}=r;return{_bufferIndex:E,_index:v,line:V,column:G,offset:U}}function y(E){i[E.line]=E.column,F()}function k(){let E;for(;r._index<a.length;){const v=a[r._index];if(typeof v=="string")for(E=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===E&&r._bufferIndex<v.length;)_(v.charCodeAt(r._bufferIndex));else _(v)}}function _(E){h=h(E)}function S(E){M(E)?(r.line++,r.column=1,r.offset+=E===-3?2:1,F()):E!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===a[r._index].length&&(r._bufferIndex=-1,r._index++)),u.previous=E}function b(E,v){const V=v||{};return V.type=E,V.start=g(),u.events.push(["enter",V,u]),o.push(V),V}function P(E){const v=o.pop();return v.end=g(),u.events.push(["exit",v,u]),v}function O(E,v){j(E,v.from)}function w(E,v){v.restore()}function I(E,v){return V;function V(G,U,le){let re,Se,Be,p;return Array.isArray(G)?$e(G):"tokenize"in G?$e([G]):Ce(G);function Ce(ie){return It;function It(Ve){const st=Ve!==null&&ie[Ve],at=Ve!==null&&ie.null,tn=[...Array.isArray(st)?st:st?[st]:[],...Array.isArray(at)?at:at?[at]:[]];return $e(tn)(Ve)}}function $e(ie){return re=ie,Se=0,ie.length===0?le:m(ie[Se])}function m(ie){return It;function It(Ve){return p=N(),Be=ie,ie.partial||(u.currentConstruct=ie),ie.name&&u.parser.constructs.disable.null.includes(ie.name)?Ye():ie.tokenize.call(v?Object.assign(Object.create(u),v):u,l,Ee,Ye)(Ve)}}function Ee(ie){return E(Be,p),U}function Ye(ie){return p.restore(),++Se<re.length?m(re[Se]):le}}}function j(E,v){E.resolveAll&&!s.includes(E)&&s.push(E),E.resolve&&De(u.events,v,u.events.length-v,E.resolve(u.events.slice(v),u)),E.resolveTo&&(u.events=E.resolveTo(u.events,u))}function N(){const E=g(),v=u.previous,V=u.currentConstruct,G=u.events.length,U=Array.from(o);return{from:G,restore:le};function le(){r=E,u.previous=v,u.currentConstruct=V,u.events.length=G,o=U,F()}}function F(){r.line in i&&r.column<2&&(r.column=i[r.line],r.offset+=i[r.line]-1)}}function vf(e,t){const n=t.start._index,r=t.start._bufferIndex,i=t.end._index,s=t.end._bufferIndex;let a;if(n===i)a=[e[n].slice(r,s)];else{if(a=e.slice(n,i),r>-1){const o=a[0];typeof o=="string"?a[0]=o.slice(r):a.shift()}s>0&&a.push(e[i].slice(0,s))}return a}function Rf(e,t){let n=-1;const r=[];let i;for(;++n<e.length;){const s=e[n];let a;if(typeof s=="string")a=s;else switch(s){case-5:{a="\r";break}case-4:{a=`
`;break}case-3:{a=`\r
`;break}case-2:{a=t?" ":"	";break}case-1:{if(!t&&i)continue;a=" ";break}default:a=String.fromCharCode(s)}i=s===-2,r.push(a)}return r.join("")}function Tf(e){const r={constructs:Dc([Pf,...(e||{}).extensions||[]]),content:i(qc),defined:[],document:i(Xc),flow:i(ff),lazy:{},string:i(mf),text:i(gf)};return r;function i(s){return a;function a(o){return If(r,s,o)}}}function Of(e){for(;!To(e););return e}const vs=/[\0\t\n\r]/g;function Nf(){let e=1,t="",n=!0,r;return i;function i(s,a,o){const l=[];let u,h,c,d,f;for(s=t+(typeof s=="string"?s.toString():new TextDecoder(a||void 0).decode(s)),c=0,t="",n&&(s.charCodeAt(0)===65279&&c++,n=void 0);c<s.length;){if(vs.lastIndex=c,u=vs.exec(s),d=u&&u.index!==void 0?u.index:s.length,f=s.charCodeAt(d),!u){t=s.slice(c);break}if(f===10&&c===d&&r)l.push(-3),r=void 0;else switch(r&&(l.push(-5),r=void 0),c<d&&(l.push(s.slice(c,d)),e+=d-c),f){case 0:{l.push(65533),e++;break}case 9:{for(h=Math.ceil(e/4)*4,l.push(-2);e++<h;)l.push(-1);break}case 10:{l.push(-4),e=1;break}default:r=!0,e=1}c=d+1}return o&&(r&&l.push(-5),t&&l.push(t),l.push(null)),l}}const Ff=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function Lf(e){return e.replace(Ff,Mf)}function Mf(e,t,n){if(t)return t;if(n.charCodeAt(0)===35){const i=n.charCodeAt(1),s=i===120||i===88;return Po(n.slice(s?2:1),s?16:10)}return Ci(n)||e}const Do={}.hasOwnProperty;function Df(e,t,n){return typeof t!="string"&&(n=t,t=void 0),Bf(n)(Of(Tf(n).document().write(Nf()(e,t,!0))))}function Bf(e){const t={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:s(Li),autolinkProtocol:N,autolinkEmail:N,atxHeading:s(Oi),blockQuote:s(at),characterEscape:N,characterReference:N,codeFenced:s(tn),codeFencedFenceInfo:a,codeFencedFenceMeta:a,codeIndented:s(tn,a),codeText:s(Ko,a),codeTextData:N,data:N,codeFlowValue:N,definition:s(Qo),definitionDestinationString:a,definitionLabelString:a,definitionTitleString:a,emphasis:s(Go),hardBreakEscape:s(Ni),hardBreakTrailing:s(Ni),htmlFlow:s(Fi,a),htmlFlowData:N,htmlText:s(Fi,a),htmlTextData:N,image:s(Yo),label:a,link:s(Li),listItem:s(Zo),listItemValue:d,listOrdered:s(Mi,c),listUnordered:s(Mi),paragraph:s(el),reference:m,referenceString:a,resourceDestinationString:a,resourceTitleString:a,setextHeading:s(Oi),strong:s(tl),thematicBreak:s(rl)},exit:{atxHeading:l(),atxHeadingSequence:O,autolink:l(),autolinkEmail:st,autolinkProtocol:Ve,blockQuote:l(),characterEscapeValue:F,characterReferenceMarkerHexadecimal:Ye,characterReferenceMarkerNumeric:Ye,characterReferenceValue:ie,characterReference:It,codeFenced:l(k),codeFencedFence:y,codeFencedFenceInfo:f,codeFencedFenceMeta:g,codeFlowValue:F,codeIndented:l(_),codeText:l(U),codeTextData:F,data:F,definition:l(),definitionDestinationString:P,definitionLabelString:S,definitionTitleString:b,emphasis:l(),hardBreakEscape:l(v),hardBreakTrailing:l(v),htmlFlow:l(V),htmlFlowData:F,htmlText:l(G),htmlTextData:F,image:l(re),label:Be,labelText:Se,lineEnding:E,link:l(le),listItem:l(),listOrdered:l(),listUnordered:l(),paragraph:l(),referenceString:Ee,resourceDestinationString:p,resourceTitleString:Ce,resource:$e,setextHeading:l(j),setextHeadingLineSequence:I,setextHeadingText:w,strong:l(),thematicBreak:l()}};Bo(t,(e||{}).mdastExtensions||[]);const n={};return r;function r(x){let A={type:"root",children:[]};const D={stack:[A],tokenStack:[],config:t,enter:o,exit:u,buffer:a,resume:h,data:n},H=[];let X=-1;for(;++X<x.length;)if(x[X][1].type==="listOrdered"||x[X][1].type==="listUnordered")if(x[X][0]==="enter")H.push(X);else{const Ae=H.pop();X=i(x,Ae,X)}for(X=-1;++X<x.length;){const Ae=t[x[X][0]];Do.call(Ae,x[X][1].type)&&Ae[x[X][1].type].call(Object.assign({sliceSerialize:x[X][2].sliceSerialize},D),x[X][1])}if(D.tokenStack.length>0){const Ae=D.tokenStack[D.tokenStack.length-1];(Ae[1]||Rs).call(D,void 0,Ae[0])}for(A.position={start:Je(x.length>0?x[0][1].start:{line:1,column:1,offset:0}),end:Je(x.length>0?x[x.length-2][1].end:{line:1,column:1,offset:0})},X=-1;++X<t.transforms.length;)A=t.transforms[X](A)||A;return A}function i(x,A,D){let H=A-1,X=-1,Ae=!1,Ze,ze,vt,Rt;for(;++H<=D;){const me=x[H];switch(me[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{me[0]==="enter"?X++:X--,Rt=void 0;break}case"lineEndingBlank":{me[0]==="enter"&&(Ze&&!Rt&&!X&&!vt&&(vt=H),Rt=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:Rt=void 0}if(!X&&me[0]==="enter"&&me[1].type==="listItemPrefix"||X===-1&&me[0]==="exit"&&(me[1].type==="listUnordered"||me[1].type==="listOrdered")){if(Ze){let ot=H;for(ze=void 0;ot--;){const je=x[ot];if(je[1].type==="lineEnding"||je[1].type==="lineEndingBlank"){if(je[0]==="exit")continue;ze&&(x[ze][1].type="lineEndingBlank",Ae=!0),je[1].type="lineEnding",ze=ot}else if(!(je[1].type==="linePrefix"||je[1].type==="blockQuotePrefix"||je[1].type==="blockQuotePrefixWhitespace"||je[1].type==="blockQuoteMarker"||je[1].type==="listItemIndent"))break}vt&&(!ze||vt<ze)&&(Ze._spread=!0),Ze.end=Object.assign({},ze?x[ze][1].start:me[1].end),x.splice(ze||H,0,["exit",Ze,me[2]]),H++,D++}if(me[1].type==="listItemPrefix"){const ot={type:"listItem",_spread:!1,start:Object.assign({},me[1].start),end:void 0};Ze=ot,x.splice(H,0,["enter",ot,me[2]]),H++,D++,vt=void 0,Rt=!0}}}return x[A][1]._spread=Ae,D}function s(x,A){return D;function D(H){o.call(this,x(H),H),A&&A.call(this,H)}}function a(){this.stack.push({type:"fragment",children:[]})}function o(x,A,D){this.stack[this.stack.length-1].children.push(x),this.stack.push(x),this.tokenStack.push([A,D||void 0]),x.position={start:Je(A.start),end:void 0}}function l(x){return A;function A(D){x&&x.call(this,D),u.call(this,D)}}function u(x,A){const D=this.stack.pop(),H=this.tokenStack.pop();if(H)H[0].type!==x.type&&(A?A.call(this,x,H[0]):(H[1]||Rs).call(this,x,H[0]));else throw new Error("Cannot close `"+x.type+"` ("+jt({start:x.start,end:x.end})+"): itâ€™s not open");D.position.end=Je(x.end)}function h(){return Lc(this.stack.pop())}function c(){this.data.expectingFirstListItemValue=!0}function d(x){if(this.data.expectingFirstListItemValue){const A=this.stack[this.stack.length-2];A.start=Number.parseInt(this.sliceSerialize(x),10),this.data.expectingFirstListItemValue=void 0}}function f(){const x=this.resume(),A=this.stack[this.stack.length-1];A.lang=x}function g(){const x=this.resume(),A=this.stack[this.stack.length-1];A.meta=x}function y(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function k(){const x=this.resume(),A=this.stack[this.stack.length-1];A.value=x.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function _(){const x=this.resume(),A=this.stack[this.stack.length-1];A.value=x.replace(/(\r?\n|\r)$/g,"")}function S(x){const A=this.resume(),D=this.stack[this.stack.length-1];D.label=A,D.identifier=bt(this.sliceSerialize(x)).toLowerCase()}function b(){const x=this.resume(),A=this.stack[this.stack.length-1];A.title=x}function P(){const x=this.resume(),A=this.stack[this.stack.length-1];A.url=x}function O(x){const A=this.stack[this.stack.length-1];if(!A.depth){const D=this.sliceSerialize(x).length;A.depth=D}}function w(){this.data.setextHeadingSlurpLineEnding=!0}function I(x){const A=this.stack[this.stack.length-1];A.depth=this.sliceSerialize(x).codePointAt(0)===61?1:2}function j(){this.data.setextHeadingSlurpLineEnding=void 0}function N(x){const D=this.stack[this.stack.length-1].children;let H=D[D.length-1];(!H||H.type!=="text")&&(H=nl(),H.position={start:Je(x.start),end:void 0},D.push(H)),this.stack.push(H)}function F(x){const A=this.stack.pop();A.value+=this.sliceSerialize(x),A.position.end=Je(x.end)}function E(x){const A=this.stack[this.stack.length-1];if(this.data.atHardBreak){const D=A.children[A.children.length-1];D.position.end=Je(x.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&t.canContainEols.includes(A.type)&&(N.call(this,x),F.call(this,x))}function v(){this.data.atHardBreak=!0}function V(){const x=this.resume(),A=this.stack[this.stack.length-1];A.value=x}function G(){const x=this.resume(),A=this.stack[this.stack.length-1];A.value=x}function U(){const x=this.resume(),A=this.stack[this.stack.length-1];A.value=x}function le(){const x=this.stack[this.stack.length-1];if(this.data.inReference){const A=this.data.referenceType||"shortcut";x.type+="Reference",x.referenceType=A,delete x.url,delete x.title}else delete x.identifier,delete x.label;this.data.referenceType=void 0}function re(){const x=this.stack[this.stack.length-1];if(this.data.inReference){const A=this.data.referenceType||"shortcut";x.type+="Reference",x.referenceType=A,delete x.url,delete x.title}else delete x.identifier,delete x.label;this.data.referenceType=void 0}function Se(x){const A=this.sliceSerialize(x),D=this.stack[this.stack.length-2];D.label=Lf(A),D.identifier=bt(A).toLowerCase()}function Be(){const x=this.stack[this.stack.length-1],A=this.resume(),D=this.stack[this.stack.length-1];if(this.data.inReference=!0,D.type==="link"){const H=x.children;D.children=H}else D.alt=A}function p(){const x=this.resume(),A=this.stack[this.stack.length-1];A.url=x}function Ce(){const x=this.resume(),A=this.stack[this.stack.length-1];A.title=x}function $e(){this.data.inReference=void 0}function m(){this.data.referenceType="collapsed"}function Ee(x){const A=this.resume(),D=this.stack[this.stack.length-1];D.label=A,D.identifier=bt(this.sliceSerialize(x)).toLowerCase(),this.data.referenceType="full"}function Ye(x){this.data.characterReferenceType=x.type}function ie(x){const A=this.sliceSerialize(x),D=this.data.characterReferenceType;let H;D?(H=Po(A,D==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):H=Ci(A);const X=this.stack[this.stack.length-1];X.value+=H}function It(x){const A=this.stack.pop();A.position.end=Je(x.end)}function Ve(x){F.call(this,x);const A=this.stack[this.stack.length-1];A.url=this.sliceSerialize(x)}function st(x){F.call(this,x);const A=this.stack[this.stack.length-1];A.url="mailto:"+this.sliceSerialize(x)}function at(){return{type:"blockquote",children:[]}}function tn(){return{type:"code",lang:null,meta:null,value:""}}function Ko(){return{type:"inlineCode",value:""}}function Qo(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function Go(){return{type:"emphasis",children:[]}}function Oi(){return{type:"heading",depth:0,children:[]}}function Ni(){return{type:"break"}}function Fi(){return{type:"html",value:""}}function Yo(){return{type:"image",title:null,url:"",alt:null}}function Li(){return{type:"link",title:null,url:"",children:[]}}function Mi(x){return{type:"list",ordered:x.type==="listOrdered",start:null,spread:x._spread,children:[]}}function Zo(x){return{type:"listItem",spread:x._spread,checked:null,children:[]}}function el(){return{type:"paragraph",children:[]}}function tl(){return{type:"strong",children:[]}}function nl(){return{type:"text",value:""}}function rl(){return{type:"thematicBreak"}}}function Je(e){return{line:e.line,column:e.column,offset:e.offset}}function Bo(e,t){let n=-1;for(;++n<t.length;){const r=t[n];Array.isArray(r)?Bo(e,r):$f(e,r)}}function $f(e,t){let n;for(n in t)if(Do.call(t,n))switch(n){case"canContainEols":{const r=t[n];r&&e[n].push(...r);break}case"transforms":{const r=t[n];r&&e[n].push(...r);break}case"enter":case"exit":{const r=t[n];r&&Object.assign(e[n],r);break}}}function Rs(e,t){throw e?new Error("Cannot close `"+e.type+"` ("+jt({start:e.start,end:e.end})+"): a different token (`"+t.type+"`, "+jt({start:t.start,end:t.end})+") is open"):new Error("Cannot close document, a token (`"+t.type+"`, "+jt({start:t.start,end:t.end})+") is still open")}function zf(e){const t=this;t.parser=n;function n(r){return Df(r,{...t.data("settings"),...e,extensions:t.data("micromarkExtensions")||[],mdastExtensions:t.data("fromMarkdownExtensions")||[]})}}function jf(e,t){const n={type:"element",tagName:"blockquote",properties:{},children:e.wrap(e.all(t),!0)};return e.patch(t,n),e.applyData(t,n)}function Uf(e,t){const n={type:"element",tagName:"br",properties:{},children:[]};return e.patch(t,n),[e.applyData(t,n),{type:"text",value:`
`}]}function Hf(e,t){const n=t.value?t.value+`
`:"",r={};t.lang&&(r.className=["language-"+t.lang]);let i={type:"element",tagName:"code",properties:r,children:[{type:"text",value:n}]};return t.meta&&(i.data={meta:t.meta}),e.patch(t,i),i=e.applyData(t,i),i={type:"element",tagName:"pre",properties:{},children:[i]},e.patch(t,i),i}function Vf(e,t){const n={type:"element",tagName:"del",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function qf(e,t){const n={type:"element",tagName:"em",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function Wf(e,t){const n=typeof e.options.clobberPrefix=="string"?e.options.clobberPrefix:"user-content-",r=String(t.identifier).toUpperCase(),i=Pt(r.toLowerCase()),s=e.footnoteOrder.indexOf(r);let a,o=e.footnoteCounts.get(r);o===void 0?(o=0,e.footnoteOrder.push(r),a=e.footnoteOrder.length):a=s+1,o+=1,e.footnoteCounts.set(r,o);const l={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+i,id:n+"fnref-"+i+(o>1?"-"+o:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(a)}]};e.patch(t,l);const u={type:"element",tagName:"sup",properties:{},children:[l]};return e.patch(t,u),e.applyData(t,u)}function Xf(e,t){const n={type:"element",tagName:"h"+t.depth,properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function Jf(e,t){if(e.options.allowDangerousHtml){const n={type:"raw",value:t.value};return e.patch(t,n),e.applyData(t,n)}}function $o(e,t){const n=t.referenceType;let r="]";if(n==="collapsed"?r+="[]":n==="full"&&(r+="["+(t.label||t.identifier)+"]"),t.type==="imageReference")return[{type:"text",value:"!["+t.alt+r}];const i=e.all(t),s=i[0];s&&s.type==="text"?s.value="["+s.value:i.unshift({type:"text",value:"["});const a=i[i.length-1];return a&&a.type==="text"?a.value+=r:i.push({type:"text",value:r}),i}function Kf(e,t){const n=String(t.identifier).toUpperCase(),r=e.definitionById.get(n);if(!r)return $o(e,t);const i={src:Pt(r.url||""),alt:t.alt};r.title!==null&&r.title!==void 0&&(i.title=r.title);const s={type:"element",tagName:"img",properties:i,children:[]};return e.patch(t,s),e.applyData(t,s)}function Qf(e,t){const n={src:Pt(t.url)};t.alt!==null&&t.alt!==void 0&&(n.alt=t.alt),t.title!==null&&t.title!==void 0&&(n.title=t.title);const r={type:"element",tagName:"img",properties:n,children:[]};return e.patch(t,r),e.applyData(t,r)}function Gf(e,t){const n={type:"text",value:t.value.replace(/\r?\n|\r/g," ")};e.patch(t,n);const r={type:"element",tagName:"code",properties:{},children:[n]};return e.patch(t,r),e.applyData(t,r)}function Yf(e,t){const n=String(t.identifier).toUpperCase(),r=e.definitionById.get(n);if(!r)return $o(e,t);const i={href:Pt(r.url||"")};r.title!==null&&r.title!==void 0&&(i.title=r.title);const s={type:"element",tagName:"a",properties:i,children:e.all(t)};return e.patch(t,s),e.applyData(t,s)}function Zf(e,t){const n={href:Pt(t.url)};t.title!==null&&t.title!==void 0&&(n.title=t.title);const r={type:"element",tagName:"a",properties:n,children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function ed(e,t,n){const r=e.all(t),i=n?td(n):zo(t),s={},a=[];if(typeof t.checked=="boolean"){const h=r[0];let c;h&&h.type==="element"&&h.tagName==="p"?c=h:(c={type:"element",tagName:"p",properties:{},children:[]},r.unshift(c)),c.children.length>0&&c.children.unshift({type:"text",value:" "}),c.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:t.checked,disabled:!0},children:[]}),s.className=["task-list-item"]}let o=-1;for(;++o<r.length;){const h=r[o];(i||o!==0||h.type!=="element"||h.tagName!=="p")&&a.push({type:"text",value:`
`}),h.type==="element"&&h.tagName==="p"&&!i?a.push(...h.children):a.push(h)}const l=r[r.length-1];l&&(i||l.type!=="element"||l.tagName!=="p")&&a.push({type:"text",value:`
`});const u={type:"element",tagName:"li",properties:s,children:a};return e.patch(t,u),e.applyData(t,u)}function td(e){let t=!1;if(e.type==="list"){t=e.spread||!1;const n=e.children;let r=-1;for(;!t&&++r<n.length;)t=zo(n[r])}return t}function zo(e){const t=e.spread;return t??e.children.length>1}function nd(e,t){const n={},r=e.all(t);let i=-1;for(typeof t.start=="number"&&t.start!==1&&(n.start=t.start);++i<r.length;){const a=r[i];if(a.type==="element"&&a.tagName==="li"&&a.properties&&Array.isArray(a.properties.className)&&a.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const s={type:"element",tagName:t.ordered?"ol":"ul",properties:n,children:e.wrap(r,!0)};return e.patch(t,s),e.applyData(t,s)}function rd(e,t){const n={type:"element",tagName:"p",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function id(e,t){const n={type:"root",children:e.wrap(e.all(t))};return e.patch(t,n),e.applyData(t,n)}function sd(e,t){const n={type:"element",tagName:"strong",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}function ad(e,t){const n=e.all(t),r=n.shift(),i=[];if(r){const a={type:"element",tagName:"thead",properties:{},children:e.wrap([r],!0)};e.patch(t.children[0],a),i.push(a)}if(n.length>0){const a={type:"element",tagName:"tbody",properties:{},children:e.wrap(n,!0)},o=bi(t.children[1]),l=bo(t.children[t.children.length-1]);o&&l&&(a.position={start:o,end:l}),i.push(a)}const s={type:"element",tagName:"table",properties:{},children:e.wrap(i,!0)};return e.patch(t,s),e.applyData(t,s)}function od(e,t,n){const r=n?n.children:void 0,s=(r?r.indexOf(t):1)===0?"th":"td",a=n&&n.type==="table"?n.align:void 0,o=a?a.length:t.children.length;let l=-1;const u=[];for(;++l<o;){const c=t.children[l],d={},f=a?a[l]:void 0;f&&(d.align=f);let g={type:"element",tagName:s,properties:d,children:[]};c&&(g.children=e.all(c),e.patch(c,g),g=e.applyData(c,g)),u.push(g)}const h={type:"element",tagName:"tr",properties:{},children:e.wrap(u,!0)};return e.patch(t,h),e.applyData(t,h)}function ld(e,t){const n={type:"element",tagName:"td",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)}const Ts=9,Os=32;function ud(e){const t=String(e),n=/\r?\n|\r/g;let r=n.exec(t),i=0;const s=[];for(;r;)s.push(Ns(t.slice(i,r.index),i>0,!0),r[0]),i=r.index+r[0].length,r=n.exec(t);return s.push(Ns(t.slice(i),i>0,!1)),s.join("")}function Ns(e,t,n){let r=0,i=e.length;if(t){let s=e.codePointAt(r);for(;s===Ts||s===Os;)r++,s=e.codePointAt(r)}if(n){let s=e.codePointAt(i-1);for(;s===Ts||s===Os;)i--,s=e.codePointAt(i-1)}return i>r?e.slice(r,i):""}function cd(e,t){const n={type:"text",value:ud(String(t.value))};return e.patch(t,n),e.applyData(t,n)}function hd(e,t){const n={type:"element",tagName:"hr",properties:{},children:[]};return e.patch(t,n),e.applyData(t,n)}const fd={blockquote:jf,break:Uf,code:Hf,delete:Vf,emphasis:qf,footnoteReference:Wf,heading:Xf,html:Jf,imageReference:Kf,image:Qf,inlineCode:Gf,linkReference:Yf,link:Zf,listItem:ed,list:nd,paragraph:rd,root:id,strong:sd,table:ad,tableCell:ld,tableRow:od,text:cd,thematicBreak:hd,toml:fn,yaml:fn,definition:fn,footnoteDefinition:fn};function fn(){}const jo=-1,Vn=0,Ht=1,In=2,Pi=3,Ii=4,vi=5,Ri=6,Uo=7,Ho=8,Fs=typeof self=="object"?self:globalThis,dd=(e,t)=>{const n=(i,s)=>(e.set(s,i),i),r=i=>{if(e.has(i))return e.get(i);const[s,a]=t[i];switch(s){case Vn:case jo:return n(a,i);case Ht:{const o=n([],i);for(const l of a)o.push(r(l));return o}case In:{const o=n({},i);for(const[l,u]of a)o[r(l)]=r(u);return o}case Pi:return n(new Date(a),i);case Ii:{const{source:o,flags:l}=a;return n(new RegExp(o,l),i)}case vi:{const o=n(new Map,i);for(const[l,u]of a)o.set(r(l),r(u));return o}case Ri:{const o=n(new Set,i);for(const l of a)o.add(r(l));return o}case Uo:{const{name:o,message:l}=a;return n(new Fs[o](l),i)}case Ho:return n(BigInt(a),i);case"BigInt":return n(Object(BigInt(a)),i);case"ArrayBuffer":return n(new Uint8Array(a).buffer,a);case"DataView":{const{buffer:o}=new Uint8Array(a);return n(new DataView(o),a)}}return n(new Fs[s](a),i)};return r},Ls=e=>dd(new Map,e)(0),ft="",{toString:pd}={},{keys:md}=Object,Ot=e=>{const t=typeof e;if(t!=="object"||!e)return[Vn,t];const n=pd.call(e).slice(8,-1);switch(n){case"Array":return[Ht,ft];case"Object":return[In,ft];case"Date":return[Pi,ft];case"RegExp":return[Ii,ft];case"Map":return[vi,ft];case"Set":return[Ri,ft];case"DataView":return[Ht,n]}return n.includes("Array")?[Ht,n]:n.includes("Error")?[Uo,n]:[In,n]},dn=([e,t])=>e===Vn&&(t==="function"||t==="symbol"),gd=(e,t,n,r)=>{const i=(a,o)=>{const l=r.push(a)-1;return n.set(o,l),l},s=a=>{if(n.has(a))return n.get(a);let[o,l]=Ot(a);switch(o){case Vn:{let h=a;switch(l){case"bigint":o=Ho,h=a.toString();break;case"function":case"symbol":if(e)throw new TypeError("unable to serialize "+l);h=null;break;case"undefined":return i([jo],a)}return i([o,h],a)}case Ht:{if(l){let d=a;return l==="DataView"?d=new Uint8Array(a.buffer):l==="ArrayBuffer"&&(d=new Uint8Array(a)),i([l,[...d]],a)}const h=[],c=i([o,h],a);for(const d of a)h.push(s(d));return c}case In:{if(l)switch(l){case"BigInt":return i([l,a.toString()],a);case"Boolean":case"Number":case"String":return i([l,a.valueOf()],a)}if(t&&"toJSON"in a)return s(a.toJSON());const h=[],c=i([o,h],a);for(const d of md(a))(e||!dn(Ot(a[d])))&&h.push([s(d),s(a[d])]);return c}case Pi:return i([o,a.toISOString()],a);case Ii:{const{source:h,flags:c}=a;return i([o,{source:h,flags:c}],a)}case vi:{const h=[],c=i([o,h],a);for(const[d,f]of a)(e||!(dn(Ot(d))||dn(Ot(f))))&&h.push([s(d),s(f)]);return c}case Ri:{const h=[],c=i([o,h],a);for(const d of a)(e||!dn(Ot(d)))&&h.push(s(d));return c}}const{message:u}=a;return i([o,{name:l,message:u}],a)};return s},Ms=(e,{json:t,lossy:n}={})=>{const r=[];return gd(!(t||n),!!t,new Map,r)(e),r},vn=typeof structuredClone=="function"?(e,t)=>t&&("json"in t||"lossy"in t)?Ls(Ms(e,t)):structuredClone(e):(e,t)=>Ls(Ms(e,t));function yd(e,t){const n=[{type:"text",value:"â†©"}];return t>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(t)}]}),n}function wd(e,t){return"Back to reference "+(e+1)+(t>1?"-"+t:"")}function xd(e){const t=typeof e.options.clobberPrefix=="string"?e.options.clobberPrefix:"user-content-",n=e.options.footnoteBackContent||yd,r=e.options.footnoteBackLabel||wd,i=e.options.footnoteLabel||"Footnotes",s=e.options.footnoteLabelTagName||"h2",a=e.options.footnoteLabelProperties||{className:["sr-only"]},o=[];let l=-1;for(;++l<e.footnoteOrder.length;){const u=e.footnoteById.get(e.footnoteOrder[l]);if(!u)continue;const h=e.all(u),c=String(u.identifier).toUpperCase(),d=Pt(c.toLowerCase());let f=0;const g=[],y=e.footnoteCounts.get(c);for(;y!==void 0&&++f<=y;){g.length>0&&g.push({type:"text",value:" "});let S=typeof n=="string"?n:n(l,f);typeof S=="string"&&(S={type:"text",value:S}),g.push({type:"element",tagName:"a",properties:{href:"#"+t+"fnref-"+d+(f>1?"-"+f:""),dataFootnoteBackref:"",ariaLabel:typeof r=="string"?r:r(l,f),className:["data-footnote-backref"]},children:Array.isArray(S)?S:[S]})}const k=h[h.length-1];if(k&&k.type==="element"&&k.tagName==="p"){const S=k.children[k.children.length-1];S&&S.type==="text"?S.value+=" ":k.children.push({type:"text",value:" "}),k.children.push(...g)}else h.push(...g);const _={type:"element",tagName:"li",properties:{id:t+"fn-"+d},children:e.wrap(h,!0)};e.patch(u,_),o.push(_)}if(o.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:s,properties:{...vn(a),id:"footnote-label"},children:[{type:"text",value:i}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:e.wrap(o,!0)},{type:"text",value:`
`}]}}const Vo=function(e){if(e==null)return Sd;if(typeof e=="function")return qn(e);if(typeof e=="object")return Array.isArray(e)?bd(e):_d(e);if(typeof e=="string")return kd(e);throw new Error("Expected function, string, or object as test")};function bd(e){const t=[];let n=-1;for(;++n<e.length;)t[n]=Vo(e[n]);return qn(r);function r(...i){let s=-1;for(;++s<t.length;)if(t[s].apply(this,i))return!0;return!1}}function _d(e){const t=e;return qn(n);function n(r){const i=r;let s;for(s in e)if(i[s]!==t[s])return!1;return!0}}function kd(e){return qn(t);function t(n){return n&&n.type===e}}function qn(e){return t;function t(n,r,i){return!!(Cd(n)&&e.call(this,n,typeof r=="number"?r:void 0,i||void 0))}}function Sd(){return!0}function Cd(e){return e!==null&&typeof e=="object"&&"type"in e}const qo=[],Ed=!0,Ds=!1,Ad="skip";function Pd(e,t,n,r){let i;typeof t=="function"&&typeof n!="function"?(r=n,n=t):i=t;const s=Vo(i),a=r?-1:1;o(e,void 0,[])();function o(l,u,h){const c=l&&typeof l=="object"?l:{};if(typeof c.type=="string"){const f=typeof c.tagName=="string"?c.tagName:typeof c.name=="string"?c.name:void 0;Object.defineProperty(d,"name",{value:"node ("+(l.type+(f?"<"+f+">":""))+")"})}return d;function d(){let f=qo,g,y,k;if((!t||s(l,u,h[h.length-1]||void 0))&&(f=Id(n(l,h)),f[0]===Ds))return f;if("children"in l&&l.children){const _=l;if(_.children&&f[0]!==Ad)for(y=(r?_.children.length:-1)+a,k=h.concat(_);y>-1&&y<_.children.length;){const S=_.children[y];if(g=o(S,y,k)(),g[0]===Ds)return g;y=typeof g[1]=="number"?g[1]:y+a}}return f}}}function Id(e){return Array.isArray(e)?e:typeof e=="number"?[Ed,e]:e==null?qo:[e]}function Wo(e,t,n,r){let i,s,a;typeof t=="function"?(s=void 0,a=t,i=n):(s=t,a=n,i=r),Pd(e,s,o,i);function o(l,u){const h=u[u.length-1],c=h?h.children.indexOf(l):void 0;return a(l,c,h)}}const Lr={}.hasOwnProperty,vd={};function Rd(e,t){const n=t||vd,r=new Map,i=new Map,s=new Map,a={...fd,...n.handlers},o={all:u,applyData:Od,definitionById:r,footnoteById:i,footnoteCounts:s,footnoteOrder:[],handlers:a,one:l,options:n,patch:Td,wrap:Fd};return Wo(e,function(h){if(h.type==="definition"||h.type==="footnoteDefinition"){const c=h.type==="definition"?r:i,d=String(h.identifier).toUpperCase();c.has(d)||c.set(d,h)}}),o;function l(h,c){const d=h.type,f=o.handlers[d];if(Lr.call(o.handlers,d)&&f)return f(o,h,c);if(o.options.passThrough&&o.options.passThrough.includes(d)){if("children"in h){const{children:y,...k}=h,_=vn(k);return _.children=o.all(h),_}return vn(h)}return(o.options.unknownHandler||Nd)(o,h,c)}function u(h){const c=[];if("children"in h){const d=h.children;let f=-1;for(;++f<d.length;){const g=o.one(d[f],h);if(g){if(f&&d[f-1].type==="break"&&(!Array.isArray(g)&&g.type==="text"&&(g.value=Bs(g.value)),!Array.isArray(g)&&g.type==="element")){const y=g.children[0];y&&y.type==="text"&&(y.value=Bs(y.value))}Array.isArray(g)?c.push(...g):c.push(g)}}}return c}}function Td(e,t){e.position&&(t.position=dc(e))}function Od(e,t){let n=t;if(e&&e.data){const r=e.data.hName,i=e.data.hChildren,s=e.data.hProperties;if(typeof r=="string")if(n.type==="element")n.tagName=r;else{const a="children"in n?n.children:[n];n={type:"element",tagName:r,properties:{},children:a}}n.type==="element"&&s&&Object.assign(n.properties,vn(s)),"children"in n&&n.children&&i!==null&&i!==void 0&&(n.children=i)}return n}function Nd(e,t){const n=t.data||{},r="value"in t&&!(Lr.call(n,"hProperties")||Lr.call(n,"hChildren"))?{type:"text",value:t.value}:{type:"element",tagName:"div",properties:{},children:e.all(t)};return e.patch(t,r),e.applyData(t,r)}function Fd(e,t){const n=[];let r=-1;for(t&&n.push({type:"text",value:`
`});++r<e.length;)r&&n.push({type:"text",value:`
`}),n.push(e[r]);return t&&e.length>0&&n.push({type:"text",value:`
`}),n}function Bs(e){let t=0,n=e.charCodeAt(t);for(;n===9||n===32;)t++,n=e.charCodeAt(t);return e.slice(t)}function $s(e,t){const n=Rd(e,t),r=n.one(e,void 0),i=xd(n),s=Array.isArray(r)?{type:"root",children:r}:r||{type:"root",children:[]};return i&&s.children.push({type:"text",value:`
`},i),s}function Ld(e,t){return e&&"run"in e?async function(n,r){const i=$s(n,{file:r,...t});await e.run(i,r)}:function(n,r){return $s(n,{file:r,...e||t})}}function zs(e){if(e)throw e}var kn=Object.prototype.hasOwnProperty,Xo=Object.prototype.toString,js=Object.defineProperty,Us=Object.getOwnPropertyDescriptor,Hs=function(t){return typeof Array.isArray=="function"?Array.isArray(t):Xo.call(t)==="[object Array]"},Vs=function(t){if(!t||Xo.call(t)!=="[object Object]")return!1;var n=kn.call(t,"constructor"),r=t.constructor&&t.constructor.prototype&&kn.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!n&&!r)return!1;var i;for(i in t);return typeof i>"u"||kn.call(t,i)},qs=function(t,n){js&&n.name==="__proto__"?js(t,n.name,{enumerable:!0,configurable:!0,value:n.newValue,writable:!0}):t[n.name]=n.newValue},Ws=function(t,n){if(n==="__proto__")if(kn.call(t,n)){if(Us)return Us(t,n).value}else return;return t[n]},Md=function e(){var t,n,r,i,s,a,o=arguments[0],l=1,u=arguments.length,h=!1;for(typeof o=="boolean"&&(h=o,o=arguments[1]||{},l=2),(o==null||typeof o!="object"&&typeof o!="function")&&(o={});l<u;++l)if(t=arguments[l],t!=null)for(n in t)r=Ws(o,n),i=Ws(t,n),o!==i&&(h&&i&&(Vs(i)||(s=Hs(i)))?(s?(s=!1,a=r&&Hs(r)?r:[]):a=r&&Vs(r)?r:{},qs(o,{name:n,newValue:e(h,a,i)})):typeof i<"u"&&qs(o,{name:n,newValue:i}));return o};const ar=Ys(Md);function Mr(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function Dd(){const e=[],t={run:n,use:r};return t;function n(...i){let s=-1;const a=i.pop();if(typeof a!="function")throw new TypeError("Expected function as last argument, not "+a);o(null,...i);function o(l,...u){const h=e[++s];let c=-1;if(l){a(l);return}for(;++c<i.length;)(u[c]===null||u[c]===void 0)&&(u[c]=i[c]);i=u,h?Bd(h,o)(...u):a(null,...u)}}function r(i){if(typeof i!="function")throw new TypeError("Expected `middelware` to be a function, not "+i);return e.push(i),t}}function Bd(e,t){let n;return r;function r(...a){const o=e.length>a.length;let l;o&&a.push(i);try{l=e.apply(this,a)}catch(u){const h=u;if(o&&n)throw h;return i(h)}o||(l&&l.then&&typeof l.then=="function"?l.then(s,i):l instanceof Error?i(l):s(l))}function i(a,...o){n||(n=!0,t(a,...o))}function s(a){i(null,a)}}const Te={basename:$d,dirname:zd,extname:jd,join:Ud,sep:"/"};function $d(e,t){if(t!==void 0&&typeof t!="string")throw new TypeError('"ext" argument must be a string');en(e);let n=0,r=-1,i=e.length,s;if(t===void 0||t.length===0||t.length>e.length){for(;i--;)if(e.codePointAt(i)===47){if(s){n=i+1;break}}else r<0&&(s=!0,r=i+1);return r<0?"":e.slice(n,r)}if(t===e)return"";let a=-1,o=t.length-1;for(;i--;)if(e.codePointAt(i)===47){if(s){n=i+1;break}}else a<0&&(s=!0,a=i+1),o>-1&&(e.codePointAt(i)===t.codePointAt(o--)?o<0&&(r=i):(o=-1,r=a));return n===r?r=a:r<0&&(r=e.length),e.slice(n,r)}function zd(e){if(en(e),e.length===0)return".";let t=-1,n=e.length,r;for(;--n;)if(e.codePointAt(n)===47){if(r){t=n;break}}else r||(r=!0);return t<0?e.codePointAt(0)===47?"/":".":t===1&&e.codePointAt(0)===47?"//":e.slice(0,t)}function jd(e){en(e);let t=e.length,n=-1,r=0,i=-1,s=0,a;for(;t--;){const o=e.codePointAt(t);if(o===47){if(a){r=t+1;break}continue}n<0&&(a=!0,n=t+1),o===46?i<0?i=t:s!==1&&(s=1):i>-1&&(s=-1)}return i<0||n<0||s===0||s===1&&i===n-1&&i===r+1?"":e.slice(i,n)}function Ud(...e){let t=-1,n;for(;++t<e.length;)en(e[t]),e[t]&&(n=n===void 0?e[t]:n+"/"+e[t]);return n===void 0?".":Hd(n)}function Hd(e){en(e);const t=e.codePointAt(0)===47;let n=Vd(e,!t);return n.length===0&&!t&&(n="."),n.length>0&&e.codePointAt(e.length-1)===47&&(n+="/"),t?"/"+n:n}function Vd(e,t){let n="",r=0,i=-1,s=0,a=-1,o,l;for(;++a<=e.length;){if(a<e.length)o=e.codePointAt(a);else{if(o===47)break;o=47}if(o===47){if(!(i===a-1||s===1))if(i!==a-1&&s===2){if(n.length<2||r!==2||n.codePointAt(n.length-1)!==46||n.codePointAt(n.length-2)!==46){if(n.length>2){if(l=n.lastIndexOf("/"),l!==n.length-1){l<0?(n="",r=0):(n=n.slice(0,l),r=n.length-1-n.lastIndexOf("/")),i=a,s=0;continue}}else if(n.length>0){n="",r=0,i=a,s=0;continue}}t&&(n=n.length>0?n+"/..":"..",r=2)}else n.length>0?n+="/"+e.slice(i+1,a):n=e.slice(i+1,a),r=a-i-1;i=a,s=0}else o===46&&s>-1?s++:s=-1}return n}function en(e){if(typeof e!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}const qd={cwd:Wd};function Wd(){return"/"}function Dr(e){return!!(e!==null&&typeof e=="object"&&"href"in e&&e.href&&"protocol"in e&&e.protocol&&e.auth===void 0)}function Xd(e){if(typeof e=="string")e=new URL(e);else if(!Dr(e)){const t=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+e+"`");throw t.code="ERR_INVALID_ARG_TYPE",t}if(e.protocol!=="file:"){const t=new TypeError("The URL must be of scheme file");throw t.code="ERR_INVALID_URL_SCHEME",t}return Jd(e)}function Jd(e){if(e.hostname!==""){const r=new TypeError('File URL host must be "localhost" or empty on darwin');throw r.code="ERR_INVALID_FILE_URL_HOST",r}const t=e.pathname;let n=-1;for(;++n<t.length;)if(t.codePointAt(n)===37&&t.codePointAt(n+1)===50){const r=t.codePointAt(n+2);if(r===70||r===102){const i=new TypeError("File URL path must not include encoded / characters");throw i.code="ERR_INVALID_FILE_URL_PATH",i}}return decodeURIComponent(t)}const or=["history","path","basename","stem","extname","dirname"];class Jo{constructor(t){let n;t?Dr(t)?n={path:t}:typeof t=="string"||Kd(t)?n={value:t}:n=t:n={},this.cwd="cwd"in n?"":qd.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let r=-1;for(;++r<or.length;){const s=or[r];s in n&&n[s]!==void 0&&n[s]!==null&&(this[s]=s==="history"?[...n[s]]:n[s])}let i;for(i in n)or.includes(i)||(this[i]=n[i])}get basename(){return typeof this.path=="string"?Te.basename(this.path):void 0}set basename(t){ur(t,"basename"),lr(t,"basename"),this.path=Te.join(this.dirname||"",t)}get dirname(){return typeof this.path=="string"?Te.dirname(this.path):void 0}set dirname(t){Xs(this.basename,"dirname"),this.path=Te.join(t||"",this.basename)}get extname(){return typeof this.path=="string"?Te.extname(this.path):void 0}set extname(t){if(lr(t,"extname"),Xs(this.dirname,"extname"),t){if(t.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(t.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=Te.join(this.dirname,this.stem+(t||""))}get path(){return this.history[this.history.length-1]}set path(t){Dr(t)&&(t=Xd(t)),ur(t,"path"),this.path!==t&&this.history.push(t)}get stem(){return typeof this.path=="string"?Te.basename(this.path,this.extname):void 0}set stem(t){ur(t,"stem"),lr(t,"stem"),this.path=Te.join(this.dirname||"",t+(this.extname||""))}fail(t,n,r){const i=this.message(t,n,r);throw i.fatal=!0,i}info(t,n,r){const i=this.message(t,n,r);return i.fatal=void 0,i}message(t,n,r){const i=new ce(t,n,r);return this.path&&(i.name=this.path+":"+i.name,i.file=this.path),i.fatal=!1,this.messages.push(i),i}toString(t){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(t||void 0).decode(this.value)}}function lr(e,t){if(e&&e.includes(Te.sep))throw new Error("`"+t+"` cannot be a path: did not expect `"+Te.sep+"`")}function ur(e,t){if(!e)throw new Error("`"+t+"` cannot be empty")}function Xs(e,t){if(!e)throw new Error("Setting `"+t+"` requires `path` to be set too")}function Kd(e){return!!(e&&typeof e=="object"&&"byteLength"in e&&"byteOffset"in e)}const Qd=function(e){const r=this.constructor.prototype,i=r[e],s=function(){return i.apply(s,arguments)};return Object.setPrototypeOf(s,r),s},Gd={}.hasOwnProperty;class Ti extends Qd{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=Dd()}copy(){const t=new Ti;let n=-1;for(;++n<this.attachers.length;){const r=this.attachers[n];t.use(...r)}return t.data(ar(!0,{},this.namespace)),t}data(t,n){return typeof t=="string"?arguments.length===2?(fr("data",this.frozen),this.namespace[t]=n,this):Gd.call(this.namespace,t)&&this.namespace[t]||void 0:t?(fr("data",this.frozen),this.namespace=t,this):this.namespace}freeze(){if(this.frozen)return this;const t=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...r]=this.attachers[this.freezeIndex];if(r[0]===!1)continue;r[0]===!0&&(r[0]=void 0);const i=n.call(t,...r);typeof i=="function"&&this.transformers.use(i)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(t){this.freeze();const n=pn(t),r=this.parser||this.Parser;return cr("parse",r),r(String(n),n)}process(t,n){const r=this;return this.freeze(),cr("process",this.parser||this.Parser),hr("process",this.compiler||this.Compiler),n?i(void 0,n):new Promise(i);function i(s,a){const o=pn(t),l=r.parse(o);r.run(l,o,function(h,c,d){if(h||!c||!d)return u(h);const f=c,g=r.stringify(f,d);ep(g)?d.value=g:d.result=g,u(h,d)});function u(h,c){h||!c?a(h):s?s(c):n(void 0,c)}}}processSync(t){let n=!1,r;return this.freeze(),cr("processSync",this.parser||this.Parser),hr("processSync",this.compiler||this.Compiler),this.process(t,i),Ks("processSync","process",n),r;function i(s,a){n=!0,zs(s),r=a}}run(t,n,r){Js(t),this.freeze();const i=this.transformers;return!r&&typeof n=="function"&&(r=n,n=void 0),r?s(void 0,r):new Promise(s);function s(a,o){const l=pn(n);i.run(t,l,u);function u(h,c,d){const f=c||t;h?o(h):a?a(f):r(void 0,f,d)}}}runSync(t,n){let r=!1,i;return this.run(t,n,s),Ks("runSync","run",r),i;function s(a,o){zs(a),i=o,r=!0}}stringify(t,n){this.freeze();const r=pn(n),i=this.compiler||this.Compiler;return hr("stringify",i),Js(t),i(t,r)}use(t,...n){const r=this.attachers,i=this.namespace;if(fr("use",this.frozen),t!=null)if(typeof t=="function")l(t,n);else if(typeof t=="object")Array.isArray(t)?o(t):a(t);else throw new TypeError("Expected usable value, not `"+t+"`");return this;function s(u){if(typeof u=="function")l(u,[]);else if(typeof u=="object")if(Array.isArray(u)){const[h,...c]=u;l(h,c)}else a(u);else throw new TypeError("Expected usable value, not `"+u+"`")}function a(u){if(!("plugins"in u)&&!("settings"in u))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");o(u.plugins),u.settings&&(i.settings=ar(!0,i.settings,u.settings))}function o(u){let h=-1;if(u!=null)if(Array.isArray(u))for(;++h<u.length;){const c=u[h];s(c)}else throw new TypeError("Expected a list of plugins, not `"+u+"`")}function l(u,h){let c=-1,d=-1;for(;++c<r.length;)if(r[c][0]===u){d=c;break}if(d===-1)r.push([u,...h]);else if(h.length>0){let[f,...g]=h;const y=r[d][1];Mr(y)&&Mr(f)&&(f=ar(!0,y,f)),r[d]=[u,f,...g]}}}}const Yd=new Ti().freeze();function cr(e,t){if(typeof t!="function")throw new TypeError("Cannot `"+e+"` without `parser`")}function hr(e,t){if(typeof t!="function")throw new TypeError("Cannot `"+e+"` without `compiler`")}function fr(e,t){if(t)throw new Error("Cannot call `"+e+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function Js(e){if(!Mr(e)||typeof e.type!="string")throw new TypeError("Expected node, got `"+e+"`")}function Ks(e,t,n){if(!n)throw new Error("`"+e+"` finished async. Use `"+t+"` instead")}function pn(e){return Zd(e)?e:new Jo(e)}function Zd(e){return!!(e&&typeof e=="object"&&"message"in e&&"messages"in e)}function ep(e){return typeof e=="string"||tp(e)}function tp(e){return!!(e&&typeof e=="object"&&"byteLength"in e&&"byteOffset"in e)}const np="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",Qs=[],Gs={allowDangerousHtml:!0},rp=/^(https?|ircs?|mailto|xmpp)$/i,ip=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function sp(e){const t=ap(e),n=op(e);return lp(t.runSync(t.parse(n),n),e)}function ap(e){const t=e.rehypePlugins||Qs,n=e.remarkPlugins||Qs,r=e.remarkRehypeOptions?{...e.remarkRehypeOptions,...Gs}:Gs;return Yd().use(zf).use(n).use(Ld,r).use(t)}function op(e){const t=e.children||"",n=new Jo;return typeof t=="string"&&(n.value=t),n}function lp(e,t){const n=t.allowedElements,r=t.allowElement,i=t.components,s=t.disallowedElements,a=t.skipHtml,o=t.unwrapDisallowed,l=t.urlTransform||up;for(const h of ip)Object.hasOwn(t,h.from)&&(""+h.from+(h.to?"use `"+h.to+"` instead":"remove it")+np+h.id,void 0);return Wo(e,u),wc(e,{Fragment:T.Fragment,components:i,ignoreInvalidStyle:!0,jsx:T.jsx,jsxs:T.jsxs,passKeys:!0,passNode:!0});function u(h,c,d){if(h.type==="raw"&&d&&typeof c=="number")return a?d.children.splice(c,1):d.children[c]={type:"text",value:h.value},c;if(h.type==="element"){let f;for(f in rr)if(Object.hasOwn(rr,f)&&Object.hasOwn(h.properties,f)){const g=h.properties[f],y=rr[f];(y===null||y.includes(h.tagName))&&(h.properties[f]=l(String(g||""),f,h))}}if(h.type==="element"){let f=n?!n.includes(h.tagName):s?s.includes(h.tagName):!1;if(!f&&r&&typeof c=="number"&&(f=!r(h,c,d)),f&&d&&typeof c=="number")return o&&h.children?d.children.splice(c,1,...h.children):d.children.splice(c,1),c}}}function up(e){const t=e.indexOf(":"),n=e.indexOf("?"),r=e.indexOf("#"),i=e.indexOf("/");return t===-1||i!==-1&&t>i||n!==-1&&t>n||r!==-1&&t>r||rp.test(e.slice(0,t))?e:""}function vp({params:e}){return[{title:"Chat - Zest"},{name:"description",content:"Chat about your book with Zest"}]}async function Rp({params:e}){const{chatId:t}=e,n=await al();if(!n)return sl(dr("/settings"));const r=await ol(t);if(!r)throw new Response("Chat not found",{status:404});const i=await ll(r.bookId);if(!i)throw new Response("Book not found",{status:404});const s=await i.file.arrayBuffer(),a=cl(s);await a.ready;let o="";if(i.location){const l=i.location.start.replace(/!.*/,""),u=i.location.start.replace(/.*!/,"").replace(/\)$/,""),h=i.location.end.replace(/.*!/,"").replace(/\)$/,""),c=`${l}!,${u},${h})`;try{o=(await a.getRange(c)).toString()}catch(d){console.error("Error getting page content:",d),o="Current page content not available"}}return{book:i,settings:n,content:o,chat:r}}const Tp=il(function({loaderData:t}){const{book:n,settings:r,content:i,chat:s}=t,[a,o]=Oe.useState(s.messages),[l,u]=Oe.useState(""),[h,c]=Oe.useState(!1),[d,f]=Oe.useState(null),[g,y]=Oe.useState(!1),k=Oe.useRef(null);Oe.useEffect(()=>{var b;(b=k.current)==null||b.scrollIntoView({behavior:"smooth"})},[a]);const _=async b=>{try{const P={...s,messages:b,updatedAt:new Date};if(b.length>=2&&(s.title==="New conversation"||!s.title))try{const O=await ku(b,r);P.title=O}catch(O){console.error("Failed to generate title:",O)}await ul(P)}catch(P){console.error("Failed to save chat:",P)}},S=async b=>{var w,I;const P={role:"user",content:b,timestamp:new Date},O=[...a,P];o(O),u(""),c(!0),f(null);try{const j=new B({apiKey:r.apiKey,baseURL:r.baseUrl,dangerouslyAllowBrowser:!0});let N=`Role: You are a professional literary guide and book companion who specializes in helping readers understand and engage with "${n.title}".

Context: The user is currently reading this passage:
<passage>
"${i}"
</passage>

The complete book content is available for your reference:
<book>
${n.markdown}
</book>

Format:
- Keep responses concise and conversational
- No hard sells, just provide valuable insights
- Include specific textual references when relevant
- Format your response in markdown

Goal: Help the reader understand concepts, analyze themes, answer questions about the content, and deepen their appreciation of the book without spoiling future content.`;const E=(I=(w=(await j.chat.completions.create({model:r.modelName,messages:[{role:"system",content:N},...O.map(v=>({role:v.role,content:v.content}))],temperature:.7})).choices[0])==null?void 0:w.message)==null?void 0:I.content;if(E){const v={role:"assistant",content:E,timestamp:new Date},V=[...O,v];o(V),await _(V)}else throw new Error("No response from the API")}catch(j){console.error("Error sending message:",j),f("Failed to get a response. Please check your API settings.")}finally{c(!1)}};return T.jsxs("div",{className:"flex flex-col h-screen pt-14",children:[T.jsx(hl,{currentPage:"chat",bookId:n.id,children:T.jsx("button",{onClick:()=>y(!g),className:"p-2 text-white hover:text-blue-100 transition-colors","aria-label":"View chat history",children:T.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:T.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16m-7 6h7"})})})}),g&&T.jsx(cp,{bookId:n.id,currentChatId:s.id,onClose:()=>y(!1)}),T.jsxs("div",{className:"flex flex-col h-full bg-gray-50",children:[T.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:T.jsxs("div",{className:"max-w-3xl mx-auto space-y-4",children:[a.length===0&&T.jsxs("div",{className:"bg-blue-50 border border-blue-200 p-4 rounded-lg",children:[T.jsxs("h3",{className:"font-medium text-blue-800 mb-2",children:['Chat about "',n.title,'"']}),T.jsx("p",{className:"text-blue-700",children:"Ask questions about themes, characters, or any aspect of the book you're reading."})]}),a.filter(b=>b.role!=="system").map((b,P)=>T.jsx("div",{className:`p-3 rounded-lg ${b.role==="user"?"bg-blue-100 ml-auto max-w-[80%]":"bg-white border border-gray-200 mr-auto max-w-[80%]"}`,children:b.role==="assistant"?T.jsx("div",{className:"prose prose-sm max-w-none prose-blue prose-headings:text-blue-800 prose-a:text-blue-600 prose-strong:text-blue-700",children:T.jsx(sp,{children:b.content})}):T.jsx("p",{className:"whitespace-pre-wrap",children:b.content})},P)),h&&T.jsx("div",{className:"bg-white border border-gray-200 p-3 rounded-lg mr-auto max-w-[80%]",children:T.jsxs("div",{className:"flex space-x-2",children:[T.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),T.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}}),T.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.4s"}})]})}),d&&T.jsx("div",{className:"bg-red-100 border border-red-300 p-3 rounded-lg text-red-700 mr-auto max-w-[80%]",children:T.jsx("p",{children:d})}),T.jsx("div",{ref:k})]})}),T.jsx("div",{className:"border-t border-gray-200 p-4 bg-white",children:T.jsxs("div",{className:"max-w-3xl mx-auto",children:[T.jsxs("form",{onSubmit:b=>{b.preventDefault(),S(l)},className:"flex space-x-2",children:[T.jsx("input",{type:"text",value:l,onChange:b=>u(b.target.value),placeholder:"Ask about your book...",className:"flex-1 border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:h}),T.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",disabled:h||!l.trim(),children:"Send"})]}),a.length===0&&T.jsx("div",{className:"mt-4 flex flex-col gap-3",children:hp.map((b,P)=>T.jsx("button",{onClick:()=>{S(b)},className:"w-full text-left p-3 text-gray-700 hover:bg-gray-100 rounded-md border border-gray-200",children:b},P))})]})})]})]})});function cp({bookId:e,currentChatId:t,onClose:n}){const[r,i]=Oe.useState([]),[s,a]=Oe.useState(!0);return Oe.useEffect(()=>{(async()=>{try{const{getChatsByBookId:l}=await pl(async()=>{const{getChatsByBookId:h}=await import("./db-Dghpep6g.js");return{getChatsByBookId:h}},[]),u=await l(e);i(u)}catch(l){console.error("Error loading chats:",l)}finally{a(!1)}})()},[e]),T.jsxs("div",{className:"fixed inset-0 z-50 flex",children:[T.jsx("div",{className:"absolute inset-0 bg-black/30",onClick:n}),T.jsxs("div",{className:"relative w-80 max-w-[80%] h-full bg-white shadow-lg overflow-auto z-10 ml-auto",children:[T.jsxs("div",{className:"sticky top-0 bg-white p-4 border-b flex justify-between items-center",children:[T.jsx("h3",{className:"font-semibold text-lg",children:"Chat History"}),T.jsx("button",{onClick:n,className:"p-1 rounded-full hover:bg-gray-100",children:T.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:T.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s?T.jsxs("div",{className:"p-4 text-center text-gray-500",children:[T.jsx("div",{className:"flex justify-center mb-2",children:T.jsx("div",{className:"w-6 h-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"})}),"Loading chats..."]}):r.length===0?T.jsx("div",{className:"p-4 text-center text-gray-500",children:"No chat history found"}):T.jsxs("ul",{className:"divide-y",children:[T.jsx("div",{className:"sticky bottom-0 bg-white p-4 border-t",children:T.jsx(Di,{reloadDocument:!0,to:dr("/books/:bookId/chats/new",{bookId:e}),className:"block w-full bg-blue-500 text-white text-center py-2 px-4 rounded-md hover:bg-blue-600 transition-colors",children:"Start New Chat"})}),r.map(o=>T.jsx("li",{className:`${o.id===t?"bg-blue-50":""}`,children:T.jsxs(Di,{to:dr("/chats/:chatId",{chatId:o.id}),reloadDocument:!0,className:"block p-4 hover:bg-blue-50 transition-colors",children:[T.jsx("div",{className:"font-medium truncate",children:o.title}),T.jsxs("div",{className:"text-sm text-gray-500",children:[new Date(o.updatedAt).toLocaleDateString()," Â·",o.messages.length," messages"]})]})},o.id))]})]})]})}const hp=["Summarize what I've read so far in the book","Tell me what happens in the rest of this chapter without major spoilers","Explain what's happening on this page in simple terms","Ask me a series of questions (one at a time) about the book so far to check my understanding"];export{Rp as clientLoader,Tp as default,vp as meta};
